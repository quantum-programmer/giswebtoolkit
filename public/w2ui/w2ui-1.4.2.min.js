var w2ui=w2ui||{},w2obj=w2obj||{},w2utils=function(){function i(e){var t=/^[-+]?[0-9]+$/;return t.test(e)}function s(e){return"string"==typeof e&&(e=e.replace(w2utils.settings.decimalSymbol,".")),("number"==typeof e||"string"==typeof e&&""!==e)&&!isNaN(Number(e))}function r(e){var t=w2utils.settings,i=new RegExp("^"+(t.currencyPrefix?"\\"+t.currencyPrefix+"?":"")+"[-+]?[0-9]*[\\"+w2utils.settings.decimalSymbol+"]?[0-9]+"+(t.currencySuffix?"\\"+t.currencySuffix+"?":"")+"$","i");return"string"==typeof e&&(e=e.replace(new RegExp(t.groupSymbol,"g"),"")),"object"==typeof e||""===e?!1:i.test(e)}function n(e){var t=/^[a-fA-F0-9]+$/;return t.test(e)}function a(e){var t=/^[a-zA-Z0-9_-]+$/;return t.test(e)}function o(e){var t=/^[a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;return t.test(e)}function l(e,t,s){if(!e)return!1;var n,a,o,r="Invalid Date";if(null==t&&(t=w2utils.settings.date_format),"function"==typeof e.getUTCFullYear&&"function"==typeof e.getUTCMonth&&"function"==typeof e.getUTCDate)o=e.getUTCFullYear(),n=e.getUTCMonth(),a=e.getUTCDate();else if("function"==typeof e.getFullYear&&"function"==typeof e.getMonth&&"function"==typeof e.getDate)o=e.getFullYear(),n=e.getMonth(),a=e.getDate();else{if(e=String(e),RegExp("mon","ig").test(t)){t=t.replace(/month/gi,"m").replace(/mon/gi,"m").replace(/dd/gi,"d").replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase(),e=e.replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase();for(var l=0,d=w2utils.settings.fullmonths.length;d>l;l++){var u=w2utils.settings.fullmonths[l];e=e.replace(RegExp(u,"ig"),parseInt(l)+1).replace(RegExp(u.substr(0,3),"ig"),parseInt(l)+1)}}var h=e.replace(/-/g,"/").replace(/\./g,"/").toLowerCase().split("/"),f=t.replace(/-/g,"/").replace(/\./g,"/").toLowerCase();"mm/dd/yyyy"===f&&(n=h[0],a=h[1],o=h[2]),"m/d/yyyy"===f&&(n=h[0],a=h[1],o=h[2]),"dd/mm/yyyy"===f&&(n=h[1],a=h[0],o=h[2]),"d/m/yyyy"===f&&(n=h[1],a=h[0],o=h[2]),"yyyy/dd/mm"===f&&(n=h[2],a=h[1],o=h[0]),"yyyy/d/m"===f&&(n=h[2],a=h[1],o=h[0]),"yyyy/mm/dd"===f&&(n=h[1],a=h[2],o=h[0]),"yyyy/m/d"===f&&(n=h[1],a=h[2],o=h[0]),"mm/dd/yy"===f&&(n=h[0],a=h[1],o=h[2]),"m/d/yy"===f&&(n=h[0],a=h[1],o=parseInt(h[2])+1900),"dd/mm/yy"===f&&(n=h[1],a=h[0],o=parseInt(h[2])+1900),"d/m/yy"===f&&(n=h[1],a=h[0],o=parseInt(h[2])+1900),"yy/dd/mm"===f&&(n=h[2],a=h[1],o=parseInt(h[0])+1900),"yy/d/m"===f&&(n=h[2],a=h[1],o=parseInt(h[0])+1900),"yy/mm/dd"===f&&(n=h[1],a=h[2],o=parseInt(h[0])+1900),"yy/m/d"===f&&(n=h[1],a=h[2],o=parseInt(h[0])+1900)}return i(o)&&i(n)&&i(a)?(o=+o,n=+n,a=+a,r=new Date(o,n-1,a),null==n?!1:"Invalid Date"===r?!1:r.getMonth()+1!==n||r.getDate()!==a||r.getFullYear()!==o?!1:s===!0?r:!0):!1}function d(e,t){if(null==e)return!1;var i,s;e=String(e),e=e.toUpperCase(),s=e.indexOf("PM")>=0;var r=s||e.indexOf("AM")>=0;i=r?12:24,e=e.replace("AM","").replace("PM",""),e=$.trim(e);var n=e.split(":"),a=parseInt(n[0]||0),o=parseInt(n[1]||0);return r&&1===n.length||2===n.length?""===n[0]||0>a||a>i||!this.isInt(n[0])||n[0].length>2?!1:2===n.length&&(""===n[1]||0>o||o>59||!this.isInt(n[1])||2!==n[1].length)?!1:r||i!==a||0===o?r&&1===n.length&&0===a?!1:t===!0?(s&&(a+=12),{hours:a,minutes:o}):!0:!1:!1}function u(e){if(""===e||null==e)return"";var t=new Date(e);if(w2utils.isInt(e)&&(t=new Date(Number(e))),"Invalid Date"===t)return"";var i=new Date,s=(i.getTime()-t.getTime())/1e3,r="",n="";return 0>s?(r='<span style="color: #aaa">future</span>',n=""):60>s?(r=Math.floor(s),n="sec",0>s&&(r=0,n="sec")):3600>s?(r=Math.floor(s/60),n="min"):86400>s?(r=Math.floor(s/60/60),n="hour"):2592e3>s?(r=Math.floor(s/24/60/60),n="day"):31557600>s?(r=Math.floor(s/365.25/24/60/60*10)/10,n="month"):s>=31557600&&(r=Math.floor(s/365.25/24/60/60*10)/10,n="year"),r+" "+n+(r>1?"s":"")}function h(e){if(""===e||null==e)return"";var t=new Date(e);if(w2utils.isInt(e)&&(t=new Date(Number(e))),"Invalid Date"===t)return"";var i=w2utils.settings.shortmonths,s=new Date,r=new Date;r.setTime(r.getTime()-864e5);var n=i[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear(),a=i[s.getMonth()]+" "+s.getDate()+", "+s.getFullYear(),o=i[r.getMonth()]+" "+r.getDate()+", "+r.getFullYear(),l=t.getHours()-(t.getHours()>12?12:0)+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+" "+(t.getHours()>=12?"pm":"am"),d=t.getHours()-(t.getHours()>12?12:0)+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()+" "+(t.getHours()>=12?"pm":"am"),u=n;return n===a&&(u=l),n===o&&(u=w2utils.lang("Yesterday")),'<span title="'+n+" "+d+'">'+u+"</span>"}function f(e){if(!w2utils.isFloat(e)||""===e)return"";if(e=parseFloat(e),0===e)return 0;var t=["Bt","KB","MB","GB","TB"],i=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return(Math.floor(e/Math.pow(1024,i)*10)/10).toFixed(0===i?0:1)+" "+t[i]}function c(t,i,s){var r="";return null==i&&(i=w2utils.settings.groupSymbol||","),null==s&&(s=w2utils.settings.decimalSymbol||"."),(w2utils.isFloat(t)||w2utils.isInt(t)||w2utils.isMoney(t))&&(e=String(t).split("."),r=String(e[0]).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+i),null!=e[1]&&(r+=w2utils.settings.decimalSymbol+e[1])),r}function p(e,t){w2utils.settings.shortmonths,w2utils.settings.fullmonths;if(t||(t=this.settings.date_format),""===e||null==e||"object"==typeof e&&!e.getMonth)return"";var r=new Date(e);if(w2utils.isInt(e)&&(r=new Date(Number(e))),"Invalid Date"===r)return"";var n=r.getFullYear(),a=r.getMonth(),o=r.getDate();return t.toLowerCase().replace("month",w2utils.settings.fullmonths[a]).replace("mon",w2utils.settings.shortmonths[a]).replace(/yyyy/g,n).replace(/yyy/g,n).replace(/yy/g,n>2e3?100+parseInt(String(n).substr(2)):String(n).substr(2)).replace(/(^|[^a-z$])y/g,"$1"+n).replace(/mm/g,(10>a+1?"0":"")+(a+1)).replace(/dd/g,(10>o?"0":"")+o).replace(/th/g,1==o?"st":"th").replace(/th/g,2==o?"nd":"th").replace(/th/g,3==o?"rd":"th").replace(/(^|[^a-z$])m/g,"$1"+(a+1)).replace(/(^|[^a-z$])d/g,"$1"+o)}function g(e,t){w2utils.settings.shortmonths,w2utils.settings.fullmonths;if(t||(t=this.settings.time_format),""===e||null==e||"object"==typeof e&&!e.getMonth)return"";var r=new Date(e);if(w2utils.isInt(e)&&(r=new Date(Number(e))),w2utils.isTime(e)){var n=w2utils.isTime(e,!0);r=new Date,r.setHours(n.hours),r.setMinutes(n.minutes)}if("Invalid Date"===r)return"";var a="am",o=r.getHours(),l=r.getHours(),d=r.getMinutes(),u=r.getSeconds();return 10>d&&(d="0"+d),10>u&&(u="0"+u),(-1!==t.indexOf("am")||-1!==t.indexOf("pm"))&&(o>=12&&(a="pm"),o>12&&(o-=12)),t.toLowerCase().replace("am",a).replace("pm",a).replace("hhh",10>o?"0"+o:o).replace("hh24",10>l?"0"+l:l).replace("h24",l).replace("hh",o).replace("mm",d).replace("mi",d).replace("ss",u).replace(/(^|[^a-z$])h/g,"$1"+o).replace(/(^|[^a-z$])m/g,"$1"+d).replace(/(^|[^a-z$])s/g,"$1"+u)}function m(e,t){var i;return""===e||null==e||"object"==typeof e&&!e.getMonth?"":(i="string"!=typeof t?[this.settings.date_format,this.settings.time_format]:t.split("|"),this.formatDate(e,i[0])+" "+this.formatTime(e,i[1]))}function v(e){if(null===e)return e;switch(typeof e){case"number":break;case"string":e=$.trim(String(e).replace(/(<([^>]+)>)/gi,""));break;case"object":for(var t in e)e[t]=this.stripTags(e[t])}return e}function w(e){if(null===e)return e;switch(typeof e){case"number":break;case"string":e=String(e).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");break;case"object":for(var t in e)e[t]=this.encodeTags(e[t])}return e}function y(e){return""===e||null==e?"":String(e).replace(/([;&,\.\+\*\~'`:"\!\^#$%@\[\]\(\)=<>\|\/? {}\\])/g,"\\$1")}function b(e){function h(e){for(var e=String(e).replace(/\r\n/g,"\n"),t="",i=0;i<e.length;i++){var s=e.charCodeAt(i);128>s?t+=String.fromCharCode(s):s>127&&2048>s?(t+=String.fromCharCode(s>>6|192),t+=String.fromCharCode(63&s|128)):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128),t+=String.fromCharCode(63&s|128))}return t}var i,s,r,n,a,o,l,t="",d=0,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=h(e);d<e.length;)i=e.charCodeAt(d++),s=e.charCodeAt(d++),r=e.charCodeAt(d++),n=i>>2,a=(3&i)<<4|s>>4,o=(15&s)<<2|r>>6,l=63&r,isNaN(s)?o=l=64:isNaN(r)&&(l=64),t=t+u.charAt(n)+u.charAt(a)+u.charAt(o)+u.charAt(l);return t}function x(e){function h(e){for(var r,n,t="",i=0,s=0;i<e.length;)s=e.charCodeAt(i),128>s?(t+=String.fromCharCode(s),i++):s>191&&224>s?(r=e.charCodeAt(i+1),t+=String.fromCharCode((31&s)<<6|63&r),i+=2):(r=e.charCodeAt(i+1),n=e.charCodeAt(i+2),t+=String.fromCharCode((15&s)<<12|(63&r)<<6|63&n),i+=3);return t}var i,s,r,n,a,o,l,t="",d=0,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<e.length;)n=u.indexOf(e.charAt(d++)),a=u.indexOf(e.charAt(d++)),o=u.indexOf(e.charAt(d++)),l=u.indexOf(e.charAt(d++)),i=n<<2|a>>4,s=(15&a)<<4|o>>2,r=(3&o)<<6|l,t+=String.fromCharCode(i),64!==o&&(t+=String.fromCharCode(s)),64!==l&&(t+=String.fromCharCode(r));return t=h(t)}function _(e,t,i,s){function o(e,t,i){var s=!!window.webkitURL;return s||"undefined"==typeof i||(t=i),";"+e+": "+t+"; -webkit-"+e+": "+t+"; -moz-"+e+": "+t+"; -ms-"+e+": "+t+"; -o-"+e+": "+t+";"}var r=$(e).width(),n=$(e).height(),a=.5;if(!e||!t)return void console.log("ERROR: Cannot do transition when one of the divs is null");switch(e.parentNode.style.cssText+=o("perspective","700px")+"; overflow: hidden;",e.style.cssText+="; position: absolute; z-index: 1019; "+o("backface-visibility","hidden"),t.style.cssText+="; position: absolute; z-index: 1020; "+o("backface-visibility","hidden"),i){case"slide-left":e.style.cssText+="overflow: hidden; "+o("transform","translate3d(0, 0, 0)","translate(0, 0)"),t.style.cssText+="overflow: hidden; "+o("transform","translate3d("+r+"px, 0, 0)","translate("+r+"px, 0)"),$(t).show(),window.setTimeout(function(){t.style.cssText+=o("transition",a+"s")+";"+o("transform","translate3d(0, 0, 0)","translate(0, 0)"),e.style.cssText+=o("transition",a+"s")+";"+o("transform","translate3d(-"+r+"px, 0, 0)","translate(-"+r+"px, 0)")},1);break;case"slide-right":e.style.cssText+="overflow: hidden; "+o("transform","translate3d(0, 0, 0)","translate(0, 0)"),t.style.cssText+="overflow: hidden; "+o("transform","translate3d(-"+r+"px, 0, 0)","translate(-"+r+"px, 0)"),$(t).show(),window.setTimeout(function(){t.style.cssText+=o("transition",a+"s")+"; "+o("transform","translate3d(0px, 0, 0)","translate(0px, 0)"),e.style.cssText+=o("transition",a+"s")+"; "+o("transform","translate3d("+r+"px, 0, 0)","translate("+r+"px, 0)")},1);break;case"slide-down":e.style.cssText+="overflow: hidden; z-index: 1; "+o("transform","translate3d(0, 0, 0)","translate(0, 0)"),t.style.cssText+="overflow: hidden; z-index: 0; "+o("transform","translate3d(0, 0, 0)","translate(0, 0)"),$(t).show(),window.setTimeout(function(){t.style.cssText+=o("transition",a+"s")+"; "+o("transform","translate3d(0, 0, 0)","translate(0, 0)"),e.style.cssText+=o("transition",a+"s")+"; "+o("transform","translate3d(0, "+n+"px, 0)","translate(0, "+n+"px)")},1);break;case"slide-up":e.style.cssText+="overflow: hidden; "+o("transform","translate3d(0, 0, 0)","translate(0, 0)"),t.style.cssText+="overflow: hidden; "+o("transform","translate3d(0, "+n+"px, 0)","translate(0, "+n+"px)"),$(t).show(),window.setTimeout(function(){t.style.cssText+=o("transition",a+"s")+"; "+o("transform","translate3d(0, 0, 0)","translate(0, 0)"),e.style.cssText+=o("transition",a+"s")+"; "+o("transform","translate3d(0, 0, 0)","translate(0, 0)")},1);break;case"flip-left":e.style.cssText+="overflow: hidden; "+o("transform","rotateY(0deg)"),t.style.cssText+="overflow: hidden; "+o("transform","rotateY(-180deg)"),$(t).show(),window.setTimeout(function(){t.style.cssText+=o("transition",a+"s")+"; "+o("transform","rotateY(0deg)"),e.style.cssText+=o("transition",a+"s")+"; "+o("transform","rotateY(180deg)")},1);break;case"flip-right":e.style.cssText+="overflow: hidden; "+o("transform","rotateY(0deg)"),t.style.cssText+="overflow: hidden; "+o("transform","rotateY(180deg)"),$(t).show(),window.setTimeout(function(){t.style.cssText+=o("transition",a+"s")+"; "+o("transform","rotateY(0deg)"),e.style.cssText+=o("transition",a+"s")+"; "+o("transform","rotateY(-180deg)")},1);break;case"flip-down":e.style.cssText+="overflow: hidden; "+o("transform","rotateX(0deg)"),t.style.cssText+="overflow: hidden; "+o("transform","rotateX(180deg)"),$(t).show(),window.setTimeout(function(){t.style.cssText+=o("transition",a+"s")+"; "+o("transform","rotateX(0deg)"),e.style.cssText+=o("transition",a+"s")+"; "+o("transform","rotateX(-180deg)")},1);break;case"flip-up":e.style.cssText+="overflow: hidden; "+o("transform","rotateX(0deg)"),t.style.cssText+="overflow: hidden; "+o("transform","rotateX(-180deg)"),$(t).show(),window.setTimeout(function(){t.style.cssText+=o("transition",a+"s")+"; "+o("transform","rotateX(0deg)"),e.style.cssText+=o("transition",a+"s")+"; "+o("transform","rotateX(180deg)")},1);break;case"pop-in":e.style.cssText+="overflow: hidden; "+o("transform","translate3d(0, 0, 0)","translate(0, 0)"),t.style.cssText+="overflow: hidden; "+o("transform","translate3d(0, 0, 0)","translate(0, 0)")+"; "+o("transform","scale(.8)")+"; opacity: 0;",$(t).show(),window.setTimeout(function(){t.style.cssText+=o("transition",a+"s")+"; "+o("transform","scale(1)")+"; opacity: 1;",e.style.cssText+=o("transition",a+"s")+";"},1);break;case"pop-out":e.style.cssText+="overflow: hidden; "+o("transform","translate3d(0, 0, 0)","translate(0, 0)")+"; "+o("transform","scale(1)")+"; opacity: 1;",t.style.cssText+="overflow: hidden; "+o("transform","translate3d(0, 0, 0)","translate(0, 0)")+"; opacity: 0;",$(t).show(),window.setTimeout(function(){t.style.cssText+=o("transition",a+"s")+"; opacity: 1;",e.style.cssText+=o("transition",a+"s")+"; "+o("transform","scale(1.7)")+"; opacity: 0;"},1);break;default:e.style.cssText+="overflow: hidden; "+o("transform","translate3d(0, 0, 0)","translate(0, 0)"),t.style.cssText+="overflow: hidden; "+o("transform","translate3d(0, 0, 0)","translate(0, 0)")+"; opacity: 0;",$(t).show(),window.setTimeout(function(){t.style.cssText+=o("transition",a+"s")+"; opacity: 1;",e.style.cssText+=o("transition",a+"s")},1)}setTimeout(function(){"slide-down"===i&&($(e).css("z-index","1019"),$(t).css("z-index","1020")),t&&$(t).css({opacity:"1","-webkit-transition":"","-moz-transition":"","-ms-transition":"","-o-transition":"","-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":"","-webkit-backface-visibility":"","-moz-backface-visibility":"","-ms-backface-visibility":"","-o-backface-visibility":""}),e&&($(e).css({opacity:"1","-webkit-transition":"","-moz-transition":"","-ms-transition":"","-o-transition":"","-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":"","-webkit-backface-visibility":"","-moz-backface-visibility":"","-ms-backface-visibility":"","-o-backface-visibility":""}),e.parentNode&&$(e.parentNode).css({"-webkit-perspective":"","-moz-perspective":"","-ms-perspective":"","-o-perspective":""})),"function"==typeof s&&s()},1e3*a)}function k(e,t,i){var s={};"object"==typeof t?s=t:(s.msg=t,s.spinner=i),s.msg||0===s.msg||(s.msg=""),w2utils.unlock(e),$(e).prepend('<div class="w2ui-lock"></div><div class="w2ui-lock-msg"></div>');var r=$(e).find(".w2ui-lock"),n=$(e).find(".w2ui-lock-msg");s.msg||n.css({"background-color":"transparent",border:"0px"}),s.spinner===!0&&(s.msg='<div class="w2ui-spinner" '+(s.msg?"":'style="width: 35px; height: 35px"')+"></div>"+s.msg),null!=s.opacity&&r.css("opacity",s.opacity),"function"==typeof r.fadeIn?(r.fadeIn(200),n.html(s.msg).fadeIn(200)):(r.show(),n.html(s.msg).show(0)),$().w2tag()}function C(e){$(e).find(".w2ui-lock").remove(),$(e).find(".w2ui-lock-msg").remove()}function T(e,t){var i=$(e),s={left:parseInt(i.css("border-left-width"))||0,right:parseInt(i.css("border-right-width"))||0,top:parseInt(i.css("border-top-width"))||0,bottom:parseInt(i.css("border-bottom-width"))||0},r={left:parseInt(i.css("margin-left"))||0,right:parseInt(i.css("margin-right"))||0,top:parseInt(i.css("margin-top"))||0,bottom:parseInt(i.css("margin-bottom"))||0},n={left:parseInt(i.css("padding-left"))||0,right:parseInt(i.css("padding-right"))||0,top:parseInt(i.css("padding-top"))||0,bottom:parseInt(i.css("padding-bottom"))||0};switch(t){case"top":return s.top+r.top+n.top;case"bottom":return s.bottom+r.bottom+n.bottom;case"left":return s.left+r.left+n.left;case"right":return s.right+r.right+n.right;case"width":return s.left+s.right+r.left+r.right+n.left+n.right+parseInt(i.width());case"height":return s.top+s.bottom+r.top+r.bottom+n.top+n.bottom+parseInt(i.height());case"+width":return s.left+s.right+r.left+r.right+n.left+n.right;case"+height":return s.top+s.bottom+r.top+r.bottom+n.top+n.bottom}return 0}function z(e){var t=this.settings.phrases[e];return null==t?e:t}function S(e){e||(e="en-us"),5===e.length&&(e="locale/"+e+".json"),$.ajax({url:e,type:"GET",dataType:"JSON",async:!1,cache:!1,success:function(e){w2utils.settings=$.extend(!0,w2utils.settings,e);var s=w2obj.grid.prototype;for(var r in s.buttons)s.buttons[r].caption=w2utils.lang(s.buttons[r].caption),s.buttons[r].hint=w2utils.lang(s.buttons[r].hint);s.msgDelete=w2utils.lang(s.msgDelete),s.msgNotJSON=w2utils.lang(s.msgNotJSON),s.msgRefresh=w2utils.lang(s.msgRefresh)},error:function(){console.log("ERROR: Cannot load locale "+e)}})}function D(){if(e.scrollBarSize)return e.scrollBarSize;var t='<div id="_scrollbar_width" style="position: absolute; top: -300px; width: 100px; height: 100px; overflow-y: scroll;">    <div style="height: 120px">1</div></div>';return $("body").append(t),e.scrollBarSize=100-$("#_scrollbar_width > div").width(),$("#_scrollbar_width").remove(),String(navigator.userAgent).indexOf("MSIE")>=0&&(e.scrollBarSize=e.scrollBarSize/2),e.scrollBarSize}function I(e,t){return e&&"undefined"!=typeof e.name?"undefined"!=typeof w2ui[e.name]?(console.log('ERROR: The parameter "name" is not unique. There are other objects already created with the same name (obj: '+e.name+")."),!1):w2utils.isAlphaNumeric(e.name)?!0:(console.log('ERROR: The parameter "name" has to be alpha-numeric (a-z, 0-9, dash and underscore). '),!1):(console.log('ERROR: The parameter "name" is required but not supplied in $().'+t+"()."),!1)}function R(e,t,i,s){$.isArray(t)||(t=[t]);for(var r=0;r<t.length;r++)if(t[r].id===e)return console.log('ERROR: The parameter "id='+e+'" is not unique within the current '+i+". (obj: "+s+")"),!1;return!0}function O(e){var t=[],i=e.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(e,i,s,r,n,a){return t.push({name:r,optional:!!a}),i=i||"",""+(a?"":i)+"(?:"+(a?i:"")+(s||"")+(n||s&&"([^/.]+?)"||"([^/]+?)")+")"+(a||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return{path:new RegExp("^"+i+"$","i"),keys:t}}var e={},t={version:"1.4.2",settings:{locale:"en-us",date_format:"m/d/yyyy",date_display:"Mon d, yyyy",time_format:"hh:mi pm",currencyPrefix:"$",currencySuffix:"",currencyPrecision:2,groupSymbol:",",decimalSymbol:".",shortmonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fullmonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortdays:["M","T","W","T","F","S","S"],fulldays:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],dataType:"HTTP",phrases:{}},isInt:i,isFloat:s,isMoney:r,isHex:n,isAlphaNumeric:a,isEmail:o,isDate:l,isTime:d,age:u,date:h,size:f,formatNumber:c,formatDate:p,formatTime:g,formatDateTime:m,stripTags:v,encodeTags:w,escapeId:y,base64encode:b,base64decode:x,transition:_,lock:k,unlock:C,lang:z,locale:S,getSize:T,scrollBarSize:D,checkName:I,checkUniqueId:R,parseRoute:O,isIOS:-1!=navigator.userAgent.toLowerCase().indexOf("iphone")||-1!=navigator.userAgent.toLowerCase().indexOf("ipod")||-1!=navigator.userAgent.toLowerCase().indexOf("ipad")?!0:!1,isIE:-1!=navigator.userAgent.toLowerCase().indexOf("msie")||-1!=navigator.userAgent.toLowerCase().indexOf("trident")?!0:!1};return t}();w2utils.event={on:function(e,t){return $.isPlainObject(e)||(e={type:e}),e=$.extend({type:null,execute:"before",target:null,onComplete:null},e),e.type?t?($.isArray(this.handlers)||(this.handlers=[]),void this.handlers.push({event:e,handler:t})):void console.log("ERROR: You must specify event handler function when calling .on() method of "+this.name):void console.log("ERROR: You must specify event type when calling .on() method of "+this.name)},off:function(e,t){if($.isPlainObject(e)||(e={type:e}),e=$.extend({},{type:null,execute:"before",target:null,onComplete:null},e),!e.type)return void console.log("ERROR: You must specify event type when calling .off() method of "+this.name);t||(t=null);for(var i=[],s=0,r=this.handlers.length;r>s;s++){var n=this.handlers[s];(n.event.type!==e.type&&"*"!==e.type||n.event.target!==e.target&&null!==e.target||n.handler!==t&&null!==t)&&i.push(n)}this.handlers=i},trigger:function(e){var e=$.extend({type:null,phase:"before",target:null},e,{isStopped:!1,isCancelled:!1,preventDefault:function(){this.isCancelled=!0},stopPropagation:function(){this.isStopped=!0}});"before"===e.phase&&(e.onComplete=null);var t,i,s;null==e.target&&(e.target=null),$.isArray(this.handlers)||(this.handlers=[]);for(var r=this.handlers.length-1;r>=0;r--){var n=this.handlers[r];if(!(n.event.type!==e.type&&"*"!==n.event.type||n.event.target!==e.target&&null!==n.event.target||n.event.execute!==e.phase&&"*"!==n.event.execute&&"*"!==n.event.phase)&&(e=$.extend({},n.event,e),t=[],s=RegExp(/\((.*?)\)/).exec(n.handler),s&&(t=s[1].split(/\s*,\s*/)),2===t.length?n.handler.call(this,e.target,e):n.handler.call(this,e),e.isStopped===!0||e.stop===!0))return e}var a="on"+e.type.substr(0,1).toUpperCase()+e.type.substr(1);return"before"===e.phase&&"function"==typeof this[a]&&(i=this[a],t=[],s=RegExp(/\((.*?)\)/).exec(i),s&&(t=s[1].split(/\s*,\s*/)),2===t.length?i.call(this,e.target,e):i.call(this,e),e.isStopped===!0||e.stop===!0)?e:null!=e.object&&"before"===e.phase&&"function"==typeof e.object[a]&&(i=e.object[a],t=[],s=RegExp(/\((.*?)\)/).exec(i),s&&(t=s[1].split(/\s*,\s*/)),2===t.length?i.call(this,e.target,e):i.call(this,e),e.isStopped===!0||e.stop===!0)?e:("after"===e.phase&&"function"==typeof e.onComplete&&e.onComplete.call(this,e),e)}},w2utils.keyboard=function(e){function i(){$(document).on("keydown",s),$(document).on("mousedown",r)}function s(e){var i=e.target.tagName;-1===$.inArray(i,["INPUT","SELECT","TEXTAREA"])&&"true"!==$(e.target).prop("contenteditable")&&t&&w2ui[t]&&"function"==typeof w2ui[t].keydown&&w2ui[t].keydown.call(w2ui[t],e)}function r(e){var s=(e.target.tagName,$(e.target).parents(".w2ui-reset"));if(s.length>0){var r=s.attr("name");w2ui[r]&&w2ui[r].keyboard&&(t=r)}}function n(e){return"undefined"!=typeof e&&(t=e),t}function a(){t=null}var t=null;return e.active=n,e.clear=a,i(),e}({}),function(){$.fn.w2render=function(e){$(this).length>0&&("string"==typeof e&&w2ui[e]&&w2ui[e].render($(this)[0]),"object"==typeof e&&e.render($(this)[0]))},$.fn.w2destroy=function(e){!e&&this.length>0&&(e=this.attr("name")),"string"==typeof e&&w2ui[e]&&w2ui[e].destroy(),"object"==typeof e&&e.destroy()},$.fn.w2marker=function(e){return $(this).each(""===e||null==e?function(e,t){t.innerHTML=t.innerHTML.replace(/\<span class=\"w2ui\-marker\"\>(.*)\<\/span\>/gi,"$1")}:function(t,i){function a(e){return'<span class="w2ui-marker">'+e+"</span>"}"string"==typeof e&&(e=[e]),i.innerHTML=i.innerHTML.replace(/\<span class=\"w2ui\-marker\"\>(.*)\<\/span\>/gi,"$1");for(var s in e){var r=e[s];"string"!=typeof r&&(r=String(r)),r=r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&").replace(/&/g,"&amp;").replace(/</g,"&gt;").replace(/>/g,"&lt;");var n=new RegExp(r+"(?!([^<]+)?>)","gi");i.innerHTML=i.innerHTML.replace(n,a)}})},$.fn.w2tag=function(e,t){return $.isPlainObject(t)||(t={}),$.isPlainObject(t.css)||(t.css={}),"undefined"==typeof t["class"]&&(t["class"]=""),0===$(this).length?void $(".w2ui-tag").each(function(e,t){var i=$(t).data("options");null==i&&(i={}),$($(t).data("taged-el")).removeClass(i["class"]),clearInterval($(t).data("timer")),$(t).remove()}):$(this).each(function(i,s){function l(){$tag=$("#w2ui-tag-"+n),$tag.length<=0||(clearInterval($tag.data("timer")),$tag.remove(),$(s).off("keypress",l).removeClass(t["class"]),$(s).length>0&&($(s)[0].style.cssText=o),"function"==typeof t.onHide&&t.onHide())}var r=s.id,n=w2utils.escapeId(s.id);if(""===e||null==e)$("#w2ui-tag-"+n).css("opacity",0),setTimeout(function(){clearInterval($("#w2ui-tag-"+n).data("timer")),$("#w2ui-tag-"+n).remove()},300);else{clearInterval($("#w2ui-tag-"+n).data("timer")),$("#w2ui-tag-"+n).remove(),$("body").append('<div id="w2ui-tag-'+r+'" class="w2ui-tag '+($(s).parents(".w2ui-popup").length>0?"w2ui-tag-popup":"")+'" style=""></div>');var a=setInterval(function(){return 0===$(s).length||0===$(s).offset().left&&0===$(s).offset().top?(clearInterval($("#w2ui-tag-"+n).data("timer")),void l()):void($("#w2ui-tag-"+n).data("position")!==$(s).offset().left+s.offsetWidth+"x"+$(s).offset().top&&$("#w2ui-tag-"+n).css({"-webkit-transition":".2s","-moz-transition":".2s","-ms-transition":".2s","-o-transition":".2s",left:$(s).offset().left+s.offsetWidth+"px",top:$(s).offset().top+"px"}).data("position",$(s).offset().left+s.offsetWidth+"x"+$(s).offset().top))},100);setTimeout(function(){$(s).offset()&&($("#w2ui-tag-"+n).css({opacity:"1",left:$(s).offset().left+s.offsetWidth+"px",top:$(s).offset().top+"px"}).html('<div style="margin-top: -2px 0px 0px -2px; white-space: nowrap;"> <div class="w2ui-tag-body">'+e+"</div> </div>").data("text",e).data("taged-el",s).data("options",t).data("position",$(s).offset().left+s.offsetWidth+"x"+$(s).offset().top).data("timer",a),$(s).off("keypress",l).on("keypress",l).off("change",l).on("change",l).css(t.css).addClass(t["class"]),"function"==typeof t.onShow&&t.onShow())},1);var o="";$(s).length>0&&(o=$(s)[0].style.cssText)}})},$.fn.w2overlay=function(e,t){function d(){var e=$("#w2ui-overlay"+s);if(e.data("element")===i[0]&&0!==e.length){var t=$(i).offset().left+"x"+$(i).offset().top;e.data("position")!==t?u():setTimeout(d,250)}}function u(){var e=$("#w2ui-overlay"+s);if(e.data("keepOpen")===!0)return void e.removeData("keepOpen");var i;"function"==typeof t.onHide&&(i=t.onHide()),i!==!1&&(e.remove(),$(document).off("click",u),clearInterval(e.data("timer")))}function h(){var e=$("#w2ui-overlay"+s),r=e.find(" > div");if(e.length>0){r.height("auto").width("auto");var n=!1,a=!1,o=r.height(),l=r.width();switch(t.width&&t.width<l&&(l=t.width),30>l&&(l=30),t.tmp.contentHeight&&(o=t.tmp.contentHeight,r.height(o),setTimeout(function(){r.height()>r.find("div.menu > table").height()&&r.find("div.menu").css("overflow-y","hidden")},1),setTimeout(function(){r.find("div.menu").css("overflow-y","auto")},10)),t.tmp.contentWidth&&(l=t.tmp.contentWidth,r.width(l),setTimeout(function(){r.width()>r.find("div.menu > table").width()&&r.find("div.menu").css("overflow-x","hidden")},1),setTimeout(function(){r.find("div.menu").css("overflow-y","auto")},10)),t.align){case"both":t.left=17,0===t.width&&(t.width=w2utils.getSize($(i),"width"));break;case"left":t.left=17;break;case"right":t.tipLeft=l-45,t.left=w2utils.getSize($(i),"width")-l+10}var d=(l-17)/2,u=t.left,f=t.width,c=t.tipLeft;f=30!==l||f?t.width?t.width:"auto":30,25>d&&(u=25-d,c=Math.floor(d)),e.css({top:i.offset().top+w2utils.getSize(i,"height")+t.top+7+"px",left:(i.offset().left>25?i.offset().left:25)+u+"px","min-width":f,"min-height":t.height?t.height:"auto"});var p=window.innerHeight+$(document).scrollTop()-r.offset().top-7,g=window.innerWidth+$(document).scrollLeft()-r.offset().left-7;p>-50&&210>p||t.openAbove===!0?(p=r.offset().top-$(document).scrollTop()-7,t.maxHeight&&p>t.maxHeight&&(p=t.maxHeight),o>p&&(a=!0,r.height(p).width(l).css({"overflow-y":"auto"}),o=p),e.css("top",$(i).offset().top-o-24+t.top+"px"),e.find(">style").html("#w2ui-overlay"+s+":before { display: none; margin-left: "+parseInt(c)+"px; }#w2ui-overlay"+s+":after { display: block; margin-left: "+parseInt(c)+"px; }")):(t.maxHeight&&p>t.maxHeight&&(p=t.maxHeight),o>p&&(a=!0,r.height(p).width(l).css({"overflow-y":"auto"})),e.find(">style").html("#w2ui-overlay"+s+":before { display: block; margin-left: "+parseInt(c)+"px; }#w2ui-overlay"+s+":after { display: none; margin-left: "+parseInt(c)+"px; }")),l=r.width(),g=window.innerWidth+$(document).scrollLeft()-r.offset().left-7,t.maxWidth&&g>t.maxWidth&&(g=t.maxWidth),l>g&&"both"!==t.align&&(t.align="right",setTimeout(function(){h()},1)),a&&n&&r.width(l+w2utils.scrollBarSize()+2)}}var i=this,s="",r={name:null,html:"",align:"none",left:0,top:0,tipLeft:30,width:0,height:0,maxWidth:null,maxHeight:null,style:"","class":"",onShow:null,onHide:null,openAbove:!1,tmp:{}};1==arguments.length&&(t="object"==typeof e?e:{html:e}),2==arguments.length&&(t.html=e),$.isPlainObject(t)||(t={}),t=$.extend({},r,t),t.name&&(s="-"+t.name);var n;if(0===this.length||""===t.html||null==t.html)return $("#w2ui-overlay"+s).length>0?(n=$("#w2ui-overlay"+s)[0].hide,"function"==typeof n&&n()):$("#w2ui-overlay"+s).remove(),$(this);$("#w2ui-overlay"+s).length>0&&(n=$("#w2ui-overlay"+s)[0].hide,$(document).off("click",n),"function"==typeof n&&n()),$("body").append('<div id="w2ui-overlay'+s+'" style="display: none"        class="w2ui-reset w2ui-overlay '+($(this).parents(".w2ui-popup, .w2ui-overlay-popup").length>0?"w2ui-overlay-popup":"")+'">    <style></style>    <div style="'+t.style+'" class="'+t["class"]+'"></div></div>');var a=$("#w2ui-overlay"+s),o=a.find(" > div");o.html(t.html);var l=o.css("background-color");return null!=l&&"rgba(0, 0, 0, 0)"!==l&&"transparent"!==l&&a.css("background-color",l),a.data("element",i.length>0?i[0]:null).data("options",t).data("position",$(i).offset().left+"x"+$(i).offset().top).fadeIn("fast").on("mousedown",function(e){$("#w2ui-overlay"+s).data("keepOpen",!0),-1===["INPUT","TEXTAREA","SELECT"].indexOf(e.target.tagName)&&e.preventDefault()}),a[0].hide=u,a[0].resize=h,h(),setTimeout(function(){h(),$(document).off("click",u).on("click",u),"function"==typeof t.onShow&&t.onShow()},10),d(),$(this)},$.fn.w2menu=function(e,t){function d(){setTimeout(function(){$("#w2ui-overlay"+r+" tr.w2ui-selected").removeClass("w2ui-selected");var e=$("#w2ui-overlay"+r+" tr[index="+t.index+"]"),i=$("#w2ui-overlay"+r+" div.menu").scrollTop();if(e.addClass("w2ui-selected"),t.tmp&&(t.tmp.contentHeight=$("#w2ui-overlay"+r+" table").height()+(t.search?50:10)),t.tmp&&(t.tmp.contentWidth=$("#w2ui-overlay"+r+" table").width()),$("#w2ui-overlay"+r).length>0&&$("#w2ui-overlay"+r)[0].resize(),e.length>0){var s=e[0].offsetTop-5,n=$("#w2ui-overlay"+r+" div.menu"),a=n.height();$("#w2ui-overlay"+r+" div.menu").scrollTop(i),(i>s||s+e.height()>i+a)&&$("#w2ui-overlay"+r+" div.menu").animate({scrollTop:s-(a-2*e.height())/2},200,"linear")}},1)}function u(e){var i=this.value,n=e.keyCode,a=!1;switch(n){case 13:$("#w2ui-overlay"+r).remove(),$.fn.w2menuHandler(e,t.index);break;case 9:case 27:$("#w2ui-overlay"+r).remove(),$.fn.w2menuHandler(e,-1);break;case 38:for(t.index=w2utils.isInt(t.index)?parseInt(t.index):0,t.index--;t.index>0&&t.items[t.index].hidden;)t.index--;if(0===t.index&&t.items[t.index].hidden)for(;t.items[t.index]&&t.items[t.index].hidden;)t.index++;t.index<0&&(t.index=0),a=!0;break;case 40:for(t.index=w2utils.isInt(t.index)?parseInt(t.index):0,t.index++;t.index<t.items.length-1&&t.items[t.index].hidden;)t.index++;if(t.index===t.items.length-1&&t.items[t.index].hidden)for(;t.items[t.index]&&t.items[t.index].hidden;)t.index--;t.index>=t.items.length&&(t.index=t.items.length-1),a=!0}if(!a){var o=0;for(var l in t.items){var u=t.items[l],h="",f="";-1!==["is","begins with"].indexOf(t.match)&&(h="^"),-1!==["is","ends with"].indexOf(t.match)&&(f="$");try{var c=new RegExp(h+i+f,"i");u.hidden=c.test(u.text)||"..."===u.text?!1:!0}catch(p){}"enum"===s.type&&-1!==$.inArray(u.id,ids)&&(u.hidden=!0),u.hidden!==!0&&o++}for(t.index=0;t.index<t.items.length-1&&t.items[t.index].hidden;)t.index++;0>=o&&(t.index=-1)}$(s).w2menu("refresh",t),d()
}function h(){if(t.spinner)return'<table class="w2ui-drop-menu"><tr><td style="padding: 5px 10px 10px 10px; text-align: center">    <div class="w2ui-spinner" style="width: 18px; height: 18px; position: relative; top: 5px;"></div>     <div style="display: inline-block; padding: 3px; color: #999;">'+w2utils.lang("Loading...")+"</div></td></tr></table>";for(var e=0,i='<table cellspacing="0" cellpadding="0" class="w2ui-drop-menu">',s=null,n=null,a=0;a<t.items.length;a++){var o=t.items[a];if("string"==typeof o?o={id:o,text:o}:(null!=o.text&&null==o.id&&(o.id=o.text),null==o.text&&null!=o.id&&(o.text=o.id),null!=o.caption&&(o.text=o.caption),s=o.img,n=o.icon,null==s&&(s=null),null==n&&(n=null)),o.hidden!==!0){var l="",d=o.text;if("function"==typeof t.render&&(d=t.render(o,t)),s&&(l='<td class="menu-icon"><div class="w2ui-tb-image w2ui-icon '+s+'"></div></td>'),n&&(l='<td class="menu-icon" align="center"><span class="w2ui-icon '+n+'"></span></td>'),"undefined"==typeof d||""===d||/^-+$/.test(d))i+='<tr><td colspan="2" style="padding: 6px; pointer-events: none"><div style="border-top: 1px solid silver;"></div></td></tr>';else{var u=e%2===0?"w2ui-item-even":"w2ui-item-odd";t.altRows!==!0&&(u="");var h=1;""==l&&h++,null==o.count&&h++,i+='<tr index="'+a+'" style="'+(o.style?o.style:"")+'"         class="'+u+" "+(t.index===a?"w2ui-selected":"")+" "+(o.disabled===!0?"w2ui-disabled":"")+"\"        onmousedown=\"$(this).parent().find('tr').removeClass('w2ui-selected'); $(this).addClass('w2ui-selected');\"        onclick=\"event.stopPropagation();                if ("+(o.disabled===!0?"true":"false")+") return;               $('#w2ui-overlay"+r+"').remove();                $.fn.w2menuHandler(event, '"+a+"');\">"+l+'   <td class="menu-text" colspan="'+h+'">'+d+'</td>   <td class="menu-count">'+(null!=o.count?"<span>"+o.count+"</span>":"")+"</td></tr>",e++}}t.items[a]=o}return 0===e&&(i+='<tr><td style="padding: 13px; color: #999; text-align: center">'+t.msgNoItems+"</div></td></tr>"),i+="</table>"}var i={index:null,items:[],render:null,msgNoItems:"No items",onSelect:null,tmp:{}},s=this,r="";if("refresh"!==e){1===arguments.length?t=e:t.items=e,"object"!=typeof t&&(t={}),t=$.extend({},i,t),$.fn.w2menuOptions=t,t.name&&(r="-"+t.name),"function"==typeof t.select&&"function"!=typeof t.onSelect&&(t.onSelect=t.select),"function"==typeof t.onRender&&"function"!=typeof t.render&&(t.render=t.onRender),$.fn.w2menuHandler=function(e,i){"function"==typeof t.onSelect&&setTimeout(function(){t.onSelect({index:i,item:t.items[i],originalEvent:e})},10)};var a="";if(t.search){a+='<div style="position: absolute; top: 0px; height: 40px; left: 0px; right: 0px; border-bottom: 1px solid silver; background-color: #ECECEC; padding: 8px 5px;">    <div class="w2ui-icon icon-search" style="position: absolute; margin-top: 4px; margin-left: 6px; width: 11px; background-position: left !important;"></div>    <input id="menu-search" type="text" style="width: 100%; outline: none; padding-left: 20px;" onclick="event.stopPropagation();"></div>',t.style+=";background-color: #ECECEC",t.index=0;for(var o in t.items)t.items[o].hidden=!1}a+='<div class="menu" style="position: absolute; top: '+(t.search?40:0)+'px; bottom: 0px; width: 100%; overflow: auto;">'+h()+"</div>";var l=$(this).w2overlay(a,t);return setTimeout(function(){if($("#w2ui-overlay"+r+" #menu-search").on("keyup",u).on("keydown",function(e){9===e.keyCode&&(e.stopPropagation(),e.preventDefault())}),t.search){if(-1!=["text","password"].indexOf($(s)[0].type)||"texarea"==$(s)[0].tagName)return;$("#w2ui-overlay"+r+" #menu-search").focus()}},200),d(),l}if($("#w2ui-overlay"+r).length>0){t=$.extend($.fn.w2menuOptions,t);var n=$("#w2ui-overlay"+r+" div.menu").scrollTop();$("#w2ui-overlay"+r+" div.menu").html(h()),$("#w2ui-overlay"+r+" div.menu").scrollTop(n),d()}else $(this).w2menu(t)}}(),function(){var w2grid=function(e){this.name=null,this.box=null,this.header="",this.url="",this.routeData={},this.columns=[],this.columnGroups=[],this.records=[],this.summary=[],this.searches=[],this.searchData=[],this.sortData=[],this.postData={},this.toolbar={},this.show={header:!1,toolbar:!1,footer:!1,columnHeaders:!0,lineNumbers:!1,expandColumn:!1,selectColumn:!1,emptyRecords:!0,toolbarReload:!0,toolbarColumns:!0,toolbarSearch:!0,toolbarAdd:!1,toolbarEdit:!1,toolbarDelete:!1,toolbarSave:!1,selectionBorder:!0,recordTitles:!0,skipRecords:!0},this.autoLoad=!0,this.fixedBody=!0,this.recordHeight=24,this.keyboard=!0,this.selectType="row",this.multiSearch=!0,this.multiSelect=!0,this.multiSort=!0,this.reorderColumns=!1,this.reorderRows=!1,this.markSearch=!0,this.total=0,this.limit=100,this.offset=0,this.style="",this.ranges=[],this.menu=[],this.method=null,this.recid=null,this.parser=null,this.onAdd=null,this.onEdit=null,this.onRequest=null,this.onLoad=null,this.onDelete=null,this.onDeleted=null,this.onSubmit=null,this.onSave=null,this.onSelect=null,this.onUnselect=null,this.onClick=null,this.onDblClick=null,this.onContextMenu=null,this.onMenuClick=null,this.onColumnClick=null,this.onColumnResize=null,this.onSort=null,this.onSearch=null,this.onChange=null,this.onRestore=null,this.onExpand=null,this.onCollapse=null,this.onError=null,this.onKeydown=null,this.onToolbar=null,this.onColumnOnOff=null,this.onCopy=null,this.onPaste=null,this.onSelectionExtend=null,this.onEditField=null,this.onRender=null,this.onRefresh=null,this.onReload=null,this.onResize=null,this.onDestroy=null,this.onStateSave=null,this.onStateRestore=null,this.last={field:"all",caption:w2utils.lang("All Fields"),logic:"OR",search:"",searchIds:[],selection:{indexes:[],columns:{}},multi:!1,scrollTop:0,scrollLeft:0,sortData:null,sortCount:0,xhr:null,range_start:null,range_end:null,sel_ind:null,sel_col:null,sel_type:null,edit_col:null},$.extend(!0,this,w2obj.grid,e)};$.fn.w2grid=function(e){if("object"==typeof e||!e){if(!w2utils.checkName(e,"w2grid"))return;var t=e.columns,i=e.columnGroups,s=e.records,r=e.searches,n=e.searchData,a=e.sortData,o=e.postData,l=e.toolbar,d=new w2grid(e);$.extend(d,{postData:{},records:[],columns:[],searches:[],toolbar:{},sortData:[],searchData:[],handlers:[]}),null!=d.onExpand&&(d.show.expandColumn=!0),$.extend(!0,d.toolbar,l);for(var u in t)d.columns[u]=$.extend(!0,{},t[u]);for(var u in i)d.columnGroups[u]=$.extend(!0,{},i[u]);for(var u in r)d.searches[u]=$.extend(!0,{},r[u]);for(var u in n)d.searchData[u]=$.extend(!0,{},n[u]);for(var u in a)d.sortData[u]=$.extend(!0,{},a[u]);d.postData=$.extend(!0,{},o);for(var h in s){if(null==s[h].recid||"undefined"==typeof s[h].recid)return void console.log("ERROR: Cannot add records without recid. (obj: "+d.name+")");d.records[h]=$.extend(!0,{},s[h])}for(var f in d.columns){var c=d.columns[f];if("undefined"!=typeof c.searchable&&null==d.getSearch(c.field)){var p=c.searchable,g="";c.searchable===!0&&(p="text",g='size="20"'),d.addSearch({field:c.field,caption:c.caption,type:p,attr:g})}}return d.initToolbar(),0!==$(this).length&&d.render($(this)[0]),w2ui[d.name]=d,d}if(w2ui[$(this).attr("name")]){var m=w2ui[$(this).attr("name")];return m[e].apply(m,Array.prototype.slice.call(arguments,1)),this}console.log("ERROR: Method "+e+" does not exist on jQuery.w2grid")},w2grid.prototype={msgDelete:w2utils.lang("Are you sure you want to delete selected records?"),msgNotJSON:w2utils.lang("Returned data is not in valid JSON format."),msgAJAXerror:w2utils.lang("AJAX error. See console for more details."),msgRefresh:w2utils.lang("Refreshing..."),buttons:{reload:{type:"button",id:"w2ui-reload",icon:"w2ui-icon-reload",hint:w2utils.lang("Reload data in the list")},columns:{type:"drop",id:"w2ui-column-on-off",icon:"w2ui-icon-columns",hint:w2utils.lang("Show/hide columns"),arrow:!1,html:""},search:{type:"html",id:"w2ui-search",html:'<div class="w2ui-icon icon-search-down w2ui-search-down" title="Select Search Field" onclick="var obj = w2ui[$(this).parents(\'div.w2ui-grid\').attr(\'name\')]; obj.searchShowFields();"></div>'},"search-go":{type:"check",id:"w2ui-search-advanced",caption:w2utils.lang("Search..."),hint:w2utils.lang("Open Search Fields")},add:{type:"button",id:"w2ui-add",caption:w2utils.lang("Add New"),hint:w2utils.lang("Add new record"),icon:"w2ui-icon-plus"},edit:{type:"button",id:"w2ui-edit",caption:w2utils.lang("Edit"),hint:w2utils.lang("Edit selected record"),icon:"w2ui-icon-pencil",disabled:!0},"delete":{type:"button",id:"w2ui-delete",caption:w2utils.lang("Delete"),hint:w2utils.lang("Delete selected records"),icon:"w2ui-icon-cross",disabled:!0},save:{type:"button",id:"w2ui-save",caption:w2utils.lang("Save"),hint:w2utils.lang("Save changed records"),icon:"w2ui-icon-check"}},add:function(e){$.isArray(e)||(e=[e]);var t=0;for(var i in e)this.recid||"undefined"!=typeof e[i].recid||(e[i].recid=e[i][this.recid]),null!=e[i].recid&&"undefined"!=typeof e[i].recid?(this.records.push(e[i]),t++):console.log("ERROR: Cannot add record without recid. (obj: "+this.name+")");var s="object"!=typeof this.url?this.url:this.url.get;return s||(this.total=this.records.length,this.localSort(),this.localSearch()),this.refresh(),t},find:function(e,t){("undefined"==typeof e||null==e)&&(e={});var i=[],s=!1;for(var r in e)-1!=String(r).indexOf(".")&&(s=!0);for(var n=0;n<this.records.length;n++){var a=!0;for(var r in e){var o=this.records[n][r];s&&-1!=String(r).indexOf(".")&&(o=this.parseField(this.records[n],r)),e[r]!=o&&(a=!1)}a&&t!==!0&&i.push(this.records[n].recid),a&&t===!0&&i.push(n)}return i},set:function(e,t,i){if("object"==typeof e&&(i=t,t=e,e=null),null==e){for(var s in this.records)$.extend(!0,this.records[s],t);i!==!0&&this.refresh()}else{var r=this.get(e,!0);if(null==r)return!1;var n=this.records[r]&&this.records[r].recid==e?!1:!0;n?$.extend(!0,this.summary[r],t):$.extend(!0,this.records[r],t),i!==!0&&this.refreshRow(e)}return!0},get:function(e,t){for(var i=0;i<this.records.length;i++)if(this.records[i].recid==e)return t===!0?i:this.records[i];for(var i=0;i<this.summary.length;i++)if(this.summary[i].recid==e)return t===!0?i:this.summary[i];return null},remove:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.records.length-1;i>=0;i--)this.records[i].recid==arguments[t]&&(this.records.splice(i,1),e++);var s="object"!=typeof this.url?this.url:this.url.get;return s||(this.localSort(),this.localSearch()),this.refresh(),e},addColumn:function(e,t){var i=0;1==arguments.length?(t=e,e=this.columns.length):("string"==typeof e&&(e=this.getColumn(e,!0)),null===e&&(e=this.columns.length)),$.isArray(t)||(t=[t]);for(var s in t)this.columns.splice(e,0,t[s]),e++,i++;return this.refresh(),i},removeColumn:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.columns.length-1;i>=0;i--)this.columns[i].field==arguments[t]&&(this.columns.splice(i,1),e++);return this.refresh(),e},getColumn:function(e,t){for(var i=0;i<this.columns.length;i++)if(this.columns[i].field==e)return t===!0?i:this.columns[i];return null},toggleColumn:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.columns.length-1;i>=0;i--){var s=this.columns[i];s.field==arguments[t]&&(s.hidden=!s.hidden,e++)}return this.refresh(),e},showColumn:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.columns.length-1;i>=0;i--){var s=this.columns[i];s.gridMinWidth&&delete s.gridMinWidth,s.field==arguments[t]&&s.hidden!==!1&&(s.hidden=!1,e++)}return this.refresh(),e},hideColumn:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.columns.length-1;i>=0;i--){var s=this.columns[i];s.field==arguments[t]&&s.hidden!==!0&&(s.hidden=!0,e++)}return this.refresh(),e},addSearch:function(e,t){var i=0;1==arguments.length?(t=e,e=this.searches.length):("string"==typeof e&&(e=this.getSearch(e,!0)),null===e&&(e=this.searches.length)),$.isArray(t)||(t=[t]);for(var s in t)this.searches.splice(e,0,t[s]),e++,i++;return this.searchClose(),i},removeSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&(this.searches.splice(i,1),e++);return this.searchClose(),e},getSearch:function(e,t){for(var i=0;i<this.searches.length;i++)if(this.searches[i].field==e)return t===!0?i:this.searches[i];return null},toggleSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&(this.searches[i].hidden=!this.searches[i].hidden,e++);return this.searchClose(),e},showSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&this.searches[i].hidden!==!1&&(this.searches[i].hidden=!1,e++);return this.searchClose(),e},hideSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&this.searches[i].hidden!==!0&&(this.searches[i].hidden=!0,e++);return this.searchClose(),e},getSearchData:function(e){for(var t in this.searchData)if(this.searchData[t].field==e)return this.searchData[t];return null},localSort:function(e){var t="object"!=typeof this.url?this.url:this.url.get;if(t)return void console.log("ERROR: grid.localSort can only be used on local data source, grid.url should be empty.");if(!$.isEmptyObject(this.sortData)){var i=(new Date).getTime(),s=this;s.prepareData();for(var r in this.sortData){var n=this.getColumn(this.sortData[r].field);if(!n)return;"string"==typeof n.render&&(-1!=["date","age"].indexOf(n.render.split(":")[0])&&(this.sortData[r].field_=n.field+"_"),-1!=["time"].indexOf(n.render.split(":")[0])&&(this.sortData[r].field_=n.field+"_"))}return this.records.sort(function(e,t){var i=0;for(var r in s.sortData){var n=s.sortData[r].field;s.sortData[r].field_&&(n=s.sortData[r].field_);var a=e[n],o=t[n];if(-1!=String(n).indexOf(".")&&(a=s.parseField(e,n),o=s.parseField(t,n)),"string"==typeof a&&(a=$.trim(a.toLowerCase())),"string"==typeof o&&(o=$.trim(o.toLowerCase())),a>o&&(i="asc"==s.sortData[r].direction?1:-1),o>a&&(i="asc"==s.sortData[r].direction?-1:1),"object"!=typeof a&&"object"==typeof o&&(i=-1),"object"!=typeof o&&"object"==typeof a&&(i=1),null==a&&null!=o&&(i=1),null!=a&&null==o&&(i=-1),0!=i)break}return i}),i=(new Date).getTime()-i,e!==!0&&setTimeout(function(){s.status(w2utils.lang("Sorting took")+" "+i/1e3+" "+w2utils.lang("sec"))},10),i}},localSearch:function(e){var t="object"!=typeof this.url?this.url:this.url.get;if(t)return void console.log("ERROR: grid.localSearch can only be used on local data source, grid.url should be empty.");var i=(new Date).getTime(),s=this;if(this.total=this.records.length,this.last.searchIds=[],this.prepareData(),this.searchData.length>0&&!t){this.total=0;for(var r in this.records){var n=this.records[r],a=0;for(var o in this.searchData){var l=this.searchData[o],d=this.getSearch(l.field);if(null!=l){null==d&&(d={field:l.field,type:l.type});var u=String(s.parseField(n,d.field)).toLowerCase();if("undefined"!=typeof l.value)if($.isArray(l.value))var h=l.value[0],f=l.value[1];else var h=String(l.value).toLowerCase();switch(l.operator){case"is":if(n[d.field]==l.value&&a++,"date"==d.type){var u=w2utils.formatDate(n[d.field+"_"],"yyyy-mm-dd"),h=w2utils.formatDate(h,"yyyy-mm-dd");u==h&&a++}if("time"==d.type){var u=w2utils.formatTime(n[d.field+"_"],"h24:mi"),h=w2utils.formatTime(h,"h24:mi");u==h&&a++}break;case"between":if(-1!=["int","float","money","currency","percent"].indexOf(d.type)&&parseFloat(n[d.field])>=parseFloat(h)&&parseFloat(n[d.field])<=parseFloat(f)&&a++,"date"==d.type){var u=n[d.field+"_"],h=w2utils.isDate(h,w2utils.settings.date_format,!0),f=w2utils.isDate(f,w2utils.settings.date_format,!0);null!=f&&(f=new Date(f.getTime()+864e5)),u>=h&&f>u&&a++}if("time"==d.type){var u=n[d.field+"_"],h=w2utils.isTime(h,!0),f=w2utils.isTime(f,!0);h=(new Date).setHours(h.hours,h.minutes,h.seconds?h.seconds:0,0),f=(new Date).setHours(f.hours,f.minutes,f.seconds?f.seconds:0,0),u>=h&&f>u&&a++}break;case"in":var c=l.value;l.svalue&&(c=l.svalue),-1!==c.indexOf(u)&&a++;break;case"not in":var c=l.value;l.svalue&&(c=l.svalue),-1==c.indexOf(u)&&a++;break;case"begins":case"begins with":0==u.indexOf(h)&&a++;break;case"contains":u.indexOf(h)>=0&&a++;break;case"ends":case"ends with":u.indexOf(h)==u.length-h.length&&a++}}}("OR"==this.last.logic&&0!=a||"AND"==this.last.logic&&a==this.searchData.length)&&this.last.searchIds.push(parseInt(r))}this.total=this.last.searchIds.length}return i=(new Date).getTime()-i,e!==!0&&setTimeout(function(){s.status(w2utils.lang("Search took")+" "+i/1e3+" "+w2utils.lang("sec"))},10),i},getRangeData:function(e,t){var i=this.get(e[0].recid,!0),s=this.get(e[1].recid,!0),r=e[0].column,n=e[1].column,a=[];if(r==n)for(var o=i;s>=o;o++){var l=this.records[o],d=l[this.columns[r].field]||null;a.push(t!==!0?d:{data:d,column:r,index:o,record:l})}else if(i==s)for(var l=this.records[i],u=r;n>=u;u++){var d=l[this.columns[u].field]||null;a.push(t!==!0?d:{data:d,column:u,index:i,record:l})}else for(var o=i;s>=o;o++){var l=this.records[o];a.push([]);for(var u=r;n>=u;u++){var d=l[this.columns[u].field];a[a.length-1].push(t!==!0?d:{data:d,column:u,index:o,record:l})}}return a},addRange:function(e){var t=0;if("row"==this.selectType)return t;$.isArray(e)||(e=[e]);for(var i in e){if("object"!=typeof e[i]&&(e[i]={name:"selection"}),"selection"==e[i].name){if(this.show.selectionBorder===!1)continue;var s=this.getSelection();if(0==s.length){this.removeRange(e[i].name);continue}{var r=s[0],n=s[s.length-1];$("#grid_"+this.name+"_rec_"+r.recid+" td[col="+r.column+"]"),$("#grid_"+this.name+"_rec_"+n.recid+" td[col="+n.column+"]")}}else{var r=e[i].range[0],n=e[i].range[1];$("#grid_"+this.name+"_rec_"+r.recid+" td[col="+r.column+"]"),$("#grid_"+this.name+"_rec_"+n.recid+" td[col="+n.column+"]")}if(r){var l={name:e[i].name,range:[{recid:r.recid,column:r.column},{recid:n.recid,column:n.column}],style:e[i].style||""},d=!1;for(var u in this.ranges)if(this.ranges[u].name==e[i].name){d=i;break}d!==!1?this.ranges[d]=l:this.ranges.push(l),t++}}return this.refreshRanges(),t},removeRange:function(){for(var e=0,t=0;t<arguments.length;t++){var i=arguments[t];$("#grid_"+this.name+"_"+i).remove();for(var s=this.ranges.length-1;s>=0;s--)this.ranges[s].name==i&&(this.ranges.splice(s,1),e++)}return e},refreshRanges:function(){function u(t){var i=e.getSelection();e.last.move={type:"expand",x:t.screenX,y:t.screenY,divX:0,divY:0,recid:i[0].recid,column:i[0].column,originalRange:[{recid:i[0].recid,column:i[0].column},{recid:i[i.length-1].recid,column:i[i.length-1].column}],newRange:[{recid:i[0].recid,column:i[0].column},{recid:i[i.length-1].recid,column:i[i.length-1].column}]},$(document).off("mousemove",h).on("mousemove",h),$(document).off("mouseup",f).on("mouseup",f)}function h(t){var i=e.last.move;if(i&&"expand"==i.type){i.divX=t.screenX-i.x,i.divY=t.screenY-i.y;var s,r,n=t.originalEvent.target;if("TD"!=n.tagName&&(n=$(n).parents("td")[0]),"undefined"!=typeof $(n).attr("col")&&(r=parseInt($(n).attr("col"))),n=$(n).parents("tr")[0],s=$(n).attr("recid"),i.newRange[1].recid!=s||i.newRange[1].column!=r){var a=$.extend({},i.newRange);return i.newRange=[{recid:i.recid,column:i.column},{recid:s,column:r}],d=e.trigger($.extend(d,{originalRange:i.originalRange,newRange:i.newRange})),d.isCancelled===!0?(i.newRange=a,void(d.newRange=a)):(e.removeRange("grid-selection-expand"),void e.addRange({name:"grid-selection-expand",range:d.newRange,style:"background-color: rgba(100,100,100,0.1); border: 2px dotted rgba(100,100,100,0.5);"}))}}}function f(){e.removeRange("grid-selection-expand"),delete e.last.move,$(document).off("mousemove",h),$(document).off("mouseup",f),e.trigger($.extend(d,{phase:"after"}))}var e=this,t=(new Date).getTime(),i=$("#grid_"+this.name+"_records");for(var s in this.ranges){var r=this.ranges[s],n=r.range[0],a=r.range[1],o=$("#grid_"+this.name+"_rec_"+n.recid+" td[col="+n.column+"]"),l=$("#grid_"+this.name+"_rec_"+a.recid+" td[col="+a.column+"]");0==$("#grid_"+this.name+"_"+r.name).length?i.append('<div id="grid_'+this.name+"_"+r.name+'" class="w2ui-selection" style="'+r.style+'">'+("selection"==r.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"):$("#grid_"+this.name+"_"+r.name).attr("style",r.style),o.length>0&&l.length>0&&$("#grid_"+this.name+"_"+r.name).css({left:o.position().left-1+i.scrollLeft()+"px",top:o.position().top-1+i.scrollTop()+"px",width:l.position().left-o.position().left+l.width()+3+"px",height:l.position().top-o.position().top+l.height()+3+"px"})}$(this.box).find("#grid_"+this.name+"_resizer").off("mousedown").on("mousedown",u);var d={phase:"before",type:"selectionExtend",target:e.name,originalRange:null,newRange:null};return(new Date).getTime()-t},select:function(){var e=0,t=this.last.selection;this.multiSelect||this.selectNone();for(var i=0;i<arguments.length;i++){var s="object"==typeof arguments[i]?arguments[i].recid:arguments[i],r=this.get(s);if(null!=r){var n=this.get(s,!0),a=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(s));if("row"==this.selectType){if(t.indexes.indexOf(n)>=0)continue;var o=this.trigger({phase:"before",type:"select",target:this.name,recid:s,index:n});if(o.isCancelled===!0)continue;t.indexes.push(n),t.indexes.sort(function(e,t){return e-t}),a.addClass("w2ui-selected").data("selected","yes"),a.find(".w2ui-grid-select-check").prop("checked",!0),e++}else{var l=arguments[i].column;if(!w2utils.isInt(l)){var d=[];for(var u in this.columns)this.columns[u].hidden||d.push({recid:s,column:parseInt(u)});return this.multiSelect||(d=d.splice(0,1)),this.select.apply(this,d)}var h=t.columns[n]||[];if($.isArray(h)&&-1!=h.indexOf(l))continue;var o=this.trigger({phase:"before",type:"select",target:this.name,recid:s,index:n,column:l});if(o.isCancelled===!0)continue;-1==t.indexes.indexOf(n)&&(t.indexes.push(n),t.indexes.sort(function(e,t){return e-t})),h.push(l),h.sort(function(e,t){return e-t}),a.find(" > td[col="+l+"]").addClass("w2ui-selected"),e++,a.data("selected","yes"),a.find(".w2ui-grid-select-check").prop("checked",!0),t.columns[n]=h}this.trigger($.extend(o,{phase:"after"}))}}return t.indexes.length==this.records.length||0!==this.searchData.length&&t.indexes.length==this.last.searchIds.length?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),e},unselect:function(){for(var e=0,t=this.last.selection,i=0;i<arguments.length;i++){var s="object"==typeof arguments[i]?arguments[i].recid:arguments[i],r=this.get(s);if(null!=r){var n=this.get(r.recid,!0),a=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(s));if("row"==this.selectType){if(-1==t.indexes.indexOf(n))continue;var o=this.trigger({phase:"before",type:"unselect",target:this.name,recid:s,index:n});if(o.isCancelled===!0)continue;t.indexes.splice(t.indexes.indexOf(n),1),a.removeClass("w2ui-selected").removeData("selected"),0!=a.length&&(a[0].style.cssText="height: "+this.recordHeight+"px; "+a.attr("custom_style")),a.find(".w2ui-grid-select-check").prop("checked",!1),e++}else{var l=arguments[i].column;if(!w2utils.isInt(l)){var d=[];for(var u in this.columns)this.columns[u].hidden||d.push({recid:s,column:parseInt(u)});return this.unselect.apply(this,d)}var h=t.columns[n];if(!$.isArray(h)||-1==h.indexOf(l))continue;var o=this.trigger({phase:"before",type:"unselect",target:this.name,recid:s,column:l});if(o.isCancelled===!0)continue;h.splice(h.indexOf(l),1),$("#grid_"+this.name+"_rec_"+w2utils.escapeId(s)+" > td[col="+l+"]").removeClass("w2ui-selected"),e++,0==h.length&&(delete t.columns[n],t.indexes.splice(t.indexes.indexOf(n),1),a.removeData("selected"),a.find(".w2ui-grid-select-check").prop("checked",!1))}this.trigger($.extend(o,{phase:"after"}))}}return t.indexes.length==this.records.length||0!==this.searchData.length&&t.indexes.length==this.last.searchIds.length?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),e},selectAll:function(){if(this.multiSelect!==!1){var e=this.trigger({phase:"before",type:"select",target:this.name,all:!0});if(e.isCancelled!==!0){var t="object"!=typeof this.url?this.url:this.url.get,i=this.last.selection,s=[];for(var r in this.columns)s.push(parseInt(r));if(i.indexes=[],t||0===this.searchData.length){var a=this.records.length;0==this.searchData.length||this.url||(a=this.last.searchIds.length);for(var n=0;a>n;n++)i.indexes.push(n),"row"!=this.selectType&&(i.columns[n]=s.slice())}else for(var n=0;n<this.last.searchIds.length;n++)i.indexes.push(this.last.searchIds[n]),"row"!=this.selectType&&(i.columns[this.last.searchIds[n]]=s.slice());this.refresh();var i=this.getSelection();1==i.length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit"),i.length>=1?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete"),this.addRange("selection"),this.trigger($.extend(e,{phase:"after"}))}}},selectNone:function(){var e=this.trigger({phase:"before",type:"unselect",target:this.name,all:!0});if(e.isCancelled!==!0){var t=this.last.selection;for(var i in t.indexes){var s=t.indexes[i],r=this.records[s],n=r?r.recid:null,a=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(n));if(a.removeClass("w2ui-selected").removeData("selected"),a.find(".w2ui-grid-select-check").prop("checked",!1),"row"!=this.selectType){var o=t.columns[s];for(var l in o)a.find(" > td[col="+o[l]+"]").removeClass("w2ui-selected")}}t.indexes=[],t.columns={},this.toolbar.disable("w2ui-edit","w2ui-delete"),this.removeRange("selection"),$("#grid_"+this.name+"_check_all").prop("checked",!1),this.trigger($.extend(e,{phase:"after"}))}},getSelection:function(e){var t=[],i=this.last.selection;if("row"==this.selectType){for(var s in i.indexes)this.records[i.indexes[s]]&&t.push(e===!0?i.indexes[s]:this.records[i.indexes[s]].recid);return t}for(var s in i.indexes){var r=i.columns[i.indexes[s]];if(this.records[i.indexes[s]])for(var n in r)t.push({recid:this.records[i.indexes[s]].recid,index:parseInt(i.indexes[s]),column:r[n]})}return t},search:function(e,t){var s="object"!=typeof this.url?this.url:this.url.get,r=[],n=this.last.multi,a=this.last.logic,o=this.last.field,l=this.last.search;if(0==arguments.length){l="";for(var d in this.searches){var u=this.searches[d],h=$("#grid_"+this.name+"_operator_"+d).val(),f=$("#grid_"+this.name+"_field_"+d),c=$("#grid_"+this.name+"_field2_"+d),p=f.val(),g=c.val(),m=null;if(-1!=["int","float","money","currency","percent"].indexOf(u.type)){var v=f.data("w2field"),w=c.data("w2field");v&&(p=v.clean(p)),w&&(g=w.clean(g))}if(-1!=["list","enum"].indexOf(u.type))if(p=f.data("selected")||{},$.isArray(p)){m=[];for(var y in p)m.push(w2utils.isFloat(p[y].id)?parseFloat(p[y].id):String(p[y].id).toLowerCase()),delete p[y].hidden}else p=p.id||"";if(""!=p&&null!=p||"undefined"!=typeof g&&""!=g){var b={field:u.field,type:u.type,operator:h};"between"==h?$.extend(b,{value:[p,g]}):"in"==h&&"string"==typeof p?$.extend(b,{value:p.split(",")}):"not in"==h&&"string"==typeof p?$.extend(b,{value:p.split(",")}):$.extend(b,{value:p}),m&&$.extend(b,{svalue:m});try{"date"==u.type&&"between"==h&&(b.value[0]=p,b.value[1]=g),"date"==u.type&&"is"==h&&(b.value=p)}catch(x){}r.push(b)}}r.length>0&&!s?(n=!0,a="AND"):(n=!0,a="AND")}if("string"==typeof e&&(o=e,l=t,n=!1,a="OR","undefined"!=typeof t))if("all"==e.toLowerCase())if(this.searches.length>0)for(var d in this.searches){var u=this.searches[d];if("text"==u.type||"alphanumeric"==u.type&&w2utils.isAlphaNumeric(t)||"int"==u.type&&w2utils.isInt(t)||"float"==u.type&&w2utils.isFloat(t)||"percent"==u.type&&w2utils.isFloat(t)||"hex"==u.type&&w2utils.isHex(t)||"currency"==u.type&&w2utils.isMoney(t)||"money"==u.type&&w2utils.isMoney(t)||"date"==u.type&&w2utils.isDate(t)){var b={field:u.field,type:u.type,operator:"text"==u.type?"contains":"is",value:t};r.push(b)}if(-1!=["int","float","money","currency","percent"].indexOf(u.type)&&-1!=String(t).indexOf("-")){var _=String(t).split("-"),b={field:u.field,type:u.type,operator:"between",value:[_[0],_[1]]};r.push(b)}}else for(var k in this.columns){var b={field:this.columns[k].field,type:"text",operator:"contains",value:t};r.push(b)}else{var C=$("#grid_"+this.name+"_search_all"),u=this.getSearch(e);if(null==u&&(u={field:e,type:"text"}),u.field==e&&(this.last.caption=u.caption),"list"==u.type){var b=C.data("selected");b&&!$.isEmptyObject(b)&&(t=b.id)}if(""!=t){var T="contains",z=t;if(-1!=["date","time","list"].indexOf(u.type)&&(T="is"),"int"==u.type&&""!=t){if(T="is",-1!=String(t).indexOf("-")){var b=t.split("-");2==b.length&&(T="between",z=[parseInt(b[0]),parseInt(b[1])])}if(-1!=String(t).indexOf(",")){var b=t.split(",");T="in",z=[];for(var _ in b)z.push(b[_])}}var b={field:u.field,type:u.type,operator:T,value:z};r.push(b)}}if($.isArray(e)){var S="AND";"string"==typeof t&&(S=t.toUpperCase(),"OR"!=S&&"AND"!=S&&(S="AND")),l="",n=!0,a=S;for(var D in e){var I=e[D],u=this.getSearch(I.field);null==u&&(u={type:"text",operator:"contains"}),r.push($.extend(!0,{},u,I))}}var R=this.trigger({phase:"before",type:"search",target:this.name,searchData:r,searchField:e?e:"multi",searchValue:t?t:"multi"});R.isCancelled!==!0&&(this.searchData=R.searchData,this.last.field=o,this.last.search=l,this.last.multi=n,this.last.logic=a,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),this.set({expanded:!1},!0),s?(this.last.xhr_offset=0,this.reload()):(this.localSearch(),this.refresh()),this.trigger($.extend(R,{phase:"after"})))},searchOpen:function(){if(this.box&&0!=this.searches.length){var e=this;$("#tb_"+this.name+"_toolbar_item_w2ui-search-advanced").w2overlay(this.getSearchesHTML(),{name:"searches-"+this.name,left:-10,"class":"w2ui-grid-searches",onShow:function(){"OR"==e.last.logic&&(e.searchData=[]),e.initSearches(),$("#w2ui-overlay-searches-"+this.name+" .w2ui-grid-searches").data("grid-name",e.name);var t=$("#w2ui-overlay-searches-"+this.name+" .w2ui-grid-searches *[rel=search]");t.length>0&&t[0].focus()}})}},searchClose:function(){this.box&&0!=this.searches.length&&(this.toolbar&&this.toolbar.uncheck("w2ui-search-advanced"),$("#w2ui-overlay-searches-"+this.name+" .w2ui-grid-searches").length>0&&$().w2overlay("",{name:"searches-"+this.name}))},searchShowFields:function(){for(var e=$("#grid_"+this.name+"_search_all"),t='<div class="w2ui-select-field"><table>',i=-1;i<this.searches.length;i++){var s=this.searches[i];if(-1==i){if(!this.multiSearch)continue;s={field:"all",caption:w2utils.lang("All Fields")}}else if(this.searches[i].hidden===!0)continue;t+="<tr "+(w2utils.isIOS?"onTouchStart":"onClick")+"=\"w2ui['"+this.name+"'].initAllField('"+s.field+'\')">    <td><input type="radio" tabIndex="-1" '+(s.field==this.last.field?"checked":"")+"></td>    <td>"+s.caption+"</td></tr>"}t+="</table></div>",setTimeout(function(){$(e).w2overlay(t,{left:-10})},1)},initAllField:function(e,t){var i=$("#grid_"+this.name+"_search_all"),s=this.getSearch(e);if("all"==e)s={field:"all",caption:w2utils.lang("All Fields")},i.w2field("clear"),i.change().focus();else{var r=s.type;-1!=["enum","select"].indexOf(r)&&(r="list"),i.w2field(r,$.extend({},s.options,{suffix:"",autoFormat:!1,selected:t})),-1!=["list","enum"].indexOf(s.type)&&(this.last.search="",this.last.item="",i.val("")),setTimeout(function(){i.focus()},1)}""!=this.last.search?this.search(s.field,this.last.search):(this.last.field=s.field,this.last.caption=s.caption),i.attr("placeholder",s.caption),$().w2overlay()},searchReset:function(e){var t=this.trigger({phase:"before",type:"search",target:this.name,searchData:[]});t.isCancelled!==!0&&(this.searchData=[],this.last.search="",this.last.logic="OR",this.last.multi=!1,this.last.xhr_offset=0,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),$("#grid_"+this.name+"_search_all").val(""),e||this.reload(),this.trigger($.extend(t,{phase:"after"})))},clear:function(e){this.records=[],this.summary=[],this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.last.range_start=null,this.last.range_end=null,this.last.xhr_offset=0,e||this.refresh()
},reset:function(e){this.offset=0,this.total=0,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.last.range_start=null,this.last.range_end=null,this.last.xhr_offset=0,this.searchReset(e),null!=this.last.sortData&&(this.sortData=this.last.sortData),this.set({expanded:!1},!0),e||this.refresh()},skip:function(e){var t="object"!=typeof this.url?this.url:this.url.get;t?(this.offset=parseInt(e),this.offset>this.total&&(this.offset=this.total-this.limit),(this.offset<0||!w2utils.isInt(this.offset))&&(this.offset=0),this.records=[],this.last.xhr_offset=0,this.last.pull_more=!0,this.last.scrollTop=0,this.last.scrollLeft=0,$("#grid_"+this.name+"_records").prop("scrollTop",0),this.reload()):console.log("ERROR: grid.skip() can only be called when you have remote data source.")},load:function(e,t){return"undefined"==typeof e?void console.log('ERROR: You need to provide url argument when calling .load() method of "'+this.name+'" object.'):void this.request("get-records",{},e,t)},reload:function(e){var t="object"!=typeof this.url?this.url:this.url.get;t?(this.clear(!0),this.request("get-records",{},null,e)):(this.last.scrollTop=0,this.last.scrollLeft=0,this.last.range_start=null,this.last.range_end=null,this.localSearch(),this.refresh(),"function"==typeof e&&e({status:"success"}))},request:function(e,t,i,s){if("undefined"==typeof t&&(t={}),("undefined"==typeof i||""==i||null==i)&&(i=this.url),""!=i&&null!=i){var r={};if(w2utils.isInt(this.offset)||(this.offset=0),w2utils.isInt(this.last.xhr_offset)||(this.last.xhr_offset=0),r.cmd=e,r.selected=this.getSelection(),r.limit=this.limit,r.offset=parseInt(this.offset)+this.last.xhr_offset,r.search=this.searchData,r.searchLogic=this.last.logic,r.sort=this.sortData,0==this.searchData.length&&(delete r.search,delete r.searchLogic),0==this.sortData.length&&delete r.sort,$.extend(r,this.postData),$.extend(r,t),"get-records"==e){var n=this.trigger({phase:"before",type:"request",target:this.name,url:i,postData:r});if(n.isCancelled===!0)return void("function"==typeof s&&s({status:"error",message:"Request aborted."}))}else var n={url:i,postData:r};var a=this;if(0==this.last.xhr_offset)this.lock(this.msgRefresh,!0);else{var o=$("#grid_"+this.name+"_rec_more");this.autoLoad===!0?o.show().find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>'):o.find("td").html("<div>"+w2utils.lang("Load")+" "+a.limit+" "+w2utils.lang("More")+"...</div>")}if(this.last.xhr)try{this.last.xhr.abort()}catch(l){}var i="object"!=typeof n.url?n.url:n.url.get;if("save-records"==r.cmd&&"object"==typeof n.url&&(i=n.url.save),"delete-records"==r.cmd&&"object"==typeof n.url&&(i=n.url.remove),!$.isEmptyObject(a.routeData)){var d=w2utils.parseRoute(i);if(d.keys.length>0)for(var u=0;u<d.keys.length;u++)null!=a.routeData[d.keys[u].name]&&(i=i.replace(new RegExp(":"+d.keys[u].name,"g"),a.routeData[d.keys[u].name]))}var h={type:"POST",url:i,data:n.postData,dataType:"text"};"HTTP"==w2utils.settings.dataType&&(h.data="object"==typeof h.data?String($.param(h.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):h.data),"RESTFULL"==w2utils.settings.dataType&&(h.type="GET","save-records"==r.cmd&&(h.type="PUT"),"delete-records"==r.cmd&&(h.type="DELETE"),h.data="object"==typeof h.data?String($.param(h.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):h.data),"JSON"==w2utils.settings.dataType&&(h.type="POST",h.data=JSON.stringify(h.data),h.contentType="application/json"),this.method&&(h.type=this.method),this.last.xhr_cmd=r.cmd,this.last.xhr_start=(new Date).getTime(),this.last.xhr=$.ajax(h).done(function(t,i){a.requestComplete(i,e,s)}).fail(function(t,i,r){var n={status:i,error:r,rawResponseText:t.responseText},o=a.trigger({phase:"before",type:"error",error:n,xhr:t});if(o.isCancelled!==!0){if("abort"!=i){var l;try{l=$.parseJSON(t.responseText)}catch(d){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",total:5,records:[{recid:1,field:"value"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof l?l:t.responseText),a.requestComplete("error",e,s)}a.trigger($.extend(o,{phase:"after"}))}}),"get-records"==e&&this.trigger($.extend(n,{phase:"after"}))}},requestComplete:function(status,cmd,callBack){var obj=this;this.unlock(),setTimeout(function(){obj.status(w2utils.lang("Server Response")+" "+((new Date).getTime()-obj.last.xhr_start)/1e3+" "+w2utils.lang("sec"))},10),this.last.pull_more=!1,this.last.pull_refresh=!0;var event_name="load";"save-records"==this.last.xhr_cmd&&(event_name="save"),"delete-records"==this.last.xhr_cmd&&(event_name="deleted");var eventData=this.trigger({phase:"before",target:this.name,type:event_name,xhr:this.last.xhr,status:status});if(eventData.isCancelled===!0)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));var data,responseText=this.last.xhr.responseText;if("error"!=status){if("undefined"!=typeof responseText&&""!=responseText){if("object"==typeof responseText)data=responseText;else if("function"==typeof obj.parser)data=obj.parser(responseText),"object"!=typeof data&&console.log("ERROR: Your parser did not return proper object");else try{eval("data = "+responseText)}catch(e){}if(obj.recid)for(var r in data.records)data.records[r].recid=data.records[r][obj.recid];if("undefined"==typeof data&&(data={status:"error",message:this.msgNotJSON,responseText:responseText}),"error"==data.status)obj.error(data.message);else{if("get-records"==cmd)if(0==this.last.xhr_offset)this.records=[],this.summary=[],delete data.status,$.extend(!0,this,data);else{var records=data.records;delete data.records,delete data.status,$.extend(!0,this,data);for(var r in records)this.records.push(records[r])}if("delete-records"==cmd)return void this.reset()}}}else data={status:"error",message:this.msgAJAXerror,responseText:responseText},obj.error(this.msgAJAXerror);var url="object"!=typeof this.url?this.url:this.url.get;url||(this.localSort(),this.localSearch()),this.total=parseInt(this.total),this.trigger($.extend(eventData,{phase:"after"})),0==this.last.xhr_offset?this.refresh():this.scroll(),"function"==typeof callBack&&callBack(data)},error:function(e){var i=this.trigger({target:this.name,type:"error",message:e,xhr:this.last.xhr});return i.isCancelled===!0?void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})):(w2alert(e,"Error"),void this.trigger($.extend(i,{phase:"after"})))},getChanges:function(){var e=[];for(var t in this.records){var i=this.records[t];"undefined"!=typeof i.changes&&e.push($.extend(!0,{recid:i.recid},i.changes))}return e},mergeChanges:function(){var changes=this.getChanges();for(var c in changes){var record=this.get(changes[c].recid);for(var s in changes[c])if("recid"!=s){try{eval("record."+s+" = changes[c][s]")}catch(e){}delete record.changes}}this.refresh()},save:function(){var e=this,t=this.getChanges(),i=this.trigger({phase:"before",target:this.name,type:"submit",changes:t});if(i.isCancelled!==!0){var s="object"!=typeof this.url?this.url:this.url.save;s?this.request("save-records",{changes:i.changes},null,function(t){"error"!==t.status&&e.mergeChanges(),e.trigger($.extend(i,{phase:"after"}))}):(this.mergeChanges(),this.trigger($.extend(i,{phase:"after"})))}},editField:function(e,t,i,s){var r=this,n=r.get(e,!0),a=r.records[n],o=r.columns[t],l=o?o.editable:null;if(a&&o&&l&&a.editable!==!1){if(-1!=["enum","file"].indexOf(l.type))return void console.log('ERROR: input types "enum" and "file" are not supported in inline editing.');var d=r.trigger({phase:"before",type:"editField",target:r.name,recid:e,column:t,value:i,index:n,originalEvent:s});if(d.isCancelled!==!0&&(i=d.value,this.selectNone(),this.select({recid:e,column:t}),this.last.edit_col=t,-1==["checkbox","check"].indexOf(l.type))){var u=$("#grid_"+r.name+"_rec_"+w2utils.escapeId(e)),h=u.find("[col="+t+"] > div");"undefined"==typeof l.inTag&&(l.inTag=""),"undefined"==typeof l.outTag&&(l.outTag=""),"undefined"==typeof l.style&&(l.style=""),"undefined"==typeof l.items&&(l.items=[]);var f=w2utils.stripTags(a.changes&&"undefined"!=typeof a.changes[o.field]?a.changes[o.field]:a[o.field]);(null==f||"undefined"==typeof f)&&(f=""),"undefined"!=typeof i&&null!=i&&(f=i);var c="undefined"!=typeof o.style?o.style+";":"";if("string"==typeof o.render&&-1!=["number","int","float","money","percent"].indexOf(o.render.split(":")[0])&&(c+="text-align: right;"),l.items.length>0&&!$.isPlainObject(l.items[0])&&(l.items=w2obj.field.prototype.normMenu(l.items)),"select"==l.type){var p="";for(var g in l.items)p+='<option value="'+l.items[g].id+'" '+(l.items[g].id==f?"selected":"")+">"+l.items[g].text+"</option>";h.addClass("w2ui-editable").html('<select id="grid_'+r.name+"_edit_"+e+"_"+t+'" column="'+t+'"     style="width: 100%; '+c+l.style+'" field="'+o.field+'" recid="'+e+'"     '+l.inTag+">"+p+"</select>"+l.outTag),h.find("select").focus().on("change",function(){delete r.last.move}).on("blur",function(e){r.editChange.call(r,this,n,t,e)})}else{h.addClass("w2ui-editable").html('<input id="grid_'+r.name+"_edit_"+e+"_"+t+'"     type="text" style="font-family: inherit; font-size: inherit; outline: none; '+c+l.style+'" field="'+o.field+'" recid="'+e+'"     column="'+t+'" '+l.inTag+">"+l.outTag),null==i&&h.find("input").val("object"!=f?f:"");var m=h.find("input").get(0);$(m).w2field(l.type,$.extend(l,{selected:f})),setTimeout(function(){var e=m;"list"==l.type&&(e=$($(m).data("w2field").helpers.focus).find("input"),"object"!=typeof f&&""!=f&&e.val(f).css({opacity:1}).prev().css({opacity:1})),$(e).on("blur",function(e){r.editChange.call(r,m,n,t,e)})},10),null!=i&&$(m).val("object"!=f?f:"")}setTimeout(function(){h.find("input, select").on("click",function(e){e.stopPropagation()}).on("keydown",function(i){var s=!1;switch(i.keyCode){case 9:s=!0;var l=e,d=i.shiftKey?r.prevCell(t,!0):r.nextCell(t,!0);if(null==d){var u=i.shiftKey?r.prevRow(n):r.nextRow(n);if(null!=u&&u!=n){l=r.records[u].recid;for(var h in r.columns){var u=r.columns[h].editable;if("undefined"!=typeof u&&-1==["checkbox","check"].indexOf(u.type)&&(d=parseInt(h),!i.shiftKey))break}}}l===!1&&(l=e),null==d&&(d=t),this.blur(),setTimeout(function(){"row"!=r.selectType?(r.selectNone(),r.select({recid:l,column:d})):r.editField(l,d,null,i)},1);break;case 13:this.blur();var f=i.shiftKey?r.prevRow(n):r.nextRow(n);null!=f&&f!=n&&setTimeout(function(){"row"!=r.selectType?(r.selectNone(),r.select({recid:r.records[f].recid,column:t})):r.editField(r.records[f].recid,t,null,i)},100);break;case 38:if(!i.shiftKey)break;s=!0;var f=r.prevRow(n);f!=n&&(this.blur(),setTimeout(function(){"row"!=r.selectType?(r.selectNone(),r.select({recid:r.records[f].recid,column:t})):r.editField(r.records[f].recid,t,null,i)},1));break;case 40:if(!i.shiftKey)break;s=!0;var f=r.nextRow(n);null!=f&&f!=n&&(this.blur(),setTimeout(function(){"row"!=r.selectType?(r.selectNone(),r.select({recid:r.records[f].recid,column:t})):r.editField(r.records[f].recid,t,null,i)},1));break;case 27:var c=r.parseField(a,o.field);a.changes&&"undefined"!=typeof a.changes[o.field]&&(c=a.changes[o.field]),this.value="undefined"!=typeof c?c:"",this.blur(),setTimeout(function(){r.select({recid:e,column:t})},1)}s&&i.preventDefault&&i.preventDefault()});var s=h.find("input").focus();null!=i?s[0].setSelectionRange(s.val().length,s.val().length):s.select()},1),r.trigger($.extend(d,{phase:"after"}))}}},editChange:function(e,t,i){var r=0>t;t=0>t?-t-1:t;var n=r?this.summary:this.records,a=n[t],o=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(a.recid)),l=this.columns[i],d=e.value,u=this.parseField(a,l.field),h=$(e).data("w2field");h&&(d=h.clean(d),"list"==h.type&&""!=d&&(d=$(e).data("selected"))),"checkbox"==e.type&&(d=e.checked);for(var f={phase:"before",type:"change",target:this.name,input_id:e.id,recid:a.recid,index:t,column:i,value_new:d,value_previous:a.changes&&a.changes.hasOwnProperty(l.field)?a.changes[l.field]:u,value_original:u};;){if(d=f.value_new,"object"!=typeof d&&String(u)!=String(d)||"object"==typeof d&&("object"!=typeof u||d.id!=u.id)){if(f=this.trigger($.extend(f,{type:"change",phase:"before"})),f.isCancelled!==!0){if(d!==f.value_new)continue;a.changes=a.changes||{},a.changes[l.field]=f.value_new,this.trigger($.extend(f,{phase:"after"}))}}else if(f=this.trigger($.extend(f,{type:"restore",phase:"before"})),f.isCancelled!==!0){if(d!==f.value_new)continue;a.changes&&delete a.changes[l.field],$.isEmptyObject(a.changes)&&delete a.changes,this.trigger($.extend(f,{phase:"after"}))}break}var c=this.getCellHTML(t,i,r);r||(a.changes&&"undefined"!=typeof a.changes[l.field]?$(o).find("[col="+i+"]").addClass("w2ui-changed").html(c):$(o).find("[col="+i+"]").removeClass("w2ui-changed").html(c))},"delete":function(e){var t=this,i=this.trigger({phase:"before",target:this.name,type:"delete",force:e});if(i.isCancelled!==!0){e=i.force;var s=this.getSelection();if(0!=s.length){if(""!=this.msgDelete&&!e)return void w2confirm({title:w2utils.lang("Delete Confirmation"),msg:t.msgDelete,btn_yes:{"class":"btn-red"},callBack:function(e){"Yes"==e&&w2ui[t.name]["delete"](!0)}});var r="object"!=typeof this.url?this.url:this.url.remove;if(r)this.request("delete-records");else if(this.selectNone(),"object"!=typeof s[0])this.remove.apply(this,s);else{for(var n in s){var a=this.columns[s[n].column].field,o=this.get(s[n].recid,!0);null!=o&&"recid"!=a&&(this.records[o][a]="",this.records[o].changes&&delete this.records[o].changes[a])}this.refresh()}this.trigger($.extend(i,{phase:"after"}))}}},click:function(e,t){var i=(new Date).getTime(),s=null;if(!(1==this.last.cancelClick||t&&t.altKey)){if("object"==typeof e&&(s=e.column,e=e.recid),"undefined"==typeof t&&(t={}),i-parseInt(this.last.click_time)<350&&"click"==t.type)return void this.dblClick(e,t);if(this.last.click_time=i,null==s&&t.target){var r=t.target;"TD"!=r.tagName&&(r=$(r).parents("td")[0]),"undefined"!=typeof $(r).attr("col")&&(s=parseInt($(r).attr("col")))}var n=this.trigger({phase:"before",target:this.name,type:"click",recid:e,column:s,originalEvent:t});if(n.isCancelled!==!0){var a=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(e)).parents("tr");if(a.length>0&&-1!=String(a.attr("id")).indexOf("expanded_row")){var o=a.parents(".w2ui-grid").attr("name");w2ui[o].selectNone(),a.parents(".w2ui-grid").find(".w2ui-expanded-row .w2ui-grid").each(function(e,t){var i=$(t).attr("name");w2ui[i]&&w2ui[i].selectNone()})}$(this.box).find(".w2ui-expanded-row .w2ui-grid").each(function(e,t){var i=$(t).attr("name");w2ui[i]&&w2ui[i].selectNone()});var l=this,d=this.getSelection();$("#grid_"+this.name+"_check_all").prop("checked",!1);var u=this.get(e,!0),f=(this.records[u],[]);if(l.last.sel_ind=u,l.last.sel_col=s,l.last.sel_recid=e,l.last.sel_type="click",t.shiftKey&&d.length>0&&l.multiSelect){if(d[0].recid){var c=this.get(d[0].recid,!0),p=this.get(e,!0);if(s>d[0].column)var g=d[0].column,m=s;else var g=s,m=d[0].column;for(var v=g;m>=v;v++)f.push(v)}else var c=this.get(d[0],!0),p=this.get(e,!0);var w=[];if(c>p){var r=c;c=p,p=r}for(var y="object"!=typeof this.url?this.url:this.url.get,b=c;p>=b;b++)if(!(this.searchData.length>0)||y||-1!=$.inArray(b,this.last.searchIds))if("row"==this.selectType)w.push(this.records[b].recid);else for(var x in f)w.push({recid:this.records[b].recid,column:f[x]});this.select.apply(this,w)}else{var _=this.last.selection,k=-1!=_.indexes.indexOf(u)?!0:!1;(t.ctrlKey||t.shiftKey||t.metaKey)&&this.multiSelect||this.showSelectColumn?("row"!=this.selectType&&-1==$.inArray(s,_.columns[u])&&(k=!1),k===!0?this.unselect({recid:e,column:s}):this.select({recid:e,column:s})):("row"!=this.selectType&&-1==$.inArray(s,_.columns[u])&&(k=!1),d.length>300?this.selectNone():this.unselect.apply(this,d),k===!0?this.unselect({recid:e,column:s}):this.select({recid:e,column:s}))}this.status(),l.initResize(),this.trigger($.extend(n,{phase:"after"}))}}},columnClick:function(e,t){var i=this.trigger({phase:"before",type:"columnClick",target:this.name,field:e,originalEvent:t});if(i.isCancelled!==!0){var s=this.getColumn(e);s.sortable&&this.sort(e,null,t&&(t.ctrlKey||t.metaKey)?!0:!1),this.trigger($.extend(i,{phase:"after"}))}},keydown:function(e){function R(){$("#_tmp_copy_data").remove(),$(document).off("keyup",R)}function O(){var e=Math.floor((r[0].scrollTop+r.height()/2.1)/t.recordHeight);t.records[e]||(e=0),t.select({recid:t.records[e].recid,column:0})}function j(){if("click"!=t.last.sel_type)return!1;if("row"!=t.selectType){if(t.last.sel_type="key",n.length>1){for(var e in n)if(n[e].recid==t.last.sel_recid&&n[e].column==t.last.sel_col){n.splice(e,1);break}return t.unselect.apply(t,n),!0}return!1}return t.last.sel_type="key",n.length>1?(n.splice(n.indexOf(t.records[t.last.sel_ind].recid),1),t.unselect.apply(t,n),!0):!1}var t=this;if(t.keyboard===!0){var i=t.trigger({phase:"before",type:"keydown",target:t.name,originalEvent:e});if(i.isCancelled!==!0){var s=!1,r=$("#grid_"+t.name+"_records"),n=t.getSelection();0==n.length&&(s=!0);var a=n[0]||null,o=[],l=n[n.length-1];if("object"==typeof a&&null!=a){a=n[0].recid,o=[];for(var d=0;;){if(!n[d]||n[d].recid!=a)break;o.push(n[d].column),d++}l=n[n.length-1].recid}var u=t.get(a,!0),h=t.get(l,!0),f=t.get(a),c=$("#grid_"+t.name+"_rec_"+(null!==u?w2utils.escapeId(t.records[u].recid):"none")),p=!1,g=e.keyCode,m=e.shiftKey;switch(9==g&&(g=e.shiftKey?37:39,m=!1,p=!0),g){case 8:case 46:this.show.toolbarDelete&&t["delete"](),p=!0,e.stopPropagation();break;case 27:t.selectNone(),n.length>0&&"object"==typeof n[0]&&t.select({recid:n[0].recid,column:n[0].column}),p=!0;break;case 65:if(!e.metaKey&&!e.ctrlKey)break;t.selectAll(),p=!0;break;case 70:if(!e.metaKey&&!e.ctrlKey)break;$("#grid_"+t.name+"_search_all").focus(),p=!0;break;case 13:if("row"==this.selectType&&t.show.expandColumn===!0){if(c.length<=0)break;t.toggle(a,e),p=!0}else{for(var v in this.columns)if(this.columns[v].editable){o.push(parseInt(v));break}"row"==this.selectType&&this.last.edit_col&&(o=[this.last.edit_col]),o.length>0&&(t.editField(a,o[0],null,e),p=!0)}break;case 37:if(s)break;var w=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(t.records[u].recid)).parents("tr");if(w.length>0&&-1!=String(w.attr("id")).indexOf("expanded_row")){var a=w.prev().attr("recid"),y=w.parents(".w2ui-grid").attr("name");t.selectNone(),w2utils.keyboard.active(y),w2ui[y].set(a,{expanded:!1}),w2ui[y].collapse(a),w2ui[y].click(a),p=!0;break}if("row"==this.selectType){if(c.length<=0||f.expanded!==!0)break;t.set(a,{expanded:!1},!0),t.collapse(a,e)}else{var b=t.prevCell(o[0]);if(null!=b)if(m&&t.multiSelect){if(j())return;var x=[],_=[],k=[];if(0==o.indexOf(this.last.sel_col)&&o.length>1)for(var C in n)-1==x.indexOf(n[C].recid)&&x.push(n[C].recid),k.push({recid:n[C].recid,column:o[o.length-1]});else for(var C in n)-1==x.indexOf(n[C].recid)&&x.push(n[C].recid),_.push({recid:n[C].recid,column:b});t.unselect.apply(t,k),t.select.apply(t,_)}else e.shiftKey=!1,t.click({recid:a,column:b},e);else if(!m)for(var T=1;T<n.length;T++)t.unselect(n[T])}p=!0;break;case 39:if(s)break;if("row"==this.selectType){if(c.length<=0||f.expanded===!0||t.show.expandColumn!==!0)break;t.expand(a,e)}else{var z=t.nextCell(o[o.length-1]);if(null!==z)if(m&&39==g&&t.multiSelect){if(j())return;var x=[],_=[],k=[];if(o.indexOf(this.last.sel_col)==o.length-1&&o.length>1)for(var C in n)-1==x.indexOf(n[C].recid)&&x.push(n[C].recid),k.push({recid:n[C].recid,column:o[0]});else for(var C in n)-1==x.indexOf(n[C].recid)&&x.push(n[C].recid),_.push({recid:n[C].recid,column:z});t.unselect.apply(t,k),t.select.apply(t,_)}else t.click({recid:a,column:z},e);else if(!m)for(var T=0;T<n.length-1;T++)t.unselect(n[T])}p=!0;break;case 38:if(s&&O(),c.length<=0)break;var b=t.prevRow(u);if(null!=b){if(t.records[b].expanded){var S=$("#grid_"+t.name+"_rec_"+w2utils.escapeId(t.records[b].recid)+"_expanded_row").find(".w2ui-grid");if(S.length>0&&w2ui[S.attr("name")]){t.selectNone();var y=S.attr("name"),D=w2ui[y].records;w2utils.keyboard.active(y),w2ui[y].click(D[D.length-1].recid),p=!0;break}}if(m&&t.multiSelect){if(j())return;if("row"==t.selectType)t.last.sel_ind>b&&t.last.sel_ind!=h?t.unselect(t.records[h].recid):t.select(t.records[b].recid);else if(t.last.sel_ind>b&&t.last.sel_ind!=h){b=h;var x=[];for(var v in o)x.push({recid:t.records[b].recid,column:o[v]});t.unselect.apply(t,x)}else{var x=[];for(var v in o)x.push({recid:t.records[b].recid,column:o[v]});t.select.apply(t,x)}}else t.selectNone(),t.click({recid:t.records[b].recid,column:o[0]},e);t.scrollIntoView(b),e.preventDefault&&e.preventDefault()}else{if(!m)for(var T=1;T<n.length;T++)t.unselect(n[T]);var w=$("#grid_"+t.name+"_rec_"+w2utils.escapeId(t.records[u].recid)).parents("tr");if(w.length>0&&-1!=String(w.attr("id")).indexOf("expanded_row")){var a=w.prev().attr("recid"),y=w.parents(".w2ui-grid").attr("name");t.selectNone(),w2utils.keyboard.active(y),w2ui[y].click(a),p=!0;break}}break;case 40:if(s&&O(),c.length<=0)break;if(t.records[h].expanded){var S=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(t.records[h].recid)+"_expanded_row").find(".w2ui-grid");if(S.length>0&&w2ui[S.attr("name")]){t.selectNone();var y=S.attr("name"),D=w2ui[y].records;w2utils.keyboard.active(y),w2ui[y].click(D[0].recid),p=!0;break}}var z=t.nextRow(h);if(null!=z){if(m&&t.multiSelect){if(j())return;if("row"==t.selectType)this.last.sel_ind<z&&this.last.sel_ind!=u?t.unselect(t.records[u].recid):t.select(t.records[z].recid);else if(this.last.sel_ind<z&&this.last.sel_ind!=u){z=u;var x=[];for(var v in o)x.push({recid:t.records[z].recid,column:o[v]});t.unselect.apply(t,x)}else{var x=[];for(var v in o)x.push({recid:t.records[z].recid,column:o[v]});t.select.apply(t,x)}}else t.selectNone(),t.click({recid:t.records[z].recid,column:o[0]},e);t.scrollIntoView(z),p=!0}else{if(!m)for(var T=0;T<n.length-1;T++)t.unselect(n[T]);var w=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(t.records[h].recid)).parents("tr");if(w.length>0&&-1!=String(w.attr("id")).indexOf("expanded_row")){var a=w.next().attr("recid"),y=w.parents(".w2ui-grid").attr("name");t.selectNone(),w2utils.keyboard.active(y),w2ui[y].click(a),p=!0;break}}break;case 17:case 91:if(s)break;var I=t.copy();$("body").append('<textarea id="_tmp_copy_data"    onpaste="var obj = this; setTimeout(function () { w2ui[\''+t.name+"'].paste(obj.value); }, 1);\"    onkeydown=\"w2ui['"+t.name+'\'].keydown(event)"   style="position: absolute; top: -100px; height: 1px; width: 1px">'+I+"</textarea>"),$("#_tmp_copy_data").focus().select(),$(document).on("keyup",R);break;case 88:if(s)break;(e.ctrlKey||e.metaKey)&&setTimeout(function(){t["delete"](!0)},100)}for(var x=[187,189,32],C=48;90>=C;C++)x.push(C);if(-1!=x.indexOf(g)&&!e.ctrlKey&&!e.metaKey&&!p){0==o.length&&o.push(0);var x=String.fromCharCode(g);187==g&&(x="="),189==g&&(x="-"),m||(x=x.toLowerCase()),t.editField(a,o[0],x,e),p=!0}p&&e.preventDefault&&e.preventDefault(),t.trigger($.extend(i,{phase:"after"}))}}},scrollIntoView:function(e){var t=this.records.length;if(0==this.searchData.length||this.url||(t=this.last.searchIds.length),"undefined"==typeof e){var i=this.getSelection();if(0==i.length)return;e=this.get(i[0],!0)}var s=$("#grid_"+this.name+"_records");if(0!=t){var r=this.last.searchIds.length;if(!(s.height()>this.recordHeight*(r>0?r:t))){r>0&&(e=this.last.searchIds.indexOf(e));var n=Math.floor(s[0].scrollTop/this.recordHeight),a=n+Math.floor(s.height()/this.recordHeight);e==n&&s.animate({scrollTop:s.scrollTop()-s.height()/1.3},250,"linear"),e==a&&s.animate({scrollTop:s.scrollTop()+s.height()/1.3},250,"linear"),(n>e||e>a)&&s.animate({scrollTop:(e-1)*this.recordHeight})}}},dblClick:function(e,t){var i=null;if("object"==typeof e&&(i=e.column,e=e.recid),"undefined"==typeof t&&(t={}),null==i&&t.target){var s=t.target;"TD"!=s.tagName&&(s=$(s).parents("td")[0]),i=parseInt($(s).attr("col"))}var r=this.trigger({phase:"before",target:this.name,type:"dblClick",recid:e,column:i,originalEvent:t});if(r.isCancelled!==!0){this.selectNone();var n=this.columns[i];n&&$.isPlainObject(n.editable)?this.editField(e,i,null,t):this.select({recid:e,column:i}),this.trigger($.extend(r,{phase:"after"}))}},contextMenu:function(e,t){var i=this;"text"!=i.last.userSelect&&("undefined"==typeof t&&(t={offsetX:0,offsetY:0,target:$("#grid_"+i.name+"_rec_"+e)[0]}),"undefined"==typeof t.offsetX&&(t.offsetX=t.layerX-t.target.offsetLeft,t.offsetY=t.layerY-t.target.offsetTop),w2utils.isFloat(e)&&(e=parseFloat(e)),-1==this.getSelection().indexOf(e)&&i.click(e),setTimeout(function(){var s=i.trigger({phase:"before",type:"contextMenu",target:i.name,originalEvent:t,recid:e});s.isCancelled!==!0&&(i.menu.length>0&&$(i.box).find(t.target).w2menu(i.menu,{left:t.offsetX,onSelect:function(t){i.menuClick(e,parseInt(t.index),t.originalEvent)}}),i.trigger($.extend(s,{phase:"after"})))},150),t.preventDefault&&t.preventDefault())},menuClick:function(e,t,i){var s=this,r=s.trigger({phase:"before",type:"menuClick",target:s.name,originalEvent:i,recid:e,menuIndex:t,menuItem:s.menu[t]});r.isCancelled!==!0&&s.trigger($.extend(r,{phase:"after"}))},toggle:function(e){var t=this.get(e);return t.expanded===!0?this.collapse(e):this.expand(e)},expand:function(e){function o(){var t=$("#grid_"+i.name+"_rec_"+s+"_expanded"),r=$("#grid_"+i.name+"_rec_"+s+"_expanded_row .w2ui-expanded1 > div");t.height()<5||(t.css("opacity",1),r.show().css("opacity",1),$("#grid_"+i.name+"_cell_"+i.get(e,!0)+"_expand div").html("-"))}var t=this.get(e),i=this,s=w2utils.escapeId(e);if($("#grid_"+this.name+"_rec_"+s+"_expanded_row").length>0)return!1;if("none"==t.expanded)return!1;var r=1+(this.show.selectColumn?1:0),n="";$("#grid_"+this.name+"_rec_"+s).after('<tr id="grid_'+this.name+"_rec_"+e+'_expanded_row" class="w2ui-expanded-row '+n+'">'+(this.show.lineNumbers?'<td class="w2ui-col-number"></td>':"")+'    <td class="w2ui-grid-data w2ui-expanded1" colspan="'+r+'"><div style="display: none"></div></td>    <td colspan="100" class="w2ui-expanded2">        <div id="grid_'+this.name+"_rec_"+e+'_expanded" style="opacity: 0"></div>    </td></tr>');var a=this.trigger({phase:"before",type:"expand",target:this.name,recid:e,box_id:"grid_"+this.name+"_rec_"+e+"_expanded",ready:o});return a.isCancelled===!0?void $("#grid_"+this.name+"_rec_"+s+"_expanded_row").remove():($("#grid_"+this.name+"_rec_"+s).attr("expanded","yes").addClass("w2ui-expanded"),$("#grid_"+this.name+"_rec_"+s+"_expanded_row").show(),$("#grid_"+this.name+"_cell_"+this.get(e,!0)+"_expand div").html('<div class="w2ui-spinner" style="width: 16px; height: 16px; margin: -2px 2px;"></div>'),t.expanded=!0,setTimeout(o,300),this.trigger($.extend(a,{phase:"after"})),this.resizeRecords(),!0)},collapse:function(e){var t=this.get(e),i=this,s=w2utils.escapeId(e);if(0==$("#grid_"+this.name+"_rec_"+s+"_expanded_row").length)return!1;var r=this.trigger({phase:"before",type:"collapse",target:this.name,recid:e,box_id:"grid_"+this.name+"_rec_"+s+"_expanded"});return r.isCancelled!==!0?($("#grid_"+this.name+"_rec_"+s).removeAttr("expanded").removeClass("w2ui-expanded"),$("#grid_"+this.name+"_rec_"+s+"_expanded").css("opacity",0),$("#grid_"+this.name+"_cell_"+this.get(e,!0)+"_expand div").html("+"),setTimeout(function(){$("#grid_"+i.name+"_rec_"+s+"_expanded").height("0px"),setTimeout(function(){$("#grid_"+i.name+"_rec_"+s+"_expanded_row").remove(),delete t.expanded,i.trigger($.extend(r,{phase:"after"})),i.resizeRecords()},300)},200),!0):void 0},sort:function(e,t,i){var s=this.trigger({phase:"before",type:"sort",target:this.name,field:e,direction:t,multiField:i});if(s.isCancelled!==!0){if("undefined"!=typeof e){var r=this.sortData.length;for(var n in this.sortData)if(this.sortData[n].field==e){r=n;break}if("undefined"==typeof t||null==t)if("undefined"==typeof this.sortData[r])t="asc";else switch(String(this.sortData[r].direction)){case"asc":t="desc";break;case"desc":t="asc";break;default:t="asc"}this.multiSort===!1&&(this.sortData=[],r=0),1!=i&&(this.sortData=[],r=0),"undefined"==typeof this.sortData[r]&&(this.sortData[r]={}),this.sortData[r].field=e,this.sortData[r].direction=t}else this.sortData=[];this.selectNone();var a="object"!=typeof this.url?this.url:this.url.get;a?(this.trigger($.extend(s,{phase:"after"})),this.last.xhr_offset=0,this.reload()):(this.localSort(),this.searchData.length>0&&this.localSearch(!0),this.trigger($.extend(s,{phase:"after"})),this.refresh())}},copy:function(){var e=this.getSelection();if(0==e.length)return"";var t="";if("object"==typeof e[0]){var i=e[0].column,s=e[0].column,r=[];for(var n in e)e[n].column<i&&(i=e[n].column),e[n].column>s&&(s=e[n].column),-1==r.indexOf(e[n].index)&&r.push(e[n].index);r.sort();for(var a in r){for(var o=r[a],l=i;s>=l;l++){var d=this.columns[l];d.hidden!==!0&&(t+=w2utils.stripTags(this.getCellHTML(o,l))+"	")}t=t.substr(0,t.length-1),t+="\n"}}else{for(var l in this.columns){var d=this.columns[l];d.hidden!==!0&&(t+='"'+w2utils.stripTags(d.caption?d.caption:d.field)+'"	')}t=t.substr(0,t.length-1),t+="\n";for(var n in e){var o=this.get(e[n],!0);for(var l in this.columns){var d=this.columns[l];d.hidden!==!0&&(t+='"'+w2utils.stripTags(this.getCellHTML(o,l))+'"	')}t=t.substr(0,t.length-1),t+="\n"}}t=t.substr(0,t.length-1);var u=this.trigger({phase:"before",type:"copy",target:this.name,text:t});return u.isCancelled===!0?"":(t=u.text,this.trigger($.extend(u,{phase:"after"})),t)},paste:function(e){var t=this.getSelection(),i=this.get(t[0].recid,!0),s=t[0].column,r=this.trigger({phase:"before",type:"paste",target:this.name,text:e,index:i,column:s});if(r.isCancelled!==!0){if(e=r.text,"row"==this.selectType||0==t.length)return console.log("ERROR: You can paste only if grid.selectType = 'cell' and when at least one cell selected."),void this.trigger($.extend(r,{phase:"after"}));var n=[],e=e.split("\n");for(var a in e){var o=e[a].split("	"),l=0,d=this.records[i],u=[];for(var h in o)if(this.columns[s+l]){var f=this.columns[s+l].field;d.changes=d.changes||{},d.changes[f]=o[h],u.push(s+l),l++}for(var c in u)n.push({recid:d.recid,column:u[c]});i++}this.selectNone(),this.select.apply(this,n),this.refresh(),this.trigger($.extend(r,{phase:"after"}))}},resize:function(){var e=this,t=(new Date).getTime();if(this.box&&$(this.box).attr("name")==this.name){$(this.box).find("> div").css("width",$(this.box).width()).css("height",$(this.box).height());var i=this.trigger({phase:"before",type:"resize",target:this.name});if(i.isCancelled!==!0)return e.resizeBoxes(),e.resizeRecords(),this.trigger($.extend(i,{phase:"after"})),(new Date).getTime()-t}},refreshCell:function(e,t){var i=this.get(e,!0),s=this.records[i]&&this.records[i].recid==e?!1:!0,r=this.getColumn(t,!0),n=s?this.summary[i]:this.records[i],a=this.columns[r],o=$("#grid_"+this.name+"_rec_"+e+" [col="+r+"]");o.html(this.getCellHTML(i,r,s)),n.changes&&"undefined"!=typeof n.changes[a.field]?o.addClass("w2ui-changed"):o.removeClass("w2ui-changed")},refreshRow:function(e){var t=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(e));if(0!=t.length){var i=this.get(e,!0),s=t.attr("line"),r=this.records[i]&&this.records[i].recid==e?!1:!0,n="object"!=typeof this.url?this.url:this.url.get;if(this.searchData.length>0&&!n)for(var a in this.last.searchIds)this.last.searchIds[a]==i&&(i=a);$(t).replaceWith(this.getRecordHTML(i,s,r)),r&&this.resize()}},refresh:function(){var e=this,t=(new Date).getTime(),i="object"!=typeof this.url?this.url:this.url.get;if(this.total<=0&&!i&&0==this.searchData.length&&(this.total=this.records.length),this.toolbar.disable("w2ui-edit","w2ui-delete"),this.box){var s=this.trigger({phase:"before",target:this.name,type:"refresh"});if(s.isCancelled!==!0){if(this.show.header?$("#grid_"+this.name+"_header").html(this.header+"&nbsp;").show():$("#grid_"+this.name+"_header").hide(),this.show.toolbar){if(this.toolbar&&this.toolbar.get("w2ui-column-on-off")&&this.toolbar.get("w2ui-column-on-off").checked);else if($("#grid_"+this.name+"_toolbar").show(),"object"==typeof this.toolbar){var r=this.toolbar.items;for(var n in r)"w2ui-search"!=r[n].id&&"break"!=r[n].type&&this.toolbar.refresh(r[n].id)
}}else $("#grid_"+this.name+"_toolbar").hide();this.searchClose();var a=$("#grid_"+e.name+"_search_all");!this.multiSearch&&"all"==this.last.field&&this.searches.length>0&&(this.last.field=this.searches[0].field,this.last.caption=this.searches[0].caption);for(var o in this.searches)this.searches[o].field==this.last.field&&(this.last.caption=this.searches[o].caption);if(this.last.multi?a.attr("placeholder","["+w2utils.lang("Multiple Fields")+"]"):a.attr("placeholder",this.last.caption),a.val()!=this.last.search){var l=this.last.search,r=a.data("w2field");r&&(l=r.format(l)),a.val(l)}var r=this.find({summary:!0},!0);if(r.length>0){for(var n in r)this.summary.push(this.records[r[n]]);for(var n=r.length-1;n>=0;n--)this.records.splice(r[n],1);this.total=this.total-r.length}var d="";d+='<div id="grid_'+this.name+'_records" class="w2ui-grid-records"    onscroll="var obj = w2ui[\''+this.name+"'];         obj.last.scrollTop = this.scrollTop;         obj.last.scrollLeft = this.scrollLeft;         $('#grid_"+this.name+"_columns')[0].scrollLeft = this.scrollLeft;        $('#grid_"+this.name+"_summary')[0].scrollLeft = this.scrollLeft;        obj.scroll(event);\">"+this.getRecordsHTML()+'</div><div id="grid_'+this.name+'_columns" class="w2ui-grid-columns">    <table>'+this.getColumnsHTML()+"</table></div>",$("#grid_"+this.name+"_body").html(d),this.summary.length>0?$("#grid_"+this.name+"_summary").html(this.getSummaryHTML()).show():$("#grid_"+this.name+"_summary").hide(),this.show.footer?$("#grid_"+this.name+"_footer").html(this.getFooterHTML()).show():$("#grid_"+this.name+"_footer").hide(),this.searchData.length>0?$("#grid_"+this.name+"_searchClear").show():$("#grid_"+this.name+"_searchClear").hide();var u=this.last.selection;u.indexes.length==this.records.length||0!==this.searchData.length&&u.indexes.length==this.last.searchIds.length?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status();var h=e.find({expanded:!0},!0);for(var f in h)e.records[h[f]].expanded=!1;return setTimeout(function(){var t=$.trim($("#grid_"+e.name+"_search_all").val());""!=t&&$(e.box).find(".w2ui-grid-data > div").w2marker(t)},50),this.trigger($.extend(s,{phase:"after"})),e.resize(),e.addRange("selection"),setTimeout(function(){e.resize(),e.scroll()},1),e.reorderColumns&&!e.last.columnDrag?e.last.columnDrag=e.initColumnDrag():!e.reorderColumns&&e.last.columnDrag&&e.last.columnDrag.remove(),(new Date).getTime()-t}}},render:function(e){function n(e){if(1==e.which&&("text"==t.last.userSelect&&(delete t.last.userSelect,$(t.box).find(".w2ui-grid-body").css("user-select","none").css("-webkit-user-select","none").css("-moz-user-select","none").css("-ms-user-select","none"),$(this.box).on("selectstart",function(){return!1})),!($(e.target).parents().hasClass("w2ui-head")||$(e.target).hasClass("w2ui-head")||t.last.move&&"expand"==t.last.move.type))){if(e.altKey)$(t.box).off("selectstart"),$(t.box).find(".w2ui-grid-body").css("user-select","text").css("-webkit-user-select","text").css("-moz-user-select","text").css("-ms-user-select","text"),t.selectNone(),t.last.move={type:"text-select"},t.last.userSelect="text";else{if(!t.multiSelect)return;t.last.move={x:e.screenX,y:e.screenY,divX:0,divY:0,recid:$(e.target).parents("tr").attr("recid"),column:"TD"==e.target.tagName?$(e.target).attr("col"):$(e.target).parents("td").attr("col"),type:"select",ghost:!1,start:!0}}$(document).on("mousemove",a),$(document).on("mouseup",o)}}function a(e){var i=t.last.move;if(i&&"select"==i.type&&(i.divX=e.screenX-i.x,i.divY=e.screenY-i.y,!(Math.abs(i.divX)<=1&&Math.abs(i.divY)<=1))){if(t.last.cancelClick=!0,1==t.reorderRows){if(!i.ghost){var s=$("#grid_"+t.name+"_rec_"+i.recid),r=s.parents("table").find("tr:first-child").clone();i.offsetY=e.offsetY,i.from=i.recid,i.pos=s.position(),i.ghost=$(s).clone(!0),i.ghost.removeAttr("id"),s.find("td:first-child").replaceWith('<td colspan="1000" style="height: '+t.recordHeight+'px; background-color: #ddd"></td>');var n=$(t.box).find(".w2ui-grid-records");n.append('<table id="grid_'+t.name+'_ghost" style="position: absolute; z-index: 999999; opacity: 0.8; border-bottom: 2px dashed #aaa; border-top: 2px dashed #aaa; pointer-events: none;"></table>'),$("#grid_"+t.name+"_ghost").append(r).append(i.ghost)}var a=$(e.target).parents("tr").attr("recid");if(a!=i.from){var o=$("#grid_"+t.name+"_rec_"+i.recid),l=$("#grid_"+t.name+"_rec_"+a);e.screenY-i.lastY<0?o.after(l):l.after(o),i.lastY=e.screenY,i.to=a}var d=$("#grid_"+t.name+"_ghost"),n=$(t.box).find(".w2ui-grid-records");return void d.css({top:i.pos.top+i.divY+n.scrollTop(),left:i.pos.left})}i.start&&i.recid&&(t.selectNone(),i.start=!1);var u=[],a="TR"==e.target.tagName?$(e.target).attr("recid"):$(e.target).parents("tr").attr("recid");if("undefined"!=typeof a){var h=t.get(i.recid,!0);if(null!==h){var f=t.get(a,!0);if(null!==f){var c=parseInt(i.column),p=parseInt("TD"==e.target.tagName?$(e.target).attr("col"):$(e.target).parents("td").attr("col"));if(h>f){var r=h;h=f,f=r}var r="ind1:"+h+",ind2;"+f+",col1:"+c+",col2:"+p;if(i.range!=r){i.range=r;for(var g=h;f>=g;g++)if(!(t.last.searchIds.length>0&&-1==t.last.searchIds.indexOf(g)))if("row"!=t.selectType){if(c>p){var r=c;c=p,p=r}for(var r=[],m=c;p>=m;m++)t.columns[m].hidden||u.push({recid:t.records[g].recid,column:parseInt(m)})}else u.push(t.records[g].recid);if("row"!=t.selectType){var v=t.getSelection(),r=[];for(var w in u){var y=!1;for(var b in v)u[w].recid==v[b].recid&&u[w].column==v[b].column&&(y=!0);y||r.push({recid:u[w].recid,column:u[w].column})}t.select.apply(t,r);var r=[];for(var b in v){var y=!1;for(var w in u)u[w].recid==v[b].recid&&u[w].column==v[b].column&&(y=!0);y||r.push({recid:v[b].recid,column:v[b].column})}t.unselect.apply(t,r)}else if(t.multiSelect){var v=t.getSelection();for(var w in u)-1==v.indexOf(u[w])&&t.select(u[w]);for(var b in v)-1==u.indexOf(v[b])&&t.unselect(v[b])}}}}}}}function o(e){var i=t.last.move;if(setTimeout(function(){delete t.last.cancelClick},1),!$(e.target).parents().hasClass(".w2ui-head")&&!$(e.target).hasClass(".w2ui-head")){if(i&&"select"==i.type&&1==t.reorderRows){var s=t.get(i.from,!0),r=t.records[s];t.records.splice(s,1);var n=t.get(i.to,!0);s>n?t.records.splice(n,0,r):t.records.splice(n+1,0,r),$("#grid_"+t.name+"_ghost").remove(),t.refresh()}delete t.last.move,$(document).off("mousemove",a),$(document).off("mouseup",o)}}var t=this,i=(new Date).getTime();if("undefined"!=typeof e&&null!=e&&($(this.box).find("#grid_"+this.name+"_body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid").html(""),this.box=e),this.box){null==this.last.sortData&&(this.last.sortData=this.sortData);var s=this.trigger({phase:"before",target:this.name,type:"render",box:e});if(s.isCancelled!==!0){if($(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-grid").html('<div>    <div id="grid_'+this.name+'_header" class="w2ui-grid-header"></div>    <div id="grid_'+this.name+'_toolbar" class="w2ui-grid-toolbar"></div>    <div id="grid_'+this.name+'_body" class="w2ui-grid-body"></div>    <div id="grid_'+this.name+'_summary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_footer" class="w2ui-grid-footer"></div></div>'),"row"!=this.selectType&&$(this.box).addClass("w2ui-ss"),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),this.initToolbar(),null!=this.toolbar&&this.toolbar.render($("#grid_"+this.name+"_toolbar")[0]),this.last.field&&"all"!=this.last.field){var r=this.searchData;this.initAllField(this.last.field,1==r.length?r[0].value:null)}return $("#grid_"+this.name+"_footer").html(this.getFooterHTML()),this.last.state||(this.last.state=this.stateSave(!0)),this.stateRestore(),this.url&&this.refresh(),this.reload(),$(this.box).on("mousedown",n),$(this.box).on("selectstart",function(){return!1}),this.trigger($.extend(s,{phase:"after"})),0==$(".w2ui-layout").length&&(this.tmp_resize=function(){w2ui[t.name].resize()},$(window).off("resize",this.tmp_resize).on("resize",this.tmp_resize)),(new Date).getTime()-i}}},destroy:function(){var e=this.trigger({phase:"before",target:this.name,type:"destroy"});e.isCancelled!==!0&&($(window).off("resize",this.tmp_resize),"object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),$(this.box).find("#grid_"+this.name+"_body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid").html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})))},initColumnOnOff:function(){if(this.show.toolbarColumns){var e=this,t='<div class="w2ui-col-on-off"><table><tr><td style="width: 30px">    <input id="grid_'+this.name+'_column_ln_check" type="checkbox" tabIndex="-1" '+(e.show.lineNumbers?"checked":"")+"        onclick=\"w2ui['"+e.name+"'].columnOnOff(this, event, 'line-numbers');\"></td><td onclick=\"w2ui['"+e.name+"'].columnOnOff(this, event, 'line-numbers'); $('#w2ui-overlay')[0].hide();\">    <label for=\"grid_"+this.name+'_column_ln_check">'+w2utils.lang("Line #")+"</label></td></tr>";for(var i in this.columns){var s=this.columns[i],r=this.columns[i].caption;s.hideable!==!1&&(!r&&this.columns[i].hint&&(r=this.columns[i].hint),r||(r="- column "+(parseInt(i)+1)+" -"),t+='<tr><td style="width: 30px">    <input id="grid_'+this.name+"_column_"+i+'_check" type="checkbox" tabIndex="-1" '+(s.hidden?"":"checked")+"        onclick=\"w2ui['"+e.name+"'].columnOnOff(this, event, '"+s.field+'\');"></td><td>    <label for="grid_'+this.name+"_column_"+i+'_check">'+r+"</label></td></tr>")}t+='<tr><td colspan="2"><div style="border-top: 1px solid #ddd;"></div></td></tr>';var n="object"!=typeof this.url?this.url:this.url.get;n&&e.show.skipRecords&&(t+='<tr><td colspan="2" style="padding: 0px">    <div style="cursor: pointer; padding: 2px 8px; cursor: default">'+w2utils.lang("Skip")+'        <input type="text" style="width: 45px" value="'+this.offset+'"             onkeypress="if (event.keyCode == 13) {                w2ui[\''+e.name+"'].skip(this.value);                $('#w2ui-overlay')[0].hide();             }\"> "+w2utils.lang("Records")+"    </div></td></tr>"),t+='<tr><td colspan="2" onclick="w2ui[\''+e.name+"'].stateSave(); $('#w2ui-overlay')[0].hide();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Save Grid State")+'</div></td></tr><tr><td colspan="2" onclick="w2ui[\''+e.name+"'].stateReset(); $('#w2ui-overlay')[0].hide();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Restore Default State")+"</div></td></tr>",t+="</table></div>",this.toolbar.get("w2ui-column-on-off").html=t}},initColumnDrag:function(){function s(){i.pressed=!1,clearTimeout(i.timeout)}function r(e){i.timeout&&clearTimeout(i.timeout);var s=this;i.pressed=!0,i.timeout=setTimeout(function(){if(i.pressed){var r,o,l,d,u,h=["w2ui-col-number","w2ui-col-expand","w2ui-col-select"],f=["w2ui-head-last"],c=h.concat(f),p=".w2ui-col-number, .w2ui-col-expand, .w2ui-col-select",g=".w2ui-head.w2ui-col-number, .w2ui-head.w2ui-col-expand, .w2ui-head.w2ui-col-select";if($(e.originalEvent.target).parents().hasClass("w2ui-head")){for(var m=0,v=c.length;v>m;m++)if($(e.originalEvent.target).parents().hasClass(c[m]))return;if(i.numberPreColumnsPresent=$(t.box).find(g).length,i.columnHead=d=$(e.originalEvent.target).parents(".w2ui-head"),u=parseInt(d.attr("col"),10),r=t.trigger({type:"columnDragStart",phase:"before",originalEvent:e,origColumnNumber:u,target:d[0]}),r.isCancelled===!0)return!1;o=i.columns=$(t.box).find(".w2ui-head:not(.w2ui-head-last)"),$(document).on("mouseup",a),$(document).on("mousemove",n),i.originalPos=parseInt($(e.originalEvent.target).parent(".w2ui-head").attr("col"),10),i.ghost=$(s).clone(!0),$(i.ghost).find('[col]:not([col="'+i.originalPos+'"]), .w2ui-toolbar, .w2ui-grid-header').remove(),$(i.ghost).find(p).remove(),$(i.ghost).find(".w2ui-grid-body").css({top:0}),l=$(i.ghost).find('[col="'+i.originalPos+'"]'),$(document.body).append(i.ghost),$(i.ghost).css({width:0,height:0,margin:0,position:"fixed",zIndex:999999,opacity:0}).addClass(".w2ui-grid-ghost").animate({width:l.width(),height:$(t.box).find(".w2ui-grid-body:first").height(),left:e.pageX,top:e.pageY,opacity:.8},0),i.offsets=[];for(var m=0,v=o.length;v>m;m++)i.offsets.push($(o[m]).offset().left);t.trigger($.extend(r,{phase:"after"}))}}},150)}function n(e){if(i.pressed){var t=e.originalEvent.pageX,s=e.originalEvent.pageY,r=i.offsets,n=$(".w2ui-head:not(.w2ui-head-last)").width();i.targetInt=Math.max(i.numberPreColumnsPresent,l(t,r,n)),o(i.targetInt),d(t,s)}}function a(e){i.pressed=!1;var s,r,o,l,d,u=$(".w2ui-grid-ghost");return s=t.trigger({type:"columnDragEnd",phase:"before",originalEvent:e,target:i.columnHead[0]}),s.isCancelled===!0?!1:(o=t.columns[i.originalPos],l=t.columns,d=$(i.columns[Math.min(i.lastInt,i.columns.length-1)]),r=i.lastInt<i.columns.length?parseInt(d.attr("col")):l.length,r!==i.originalPos+1&&r!==i.originalPos&&d&&d.length?($(i.ghost).animate({top:$(t.box).offset().top,left:d.offset().left,width:0,height:0,opacity:.2},300,function(){$(this).remove(),u.remove()}),l.splice(r,0,$.extend({},o)),l.splice(l.indexOf(o),1)):($(i.ghost).remove(),u.remove()),$(document).off("mouseup",a),$(document).off("mousemove",n),i.marker&&i.marker.remove(),i={},t.refresh(),void t.trigger($.extend(s,{phase:"after",targetColumnNumber:r-1})))}function o(e){i.marker||i.markerLeft||(i.marker=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>'),i.markerLeft=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>')),i.lastInt&&i.lastInt===e||(i.lastInt=e,i.marker.remove(),i.markerLeft.remove(),$(".w2ui-head").removeClass("w2ui-col-intersection"),e>=i.columns.length?($(i.columns[i.columns.length-1]).children("div:last").append(i.marker.addClass("right").removeClass("left")),$(i.columns[i.columns.length-1]).addClass("w2ui-col-intersection")):e<=i.numberPreColumnsPresent?($(i.columns[i.numberPreColumnsPresent]).prepend(i.marker.addClass("left").removeClass("right")).css({position:"relative"}),$(i.columns[i.numberPreColumnsPresent]).prev().addClass("w2ui-col-intersection")):($(i.columns[e]).children("div:last").prepend(i.marker.addClass("left").removeClass("right")),$(i.columns[e]).prev().children("div:last").append(i.markerLeft.addClass("right").removeClass("left")).css({position:"relative"}),$(i.columns[e-1]).addClass("w2ui-col-intersection")))}function l(e,t,i){if(e<=t[0])return 0;if(e>=t[t.length-1]+i)return t.length;for(var s=0,r=t.length;r>s;s++){var n=t[s],a=t[s+1]||t[s]+i,o=(a-t[s])/2+t[s];if(e>n&&o>=e)return s;if(e>o&&a>=e)return s+1}return intersection}function d(e,t){$(i.ghost).css({left:e-10,top:t-10})}if(this.columnGroups&&this.columnGroups.length)throw"Draggable columns are not currently supported with column groups.";var t=this,i={};return i.lastInt=null,i.pressed=!1,i.timeout=null,i.columnHead=null,$(t.box).on("mousedown",r),$(t.box).on("mouseup",s),{remove:function(){$(t.box).off("mousedown",r),$(t.box).off("mouseup",s),$(t.box).find(".w2ui-head").removeAttr("draggable"),t.last.columnDrag=!1}}},columnOnOff:function(e,t,i){var s=this.trigger({phase:"before",target:this.name,type:"columnOnOff",checkbox:e,field:i,originalEvent:t});if(s.isCancelled!==!0){var r=this;for(var n in this.records)this.records[n].expanded===!0&&(this.records[n].expanded=!1);var a=!0;if("line-numbers"==i)this.show.lineNumbers=!this.show.lineNumbers,this.refresh();else{var o=this.getColumn(i);o.hidden?($(e).prop("checked",!0),this.showColumn(o.field)):($(e).prop("checked",!1),this.hideColumn(o.field)),a=!1}a&&setTimeout(function(){$().w2overlay("",{name:"searches-"+this.name}),r.toolbar.uncheck("column-on-off")},100),this.trigger($.extend(s,{phase:"after"}))}},initToolbar:function(){if("undefined"==typeof this.toolbar.render){var e=this.toolbar.items;if(this.toolbar.items=[],this.toolbar=$().w2toolbar($.extend(!0,{},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.show.toolbarReload&&this.toolbar.items.push($.extend(!0,{},this.buttons.reload)),this.show.toolbarColumns&&this.toolbar.items.push($.extend(!0,{},this.buttons.columns)),(this.show.toolbarReload||this.show.toolbarColumn)&&this.toolbar.items.push({type:"break",id:"w2ui-break0"}),this.show.toolbarSearch){var t='<div class="w2ui-toolbar-search"><table cellpadding="0" cellspacing="0"><tr>    <td>'+this.buttons.search.html+'</td>    <td>        <input id="grid_'+this.name+'_search_all" class="w2ui-search-all"             placeholder="'+this.last.caption+'" value="'+this.last.search+"\"            onkeydown=\"if (event.keyCode == 13 && w2utils.isIE) this.onchange();\"            onchange=\"                var val = this.value;                 var fld = $(this).data('w2field');                 var dat = $(this).data('selected');                 if (fld) val = fld.clean(val);                if (dat != null && $.isPlainObject(dat)) val = dat.id;                w2ui['"+this.name+"'].search(w2ui['"+this.name+'\'].last.field, val);             ">    </td>    <td>        <div title="'+w2utils.lang("Clear Search")+'" class="w2ui-search-clear" id="grid_'+this.name+'_searchClear"               onclick="var obj = w2ui[\''+this.name+"']; obj.searchReset();\"         >&nbsp;&nbsp;</div>    </td></tr></table></div>";this.toolbar.items.push({type:"html",id:"w2ui-search",html:t}),this.multiSearch&&this.searches.length>0&&this.toolbar.items.push($.extend(!0,{},this.buttons["search-go"]))}this.show.toolbarSearch&&(this.show.toolbarAdd||this.show.toolbarEdit||this.show.toolbarDelete||this.show.toolbarSave)&&this.toolbar.items.push({type:"break",id:"w2ui-break1"}),this.show.toolbarAdd&&this.toolbar.items.push($.extend(!0,{},this.buttons.add)),this.show.toolbarEdit&&this.toolbar.items.push($.extend(!0,{},this.buttons.edit)),this.show.toolbarDelete&&this.toolbar.items.push($.extend(!0,{},this.buttons["delete"])),this.show.toolbarSave&&((this.show.toolbarAdd||this.show.toolbarDelete||this.show.toolbarEdit)&&this.toolbar.items.push({type:"break",id:"w2ui-break2"}),this.toolbar.items.push($.extend(!0,{},this.buttons.save)));for(var i in e)this.toolbar.items.push(e[i]);var s=this;this.toolbar.on("click",function(e){function o(){$("#w2ui-overlay-searches-"+s.name).data("keepOpen")!==!0&&(n.uncheck(i),$(document).off("click","body",o))}var t=s.trigger({phase:"before",type:"toolbar",target:e.target,originalEvent:e});if(t.isCancelled!==!0){var i=e.target;switch(i){case"w2ui-reload":var r=s.trigger({phase:"before",type:"reload",target:s.name});if(r.isCancelled===!0)return!1;s.reload(),s.trigger($.extend(r,{phase:"after"}));break;case"w2ui-column-on-off":s.initColumnOnOff(),s.initResize(),s.resize();break;case"w2ui-search-advanced":var n=this,a=this.get(i);a.checked?(s.searchClose(),setTimeout(function(){n.uncheck(i)},1)):(s.searchOpen(),e.originalEvent.stopPropagation(),$(document).on("click","body",o));break;case"w2ui-add":var t=s.trigger({phase:"before",target:s.name,type:"add",recid:null});s.trigger($.extend(t,{phase:"after"}));break;case"w2ui-edit":var l=s.getSelection(),d=null;1==l.length&&(d=l[0]);var t=s.trigger({phase:"before",target:s.name,type:"edit",recid:d});s.trigger($.extend(t,{phase:"after"}));break;case"w2ui-delete":s["delete"]();break;case"w2ui-save":s.save()}s.trigger($.extend(t,{phase:"after"}))}})}},initResize:function(){var e=this;$(this.box).find(".w2ui-resizer").off("click").on("click",function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault&&e.preventDefault()}).off("mousedown").on("mousedown",function(t){t||(t=window.event),window.addEventListener||window.document.attachEvent("onselectstart",function(){return!1}),e.resizing=!0,e.last.tmp={x:t.screenX,y:t.screenY,gx:t.screenX,gy:t.screenY,col:parseInt($(this).attr("name"))},t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault&&t.preventDefault();for(var i in e.columns)"undefined"==typeof e.columns[i].sizeOriginal&&(e.columns[i].sizeOriginal=e.columns[i].size),e.columns[i].size=e.columns[i].sizeCalculated;var s={phase:"before",type:"columnResize",target:e.name,column:e.last.tmp.col,field:e.columns[e.last.tmp.col].field};s=e.trigger($.extend(s,{resizeBy:0,originalEvent:t}));var r=function(t){if(1==e.resizing){if(t||(t=window.event),s=e.trigger($.extend(s,{resizeBy:t.screenX-e.last.tmp.gx,originalEvent:t})),s.isCancelled===!0)return void(s.isCancelled=!1);e.last.tmp.x=t.screenX-e.last.tmp.x,e.last.tmp.y=t.screenY-e.last.tmp.y,e.columns[e.last.tmp.col].size=parseInt(e.columns[e.last.tmp.col].size)+e.last.tmp.x+"px",e.resizeRecords(),e.last.tmp.x=t.screenX,e.last.tmp.y=t.screenY}},n=function(t){delete e.resizing,$(document).off("mousemove","body"),$(document).off("mouseup","body"),e.resizeRecords(),e.trigger($.extend(s,{phase:"after",originalEvent:t}))};$(document).on("mousemove","body",r),$(document).on("mouseup","body",n)}).each(function(e,t){var i=$(t).parent();$(t).css({height:"25px","margin-left":i.width()-3+"px"})})},resizeBoxes:function(){{var t=($(this.box).find("> div"),$("#grid_"+this.name+"_header")),i=$("#grid_"+this.name+"_toolbar"),s=$("#grid_"+this.name+"_summary"),r=$("#grid_"+this.name+"_footer"),n=$("#grid_"+this.name+"_body");$("#grid_"+this.name+"_columns"),$("#grid_"+this.name+"_records")}this.show.header&&t.css({top:"0px",left:"0px",right:"0px"}),this.show.toolbar&&i.css({top:0+(this.show.header?w2utils.getSize(t,"height"):0)+"px",left:"0px",right:"0px"}),this.show.footer&&r.css({bottom:"0px",left:"0px",right:"0px"}),this.summary.length>0&&s.css({bottom:0+(this.show.footer?w2utils.getSize(r,"height"):0)+"px",left:"0px",right:"0px"}),n.css({top:0+(this.show.header?w2utils.getSize(t,"height"):0)+(this.show.toolbar?w2utils.getSize(i,"height"):0)+"px",bottom:0+(this.show.footer?w2utils.getSize(r,"height"):0)+(this.summary.length>0?w2utils.getSize(s,"height"):0)+"px",left:"0px",right:"0px"})},resizeRecords:function(){var e=this;$(this.box).find(".w2ui-empty-record").remove();var t=$(this.box),i=$(this.box).find("> div"),s=$("#grid_"+this.name+"_header"),r=$("#grid_"+this.name+"_toolbar"),n=$("#grid_"+this.name+"_summary"),a=$("#grid_"+this.name+"_footer"),o=$("#grid_"+this.name+"_body"),l=$("#grid_"+this.name+"_columns"),d=$("#grid_"+this.name+"_records");if(this.fixedBody){var u=i.height()-(this.show.header?w2utils.getSize(s,"height"):0)-(this.show.toolbar?w2utils.getSize(r,"height"):0)-("none"!=n.css("display")?w2utils.getSize(n,"height"):0)-(this.show.footer?w2utils.getSize(a,"height"):0);o.css("height",u)}else{var u=w2utils.getSize(l,"height")+w2utils.getSize($("#grid_"+e.name+"_records table"),"height");e.height=u+w2utils.getSize(i,"+height")+(e.show.header?w2utils.getSize(s,"height"):0)+(e.show.toolbar?w2utils.getSize(r,"height"):0)+("none"!=n.css("display")?w2utils.getSize(n,"height"):0)+(e.show.footer?w2utils.getSize(a,"height"):0),i.css("height",e.height),o.css("height",u),t.css("height",w2utils.getSize(i,"height")+w2utils.getSize(t,"+height"))}var h=this.records.length;0==this.searchData.length||this.url||(h=this.last.searchIds.length);var f=!1,c=!1;if(o.width()<$(d).find(">table").width()&&(f=!0),o.height()-l.height()<$(d).find(">table").height()+(f?w2utils.scrollBarSize():0)&&(c=!0),this.fixedBody||(c=!1,f=!1),f||c?(l.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show(),d.css({top:(this.columnGroups.length>0&&this.show.columns?1:0)+w2utils.getSize(l,"height")+"px","-webkit-overflow-scrolling":"touch","overflow-x":f?"auto":"hidden","overflow-y":c?"auto":"hidden"})):(l.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").hide(),d.css({top:(this.columnGroups.length>0&&this.show.columns?1:0)+w2utils.getSize(l,"height")+"px",overflow:"hidden"}),d.length>0&&(this.last.scrollTop=0,this.last.scrollLeft=0)),this.show.emptyRecords&&!c){var p=Math.floor(d.height()/this.recordHeight)+1;if(this.fixedBody)for(var g=h;p>=g;g++){var m="";m+='<tr class="'+(g%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" style="height: '+this.recordHeight+'px">',this.show.lineNumbers&&(m+='<td class="w2ui-col-number"></td>'),this.show.selectColumn&&(m+='<td class="w2ui-grid-data w2ui-col-select"></td>'),this.show.expandColumn&&(m+='<td class="w2ui-grid-data w2ui-col-expand"></td>');for(var v=0;this.columns.length>0;){var w=this.columns[v];if(w.hidden){if(v++,"undefined"==typeof this.columns[v])break}else if(m+='<td class="w2ui-grid-data" '+("undefined"!=typeof w.attr?w.attr:"")+' col="'+v+'"></td>',v++,"undefined"==typeof this.columns[v])break}m+='<td class="w2ui-grid-data-last"></td>',m+="</tr>",$("#grid_"+this.name+"_records > table").append(m)}}if(o.length>0){for(var y=parseInt(o.width())-(c?w2utils.scrollBarSize():0)-(this.show.lineNumbers?34:0)-(this.show.selectColumn?26:0)-(this.show.expandColumn?26:0),b=y,x=0,_=!1,k=0;k<this.columns.length;k++){var w=this.columns[k];w.gridMinWidth>0&&(w.gridMinWidth>b&&w.hidden!==!0&&(w.hidden=!0,_=!0),w.gridMinWidth<b&&w.hidden===!0&&(w.hidden=!1,_=!0))}if(_===!0)return void this.refresh();for(var k=0;k<this.columns.length;k++){var w=this.columns[k];w.hidden||("px"==String(w.size).substr(String(w.size).length-2).toLowerCase()?(y-=parseFloat(w.size),this.columns[k].sizeCalculated=w.size,this.columns[k].sizeType="px"):(x+=parseFloat(w.size),this.columns[k].sizeType="%",delete w.sizeCorrected))}if(100!=x&&x>0)for(var k=0;k<this.columns.length;k++){var w=this.columns[k];w.hidden||"%"==w.sizeType&&(w.sizeCorrected=Math.round(100*parseFloat(w.size)*100/x)/100+"%")}for(var k=0;k<this.columns.length;k++){var w=this.columns[k];w.hidden||"%"==w.sizeType&&(this.columns[k].sizeCalculated="undefined"!=typeof this.columns[k].sizeCorrected?Math.floor(y*parseFloat(w.sizeCorrected)/100)-1+"px":Math.floor(y*parseFloat(w.size)/100)-1+"px")}}for(var C=0,k=0;k<this.columns.length;k++){var w=this.columns[k];w.hidden||("undefined"==typeof w.min&&(w.min=20),parseInt(w.sizeCalculated)<parseInt(w.min)&&(w.sizeCalculated=w.min+"px"),parseInt(w.sizeCalculated)>parseInt(w.max)&&(w.sizeCalculated=w.max+"px"),C+=parseInt(w.sizeCalculated))}var T=parseInt(b)-parseInt(C);if(T>0&&x>0)for(var k=0;;){var w=this.columns[k];if("undefined"!=typeof w)if(w.hidden||"px"==w.sizeType)k++;else{if(w.sizeCalculated=parseInt(w.sizeCalculated)+1+"px",T--,0==T)break;k++}else k=0}else T>0&&l.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show();l.find("> table > tbody > tr:nth-child(1) td").each(function(t,i){var s=$(i).attr("col");"undefined"!=typeof s&&e.columns[s]&&$(i).css("width",e.columns[s].sizeCalculated),$(i).hasClass("w2ui-head-last")&&$(i).css("width",w2utils.scrollBarSize()+(T>0&&0==x?T:0)+"px")}),3==l.find("> table > tbody > tr").length&&l.find("> table > tbody > tr:nth-child(1) td").html("").css({height:"0px",border:"0px",padding:"0px",margin:"0px"}),d.find("> table > tbody > tr:nth-child(1) td").each(function(t,i){var s=$(i).attr("col");"undefined"!=typeof s&&e.columns[s]&&$(i).css("width",e.columns[s].sizeCalculated),$(i).hasClass("w2ui-grid-data-last")&&$(i).css("width",(T>0&&0==x?T:0)+"px")}),n.find("> table > tbody > tr:nth-child(1) td").each(function(t,i){var s=$(i).attr("col");"undefined"!=typeof s&&e.columns[s]&&$(i).css("width",e.columns[s].sizeCalculated),$(i).hasClass("w2ui-grid-data-last")&&$(i).css("width",w2utils.scrollBarSize()+(T>0&&0==x?T:0)+"px")}),this.initResize(),this.refreshRanges(),(this.last.scrollTop||this.last.scrollLeft)&&d.length>0&&(l.prop("scrollLeft",this.last.scrollLeft),d.prop("scrollTop",this.last.scrollTop),d.prop("scrollLeft",this.last.scrollLeft))},getSearchesHTML:function(){for(var e='<table cellspacing="0">',t=!1,i=0;i<this.searches.length;i++){var s=this.searches[i];if(s.type=String(s.type).toLowerCase(),!s.hidden){var r="";if(0==t&&(r='<button class="btn close-btn" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.searchClose(); }\">X</button",t=!0),"undefined"==typeof s.inTag&&(s.inTag=""),"undefined"==typeof s.outTag&&(s.outTag=""),"undefined"==typeof s.type&&(s.type="text"),-1!=["text","alphanumeric","combo"].indexOf(s.type))var n='<select id="grid_'+this.name+"_operator_"+i+'" onclick="event.stopPropagation();">    <option value="is">'+w2utils.lang("is")+'</option>    <option value="begins">'+w2utils.lang("begins")+'</option>    <option value="contains">'+w2utils.lang("contains")+'</option>    <option value="ends">'+w2utils.lang("ends")+"</option></select>";if(-1!=["int","float","money","currency","percent","date","time"].indexOf(s.type))var n='<select id="grid_'+this.name+"_operator_"+i+'"         onchange="w2ui[\''+this.name+"'].initOperator(this, "+i+');" onclick="event.stopPropagation();">    <option value="is">'+w2utils.lang("is")+"</option>"+(-1!=["int"].indexOf(s.type)?'<option value="in">'+w2utils.lang("in")+"</option>":"")+(-1!=["int"].indexOf(s.type)?'<option value="not in">'+w2utils.lang("not in")+"</option>":"")+'<option value="between">'+w2utils.lang("between")+"</option></select>";if(-1!=["select","list","hex"].indexOf(s.type))var n='<select id="grid_'+this.name+"_operator_"+i+'" onclick="event.stopPropagation();">    <option value="is">'+w2utils.lang("is")+"</option></select>";if(-1!=["enum"].indexOf(s.type))var n='<select id="grid_'+this.name+"_operator_"+i+'" onclick="event.stopPropagation();">    <option value="in">'+w2utils.lang("in")+'</option>    <option value="not in">'+w2utils.lang("not in")+"</option></select>";switch(e+='<tr>    <td class="close-btn">'+r+'</td>    <td class="caption">'+s.caption+'</td>    <td class="operator">'+n+'</td>    <td class="value">',s.type){case"text":case"alphanumeric":case"hex":case"list":case"combo":case"enum":e+='<input rel="search" type="text" style="width: 300px;" id="grid_'+this.name+"_field_"+i+'" name="'+s.field+'" '+s.inTag+">";break;case"int":case"float":case"money":case"currency":case"percent":case"date":case"time":e+='<input rel="search" type="text" size="12" id="grid_'+this.name+"_field_"+i+'" name="'+s.field+'" '+s.inTag+'><span id="grid_'+this.name+"_range_"+i+'" style="display: none">&nbsp;-&nbsp;&nbsp;<input rel="search" type="text" style="width: 90px" id="grid_'+this.name+"_field2_"+i+'" name="'+s.field+'" '+s.inTag+"></span>";break;case"select":e+='<select rel="search" id="grid_'+this.name+"_field_"+i+'" name="'+s.field+'" '+s.inTag+'  onclick="event.stopPropagation();"></select>'}e+=s.outTag+"    </td></tr>"}}return e+='<tr>    <td colspan="4" class="actions">        <div>        <button class="btn" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.searchReset(); }\">"+w2utils.lang("Reset")+'</button>        <button class="btn btn-blue" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.search(); }\">"+w2utils.lang("Search")+"</button>        </div>    </td></tr></table>"},initOperator:function(e,t){var i=this,s=i.searches[t],r=$("#grid_"+i.name+"_range_"+t),n=$("#grid_"+i.name+"_field_"+t),a=n.parent().find("span input");n.w2field("in"==$(e).val()||"not in"==$(e).val()?"clear":s.type),"between"==$(e).val()?(r.show(),a.w2field(s.type)):r.hide()},initSearches:function(){var e=this;for(var t in this.searches){var i=this.searches[t],s=this.getSearchData(i.field);switch(i.type=String(i.type).toLowerCase(),"object"!=typeof i.options&&(i.options={}),i.type){case"text":case"alphanumeric":$("#grid_"+this.name+"_operator_"+t).val("begins"),-1!=["alphanumeric","hex"].indexOf(i.type)&&$("#grid_"+this.name+"_field_"+t).w2field(i.type,i.options);break;case"int":case"float":case"money":case"currency":case"percent":case"date":case"time":if(s&&"int"==s.type&&-1!=["in","not in"].indexOf(s.operator))break;$("#grid_"+this.name+"_field_"+t).w2field(i.type,i.options),$("#grid_"+this.name+"_field2_"+t).w2field(i.type,i.options),setTimeout(function(){$("#grid_"+e.name+"_field_"+t).keydown(),$("#grid_"+e.name+"_field2_"+t).keydown()},1);break;case"hex":break;case"list":case"combo":case"enum":var r=i.options;"list"==i.type&&(r.selected={}),"enum"==i.type&&(r.selected=[]),s&&(r.selected=s.value),$("#grid_"+this.name+"_field_"+t).w2field(i.type,r),"combo"==i.type&&$("#grid_"+this.name+"_operator_"+t).val("begins");
break;case"select":var r='<option value="">--</option>';for(var n in i.options.items){var a=i.options.items[n];if($.isPlainObject(i.options.items[n])){var o=a.id,l=a.text;"undefined"==typeof o&&"undefined"!=typeof a.value&&(o=a.value),"undefined"==typeof l&&"undefined"!=typeof a.caption&&(l=a.caption),null==o&&(o=""),r+='<option value="'+o+'">'+l+"</option>"}else r+='<option value="'+a+'">'+a+"</option>"}$("#grid_"+this.name+"_field_"+t).html(r)}null!=s&&("int"==s.type&&-1!=["in","not in"].indexOf(s.operator)&&$("#grid_"+this.name+"_field_"+t).w2field("clear").val(s.value),$("#grid_"+this.name+"_operator_"+t).val(s.operator).trigger("change"),$.isArray(s.value)?-1!=["in","not in"].indexOf(s.operator)?$("#grid_"+this.name+"_field_"+t).val(s.value).trigger("change"):($("#grid_"+this.name+"_field_"+t).val(s.value[0]).trigger("change"),$("#grid_"+this.name+"_field2_"+t).val(s.value[1]).trigger("change")):"udefined"!=typeof s.value&&$("#grid_"+this.name+"_field_"+t).val(s.value).trigger("change"))}$("#w2ui-overlay-searches-"+this.name+" .w2ui-grid-searches *[rel=search]").on("keypress",function(t){13==t.keyCode&&(e.search(),$().w2overlay())})},getColumnsHTML:function(){function i(){var t="<tr>";""!=e.columnGroups[e.columnGroups.length-1].caption&&e.columnGroups.push({caption:""}),e.show.lineNumbers&&(t+='<td class="w2ui-head w2ui-col-number">    <div>&nbsp;</div></td>'),e.show.selectColumn&&(t+='<td class="w2ui-head w2ui-col-select">    <div>&nbsp;</div></td>'),e.show.expandColumn&&(t+='<td class="w2ui-head w2ui-col-expand">    <div>&nbsp;</div></td>');for(var i=0,s=0;s<e.columnGroups.length;s++){var r=e.columnGroups[s],n=e.columns[i];if(("undefined"==typeof r.span||r.span!=parseInt(r.span))&&(r.span=1),"undefined"!=typeof r.colspan&&(r.span=r.colspan),r.master===!0){var a="";for(var o in e.sortData)e.sortData[o].field==n.field&&(RegExp("asc","i").test(e.sortData[o].direction)&&(a="w2ui-sort-up"),RegExp("desc","i").test(e.sortData[o].direction)&&(a="w2ui-sort-down"));var l="";n.resizable!==!1&&(l='<div class="w2ui-resizer" name="'+i+'"></div>'),t+='<td class="w2ui-head '+a+'" col="'+i+'" rowspan="2" colspan="'+(r.span+(s==e.columnGroups.length-1?1:0))+'"     onclick="w2ui[\''+e.name+"'].columnClick('"+n.field+"', event);\">"+l+'    <div class="w2ui-col-group w2ui-col-header '+(a?"w2ui-col-sorted":"")+'">        <div class="'+a+'"></div>'+(n.caption?n.caption:"&nbsp;")+"    </div></td>"}else t+='<td class="w2ui-head" col="'+i+'"         colspan="'+(r.span+(s==e.columnGroups.length-1?1:0))+'">    <div class="w2ui-col-group">'+(r.caption?r.caption:"&nbsp;")+"    </div></td>";i+=r.span}return t+="</tr>"}function s(t){var i="<tr>",s=!e.reorderColumns||e.columnGroups&&e.columnGroups.length?"":" w2ui-reorder-cols-head ";e.show.lineNumbers&&(i+='<td class="w2ui-head w2ui-col-number" onclick="w2ui[\''+e.name+"'].columnClick('line-number', event);\">    <div>#</div></td>"),e.show.selectColumn&&(i+='<td class="w2ui-head w2ui-col-select"         onclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">    <div>        <input type="checkbox" id="grid_'+e.name+'_check_all" tabIndex="-1"            style="'+(0==e.multiSelect?"display: none;":"")+'"            onclick="if (this.checked) w2ui[\''+e.name+"'].selectAll();                      else w2ui['"+e.name+"'].selectNone();                      if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">    </div></td>"),e.show.expandColumn&&(i+='<td class="w2ui-head w2ui-col-expand">    <div>&nbsp;</div></td>');for(var r=0,n=0,a=0;a<e.columns.length;a++){var o=e.columns[a],l={};if(a==n&&(n+="undefined"!=typeof e.columnGroups[r]?parseInt(e.columnGroups[r].span):0,r++),"undefined"!=typeof e.columnGroups[r-1])var l=e.columnGroups[r-1];if(!o.hidden){var d="";for(var u in e.sortData)e.sortData[u].field==o.field&&(RegExp("asc","i").test(e.sortData[u].direction)&&(d="w2ui-sort-up"),RegExp("desc","i").test(e.sortData[u].direction)&&(d="w2ui-sort-down"));if(l.master!==!0||t){var h="";o.resizable!==!1&&(h='<div class="w2ui-resizer" name="'+a+'"></div>'),i+='<td col="'+a+'" class="w2ui-head '+d+s+'"     onclick="w2ui[\''+e.name+"'].columnClick('"+o.field+"', event);\">"+h+'    <div class="w2ui-col-header '+(d?"w2ui-col-sorted":"")+'">        <div class="'+d+'"></div>'+(o.caption?o.caption:"&nbsp;")+"    </div></td>"}}}return i+='<td class="w2ui-head w2ui-head-last"><div>&nbsp;</div></td>',i+="</tr>"}var e=this,t="";return this.show.columnHeaders&&(t=this.columnGroups.length>0?s(!0)+i()+s(!1):s(!0)),t},getRecordsHTML:function(){var e=this.records.length;0==this.searchData.length||this.url||(e=this.last.searchIds.length),this.show_extra=e>300?30:300;var t=$("#grid_"+this.name+"_records"),i=Math.floor(t.height()/this.recordHeight)+this.show_extra+1;(!this.fixedBody||i>e)&&(i=e);var s="<table>"+this.getRecordHTML(-1,0);s+='<tr id="grid_'+this.name+'_rec_top" line="top" style="height: 0px">    <td colspan="200"></td></tr>';for(var r=0;i>r;r++)s+=this.getRecordHTML(r,r+1);return s+='<tr id="grid_'+this.name+'_rec_bottom" line="bottom" style="height: '+(e-i)*this.recordHeight+'px">    <td colspan="200"></td></tr><tr id="grid_'+this.name+'_rec_more" style="display: none">    <td colspan="200" class="w2ui-load-more"></td></tr></table>',this.last.range_start=0,this.last.range_end=i,s},getSummaryHTML:function(){if(0!=this.summary.length){for(var e="<table>",t=0;t<this.summary.length;t++)e+=this.getRecordHTML(t,t+1,!0);return e+="</table>"}},scroll:function(){function _(){i.markSearch!==!1&&(clearTimeout(i.last.marker_timer),i.last.marker_timer=setTimeout(function(){var e=[];for(var t in i.searchData){var s=i.searchData[t];-1==$.inArray(s.value,e)&&e.push(s.value)}e.length>0&&$(i.box).find(".w2ui-grid-data > div").w2marker(e)},50))}var i=((new Date).getTime(),this),s=$("#grid_"+this.name+"_records"),r=this.records.length;if(0==this.searchData.length||this.url||(r=this.last.searchIds.length),0!=r&&0!=s.length&&0!=s.height()){if(this.show_extra=r>300?30:300,s.height()<r*this.recordHeight&&"hidden"==s.css("overflow-y"))return void(this.total>0&&this.refresh());var n=Math.round(s[0].scrollTop/this.recordHeight+1),a=n+(Math.round(s.height()/this.recordHeight)-1);n>r&&(n=r),a>r&&(a=r);var o="object"!=typeof this.url?this.url:this.url.get;if($("#grid_"+this.name+"_footer .w2ui-footer-right").html(w2utils.formatNumber(this.offset+n)+"-"+w2utils.formatNumber(this.offset+a)+" "+w2utils.lang("of")+" "+w2utils.formatNumber(this.total)+(o?" ("+w2utils.lang("buffered")+" "+w2utils.formatNumber(r)+(this.offset>0?", skip "+w2utils.formatNumber(this.offset):"")+")":"")),o||this.fixedBody&&!(this.total<=300)){var l=Math.floor(s[0].scrollTop/this.recordHeight)-this.show_extra,d=l+Math.floor(s.height()/this.recordHeight)+2*this.show_extra+1;1>l&&(l=1),d>this.total&&(d=this.total);var u=s.find("#grid_"+this.name+"_rec_top"),h=s.find("#grid_"+this.name+"_rec_bottom");-1!=String(u.next().prop("id")).indexOf("_expanded_row")&&u.next().remove(),this.total>d&&-1!=String(h.prev().prop("id")).indexOf("_expanded_row")&&h.prev().remove();var f=parseInt(u.next().attr("line")),c=parseInt(h.prev().attr("line"));if(l>f||1==f||this.last.pull_refresh){if(d<=c+this.show_extra-2&&d!=this.total)return;for(this.last.pull_refresh=!1;;){var p=s.find("#grid_"+this.name+"_rec_top").next();if("bottom"==p.attr("line"))break;if(!(parseInt(p.attr("line"))<l))break;p.remove()}var p=s.find("#grid_"+this.name+"_rec_bottom").prev(),g=p.attr("line");"top"==g&&(g=l);for(var m=parseInt(g)+1;d>=m;m++)this.records[m-1]&&(this.records[m-1].expanded===!0&&(this.records[m-1].expanded=!1),h.before(this.getRecordHTML(m-1,m)));_(),setTimeout(function(){i.refreshRanges()},0)}else{if(l>=f-this.show_extra+2&&l>1)return;for(;;){var p=s.find("#grid_"+this.name+"_rec_bottom").prev();if("top"==p.attr("line"))break;if(!(parseInt(p.attr("line"))>d))break;p.remove()}var p=s.find("#grid_"+this.name+"_rec_top").next(),g=p.attr("line");"bottom"==g&&(g=d);for(var m=parseInt(g)-1;m>=l;m--)this.records[m-1]&&(this.records[m-1].expanded===!0&&(this.records[m-1].expanded=!1),u.after(this.getRecordHTML(m-1,m)));_(),setTimeout(function(){i.refreshRanges()},0)}var v=(l-1)*i.recordHeight,w=(r-d)*i.recordHeight;0>w&&(w=0),u.css("height",v+"px"),h.css("height",w+"px"),i.last.range_start=l,i.last.range_end=d;var y=Math.floor(s[0].scrollTop/this.recordHeight),b=y+Math.floor(s.height()/this.recordHeight);if(b+10>r&&this.last.pull_more!==!0&&r<this.total-this.offset)if(this.autoLoad===!0)this.last.pull_more=!0,this.last.xhr_offset+=this.limit,this.request("get-records");else{var x=$("#grid_"+this.name+"_rec_more");"none"==x.css("display")&&x.show().on("click",function(){i.last.pull_more=!0,i.last.xhr_offset+=i.limit,i.request("get-records"),$(this).find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>')}),-1==x.find("td").text().indexOf("Load")&&x.find("td").html("<div>"+w2utils.lang("Load")+" "+i.limit+" "+w2utils.lang("More")+"...</div>")}r>=this.total-this.offset&&$("#grid_"+this.name+"_rec_more").hide()}}},getRecordHTML:function(e,t,i){var n,s="",r=this.last.selection;if(-1==e){s+='<tr line="0">',this.show.lineNumbers&&(s+='<td class="w2ui-col-number" style="height: 0px;"></td>'),this.show.selectColumn&&(s+='<td class="w2ui-col-select" style="height: 0px;"></td>'),this.show.expandColumn&&(s+='<td class="w2ui-col-expand" style="height: 0px;"></td>');for(var a in this.columns)this.columns[a].hidden||(s+='<td class="w2ui-grid-data" col="'+a+'" style="height: 0px;"></td>');return s+='<td class="w2ui-grid-data-last" style="height: 0px;"></td>',s+="</tr>"}var o="object"!=typeof this.url?this.url:this.url.get;if(i!==!0)if(this.searchData.length>0&&!o){if(e>=this.last.searchIds.length)return"";e=this.last.searchIds[e],n=this.records[e]}else{if(e>=this.records.length)return"";n=this.records[e]}else{if(e>=this.summary.length)return"";n=this.summary[e]}if(!n)return"";var d=(w2utils.escapeId(n.recid),!1);if(-1!=r.indexes.indexOf(e)&&(d=!0),s+='<tr id="grid_'+this.name+"_rec_"+n.recid+'" recid="'+n.recid+'" line="'+t+'"  class="'+(t%2==0?"w2ui-even":"w2ui-odd")+(d&&"row"==this.selectType?" w2ui-selected":"")+(n.expanded===!0?" w2ui-expanded":"")+'" '+(i!==!0?w2utils.isIOS?"    onclick  = \"w2ui['"+this.name+"'].dblClick('"+n.recid+"', event);\"":"    onclick  = \"w2ui['"+this.name+"'].click('"+n.recid+"', event);\"    oncontextmenu = \"w2ui['"+this.name+"'].contextMenu('"+n.recid+"', event);\"":"")+' style="height: '+this.recordHeight+"px; "+(d||"string"!=typeof n.style?"":n.style)+'" '+("string"==typeof n.style?'custom_style="'+n.style+'"':"")+">",this.show.lineNumbers&&(s+='<td id="grid_'+this.name+"_cell_"+e+"_number"+(i?"_s":"")+'" class="w2ui-col-number">'+(i!==!0?"<div>"+t+"</div>":"")+"</td>"),this.show.selectColumn&&(s+='<td id="grid_'+this.name+"_cell_"+e+"_select"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-select"         onclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">'+(i!==!0?'    <div>        <input class="w2ui-grid-select-check" type="checkbox" tabIndex="-1"            '+(d?'checked="checked"':"")+"            onclick=\"var obj = w2ui['"+this.name+"'];                 if (!obj.multiSelect) { obj.selectNone(); }                if (this.checked) obj.select('"+n.recid+"'); else obj.unselect('"+n.recid+"');                 if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">    </div>":"")+"</td>"),this.show.expandColumn){var u="";u=n.expanded===!0?"-":"+","none"==n.expanded&&(u=""),"spinner"==n.expanded&&(u='<div class="w2ui-spinner" style="width: 16px; margin: -2px 2px;"></div>'),s+='<td id="grid_'+this.name+"_cell_"+e+"_expand"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-expand">'+(i!==!0?'    <div ondblclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"             onclick="w2ui[\''+this.name+"'].toggle('"+n.recid+"', event);                 if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">        "+u+" </div>":"")+"</td>"}for(var h=0;;){var f=this.columns[h];if(f.hidden){if(h++,"undefined"==typeof this.columns[h])break}else{var c=!i&&n.changes&&"undefined"!=typeof n.changes[f.field],p=this.getCellHTML(e,h,i),g="";if("string"==typeof f.render){var m=f.render.toLowerCase().split(":");-1!=["number","int","float","money","currency","percent"].indexOf(m[0])&&(g+="text-align: right;")}"object"==typeof n.style&&"string"==typeof n.style[h]&&(g+=n.style[h]+";");var v=!1;if(d&&-1!=$.inArray(h,r.columns[e])&&(v=!0),s+='<td class="w2ui-grid-data'+(v?" w2ui-selected":"")+(c?" w2ui-changed":"")+'" col="'+h+'"     style="'+g+("undefined"!=typeof f.style?f.style:"")+'" '+("undefined"!=typeof f.attr?f.attr:"")+">"+p+"</td>",h++,"undefined"==typeof this.columns[h])break}}return s+='<td class="w2ui-grid-data-last"></td>',s+="</tr>"},getCellHTML:function(e,t,i){var s=this.columns[t],r=i!==!0?this.records[e]:this.summary[e],n=this.getCellValue(e,t,i),a=s.editable;if("undefined"!=typeof s.render){if("function"==typeof s.render&&(n=$.trim(s.render.call(this,r,e,t)),(n.length<4||"<div"!=n.substr(0,4).toLowerCase())&&(n="<div>"+n+"</div>")),"object"==typeof s.render&&(n="<div>"+(s.render[n]||"")+"</div>"),"string"==typeof s.render){var o=s.render.toLowerCase().split(":"),l="",d="";-1!=["number","int","float","money","currency","percent"].indexOf(o[0])&&("undefined"!=typeof o[1]&&w2utils.isInt(o[1])||(o[1]=0),o[1]>20&&(o[1]=20),o[1]<0&&(o[1]=0),-1!=["money","currency"].indexOf(o[0])&&(o[1]=w2utils.settings.currencyPrecision,l=w2utils.settings.currencyPrefix,d=w2utils.settings.currencySuffix),"percent"==o[0]&&(d="%","0"!==o[1]&&(o[1]=1)),"int"==o[0]&&(o[1]=0),n="<div>"+(""!==n?l+w2utils.formatNumber(Number(n).toFixed(o[1]))+d:"")+"</div>"),"time"==o[0]&&(("undefined"==typeof o[1]||""==o[1])&&(o[1]=w2utils.settings.time_format),n="<div>"+l+w2utils.formatTime(n,"h12"==o[1]?"hh:mi pm":"h24:min")+d+"</div>"),"date"==o[0]&&(("undefined"==typeof o[1]||""==o[1])&&(o[1]=w2utils.settings.date_display),n="<div>"+l+w2utils.formatDate(n,o[1])+d+"</div>"),"age"==o[0]&&(n="<div>"+l+w2utils.age(n)+d+"</div>"),"toggle"==o[0]&&(n="<div>"+l+(n?"Yes":"")+d+"</div>")}}else{var u="";if(a&&-1!=["checkbox","check"].indexOf(a.type)){var h=i?-(e+1):e;u="text-align: center",n='<input type="checkbox" '+(n?"checked":"")+" onclick=\"    var obj = w2ui['"+this.name+"'];     obj.editChange.call(obj, this, "+h+", "+t+', event); ">'}if(this.show.recordTitles){var f=String(n).replace(/"/g,"''");"undefined"!=typeof s.title&&("function"==typeof s.title&&(f=s.title.call(this,r,e,t)),"string"==typeof s.title&&(f=s.title));var n='<div title="'+w2utils.stripTags(f)+'" style="'+u+'">'+n+"</div>"}else var n='<div style="'+u+'">'+n+"</div>"}return(null==n||"undefined"==typeof n)&&(n=""),n},getCellValue:function(e,t,i){var s=this.columns[t],r=i!==!0?this.records[e]:this.summary[e],n=this.parseField(r,s.field);return r.changes&&"undefined"!=typeof r.changes[s.field]&&(n=r.changes[s.field]),(null==n||"undefined"==typeof n)&&(n=""),n},getFooterHTML:function(){return'<div>    <div class="w2ui-footer-left"></div>    <div class="w2ui-footer-right"></div>    <div class="w2ui-footer-center"></div></div>'},status:function(e){if("undefined"!=typeof e)$("#grid_"+this.name+"_footer").find(".w2ui-footer-left").html(e);else{var t="",i=this.getSelection();if(i.length>0){t=String(i.length).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+" "+w2utils.lang("selected");var s=i[0];"object"==typeof s&&(s=s.recid+", "+w2utils.lang("Column")+": "+s.column),1==i.length&&(t=w2utils.lang("Record ID")+": "+s+" ")}$("#grid_"+this.name+"_footer .w2ui-footer-left").html(t),1==i.length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit"),i.length>=1?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete")}},lock:function(){var i=$(this.box).find("> div:first-child"),s=Array.prototype.slice.call(arguments,0);s.unshift(i),setTimeout(function(){w2utils.lock.apply(window,s)},10)},unlock:function(){var e=this.box;setTimeout(function(){w2utils.unlock(e)},25)},stateSave:function(e){if(!localStorage)return null;var t={columns:[],show:$.extend({},this.show),last:{search:this.last.search,multi:this.last.multi,logic:this.last.logic,caption:this.last.caption,field:this.last.field,scrollTop:this.last.scrollTop,scrollLeft:this.last.scrollLeft},sortData:[],searchData:[]};for(var i in this.columns){var s=this.columns[i];t.columns.push({field:s.field,hidden:s.hidden,size:s.size,sizeCalculated:s.sizeCalculated,sizeOriginal:s.sizeOriginal,sizeType:s.sizeType})}for(var i in this.sortData)t.sortData.push($.extend({},this.sortData[i]));for(var i in this.searchData)t.searchData.push($.extend({},this.searchData[i]));if(e!==!0){var r=this.trigger({phase:"before",type:"stateSave",target:this.name,state:t});if(r.isCancelled===!0)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));try{var n=$.parseJSON(localStorage.w2ui||"{}");n||(n={}),n.states||(n.states={}),n.states[this.name]=t,localStorage.w2ui=JSON.stringify(n)}catch(a){return delete localStorage.w2ui,null}this.trigger($.extend(r,{phase:"after"}))}return t},stateRestore:function(e){var t=this;if(!e)try{if(!localStorage)return!1;var i=$.parseJSON(localStorage.w2ui||"{}");i||(i={}),i.states||(i.states={}),e=i.states[this.name]}catch(s){return delete localStorage.w2ui,null}var r=this.trigger({phase:"before",type:"stateRestore",target:this.name,state:e});if(r.isCancelled===!0)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));if($.isPlainObject(e)){$.extend(this.show,e.show),$.extend(this.last,e.last);var n=this.last.scrollTop,a=this.last.scrollLeft;for(var o in e.columns){var i=e.columns[o],l=this.getColumn(i.field);l&&$.extend(l,i)}this.sortData.splice(0,this.sortData.length);for(var o in e.sortData)this.sortData.push(e.sortData[o]);this.searchData.splice(0,this.searchData.length);for(var o in e.searchData)this.searchData.push(e.searchData[o]);setTimeout(function(){t.sortData.length>0&&t.localSort(),t.searchData.length>0&&t.localSearch(),t.last.scrollTop=n,t.last.scrollLeft=a,t.refresh()},1)}return this.trigger($.extend(r,{phase:"after"})),!0},stateReset:function(){if(this.stateRestore(this.last.state),localStorage)try{var e=$.parseJSON(localStorage.w2ui||"{}");e.states&&e.states[this.name]&&delete e.states[this.name],localStorage.w2ui=JSON.stringify(e)}catch(t){return delete localStorage.w2ui,null}},parseField:function(e,t){var i="";try{i=e;var s=String(t).split(".");for(var r in s)i=i[s[r]]}catch(n){i=""}return i},prepareData:function(){for(var e in this.records){var t=this.records[e];for(var i in this.columns){var s=this.columns[i];if(null!=t[s.field]&&"string"==typeof s.render){if(-1!=["number","int","float","money","currency","percent"].indexOf(s.render.split(":")[0])&&"number"!=typeof t[s.field]&&(t[s.field]=parseFloat(t[s.field])),-1!=["date","age"].indexOf(s.render.split(":")[0])&&!t[s.field+"_"]){var r=t[s.field];w2utils.isInt(r)&&(r=parseInt(r)),t[s.field+"_"]=new Date(r)}if(-1!=["time"].indexOf(s.render))if(w2utils.isTime(t[s.field])){var n=w2utils.isTime(t[s.field],!0),r=new Date;r.setHours(n.hours,n.minutes,n.seconds?n.seconds:0,0),t[s.field+"_"]||(t[s.field+"_"]=r)}else{var n=t[s.field];w2utils.isInt(n)&&(n=parseInt(n));var n=null!=n?new Date(n):new Date,r=new Date;r.setHours(n.getHours(),n.getMinutes(),n.getSeconds(),0),t[s.field+"_"]||(t[s.field+"_"]=r)}}}}},nextCell:function(e,t){var i=e+1;if(this.columns.length==i)return null;if(t===!0){var s=this.columns[i].editable;if(this.columns[i].hidden||"undefined"==typeof s||s&&-1!=["checkbox","check"].indexOf(s.type))return this.nextCell(i,t)}return i},prevCell:function(e,t){var i=e-1;if(0>i)return null;if(t===!0){var s=this.columns[i].editable;if(this.columns[i].hidden||"undefined"==typeof s||s&&-1!=["checkbox","check"].indexOf(s.type))return this.prevCell(i,t)}return i},nextRow:function(e){if(e+1<this.records.length&&0==this.last.searchIds.length||this.last.searchIds.length>0&&e<this.last.searchIds[this.last.searchIds.length-1]){if(e++,this.last.searchIds.length>0)for(;;){if(-1!=$.inArray(e,this.last.searchIds)||e>this.records.length)break;e++}return e}return null},prevRow:function(e){if(e>0&&0==this.last.searchIds.length||this.last.searchIds.length>0&&e>this.last.searchIds[0]){if(e--,this.last.searchIds.length>0)for(;;){if(-1!=$.inArray(e,this.last.searchIds)||0>e)break;e--}return e}return null}},$.extend(w2grid.prototype,w2utils.event),w2obj.grid=w2grid}(),function(){var e=function(e){this.box=null,this.name=null,this.panels=[],this.tmp={},this.padding=1,this.resizer=4,this.style="",this.onShow=null,this.onHide=null,this.onResizing=null,this.onResizerClick=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,$.extend(!0,this,w2obj.layout,e)},t=["top","left","main","preview","right","bottom"];$.fn.w2layout=function(i){function d(e,t,i){var s=e.get(t);return null!==s&&"undefined"==typeof i&&(i=s.tabs),null===s||null===i?!1:($.isArray(i)&&(i={tabs:i}),$().w2destroy(e.name+"_"+t+"_tabs"),s.tabs=$().w2tabs($.extend({},i,{owner:e,name:e.name+"_"+t+"_tabs"})),s.show.tabs=!0,!0)}function u(e,t,i){var s=e.get(t);return null!==s&&"undefined"==typeof i&&(i=s.toolbar),null===s||null===i?!1:($.isArray(i)&&(i={items:i}),$().w2destroy(e.name+"_"+t+"_toolbar"),s.toolbar=$().w2toolbar($.extend({},i,{owner:e,name:e.name+"_"+t+"_toolbar"})),s.show.toolbar=!0,!0)}if("object"==typeof i||!i){if(!w2utils.checkName(i,"w2layout"))return;var s=i.panels||[],r=new e(i);$.extend(r,{handlers:[],panels:[]});for(var n=0,a=s.length;a>n;n++)r.panels[n]=$.extend(!0,{},e.prototype.panel,s[n]),($.isPlainObject(r.panels[n].tabs)||$.isArray(r.panels[n].tabs))&&d(r,s[n].type),($.isPlainObject(r.panels[n].toolbar)||$.isArray(r.panels[n].toolbar))&&u(r,s[n].type);for(var o in t)o=t[o],null===r.get(o)&&r.panels.push($.extend(!0,{},e.prototype.panel,{type:o,hidden:"main"!==o,size:50}));return $(this).length>0&&r.render($(this)[0]),w2ui[r.name]=r,r}if(w2ui[$(this).attr("name")]){var l=w2ui[$(this).attr("name")];return l[i].apply(l,Array.prototype.slice.call(arguments,1)),this}console.log("ERROR: Method "+i+" does not exist on jQuery.w2layout")},e.prototype={panel:{type:null,title:"",size:100,minSize:20,maxSize:!1,hidden:!1,resizable:!1,overflow:"auto",style:"",content:"",tabs:null,toolbar:null,width:null,height:null,show:{toolbar:!1,tabs:!1},onRefresh:null,onShow:null,onHide:null},html:function(e,t,i){return this.content(e,t,i)},content:function(e,t,i){var s=this,r=this.get(e);if("css"==e)return $("#layout_"+s.name+"_panel_css").html("<style>"+t+"</style>"),!0;if(null===r)return!1;if("undefined"==typeof t||null===t)return r.content;if(t instanceof jQuery)return console.log("ERROR: You can not pass jQuery object to w2layout.content() method"),!1;var n="#layout_"+this.name+"_panel_"+r.type,a=$(n+"> .w2ui-panel-content"),o=0;if(a.length>0&&($(n).scrollTop(0),o=$(a).position().top),""===r.content)r.content=t,this.refresh(e);else{if(r.content=t,!r.hidden&&null!==i&&""!==i&&"undefined"!=typeof i){var l=$(n+"> .w2ui-panel-content");l.after('<div class="w2ui-panel-content new-panel" style="'+l[0].style.cssText+'"></div>');var d=$(n+"> .w2ui-panel-content.new-panel");l.css("top",o),d.css("top",o),"object"==typeof t?(t.box=d[0],t.render()):d.html(t),w2utils.transition(l[0],d[0],i,function(){l.remove(),d.removeClass("new-panel"),d.css("overflow",r.overflow),s.resize(),-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){s.resize()},100)})}this.refresh(e)}return s.resize(),-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){s.resize()},100),!0},load:function(e,t,i,s){var r=this;return"css"==e?($.get(t,function(t,i,n){r.content(e,n.responseText),s&&s()}),!0):null!==this.get(e)?($.get(t,function(t,n,a){r.content(e,a.responseText,i),s&&s(),r.resize(),-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){r.resize()},100)}),!0):!1},sizeTo:function(e,t){var i=this,s=i.get(e);return null===s?!1:($(i.box).find(" > div > .w2ui-panel").css({"-webkit-transition":".2s","-moz-transition":".2s","-ms-transition":".2s","-o-transition":".2s"}),setTimeout(function(){i.set(e,{size:t})},1),setTimeout(function(){$(i.box).find(" > div > .w2ui-panel").css({"-webkit-transition":"0s","-moz-transition":"0s","-ms-transition":"0s","-o-transition":"0s"}),i.resize()},500),!0)},show:function(e,t){var i=this,s=this.trigger({phase:"before",type:"show",target:e,object:this.get(e),immediate:t});if(s.isCancelled!==!0){var r=i.get(e);return null===r?!1:(r.hidden=!1,t===!0?($("#layout_"+i.name+"_panel_"+e).css({opacity:"1"}),r.resizable&&$("#layout_"+i.name+"_resizer_"+e).show(),i.trigger($.extend(s,{phase:"after"})),i.resize()):(r.resizable&&$("#layout_"+i.name+"_resizer_"+e).show(),$("#layout_"+i.name+"_panel_"+e).css({opacity:"0"}),$(i.box).find(" > div > .w2ui-panel").css({"-webkit-transition":".2s","-moz-transition":".2s","-ms-transition":".2s","-o-transition":".2s"}),setTimeout(function(){i.resize()},1),setTimeout(function(){$("#layout_"+i.name+"_panel_"+e).css({opacity:"1"})},250),setTimeout(function(){$(i.box).find(" > div > .w2ui-panel").css({"-webkit-transition":"0s","-moz-transition":"0s","-ms-transition":"0s","-o-transition":"0s"}),i.trigger($.extend(s,{phase:"after"})),i.resize()},500)),!0)}},hide:function(e,t){var i=this,s=this.trigger({phase:"before",type:"hide",target:e,object:this.get(e),immediate:t});if(s.isCancelled!==!0){var r=i.get(e);return null===r?!1:(r.hidden=!0,t===!0?($("#layout_"+i.name+"_panel_"+e).css({opacity:"0"}),$("#layout_"+i.name+"_resizer_"+e).hide(),i.trigger($.extend(s,{phase:"after"})),i.resize()):($("#layout_"+i.name+"_resizer_"+e).hide(),$(i.box).find(" > div > .w2ui-panel").css({"-webkit-transition":".2s","-moz-transition":".2s","-ms-transition":".2s","-o-transition":".2s"}),$("#layout_"+i.name+"_panel_"+e).css({opacity:"0"}),setTimeout(function(){i.resize()},1),setTimeout(function(){$(i.box).find(" > div > .w2ui-panel").css({"-webkit-transition":"0s","-moz-transition":"0s","-ms-transition":"0s","-o-transition":"0s"}),i.trigger($.extend(s,{phase:"after"})),i.resize()},500)),!0)}},toggle:function(e,t){var i=this.get(e);return null===i?!1:i.hidden?this.show(e,t):this.hide(e,t)},set:function(e,t){var i=this.get(e,!0);return null===i?!1:($.extend(this.panels[i],t),"undefined"!=typeof t.content&&this.refresh(e),this.resize(),!0)},get:function(e,t){for(var i in this.panels)if(this.panels[i].type==e)return t===!0?i:this.panels[i];return null},el:function(e){var t=$("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-content");return 1!=t.length?null:t[0]},hideToolbar:function(e){var t=this.get(e);t&&(t.show.toolbar=!1,$("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-toolbar").hide(),this.resize())},showToolbar:function(e){var t=this.get(e);t&&(t.show.toolbar=!0,$("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-toolbar").show(),this.resize())},toggleToolbar:function(e){var t=this.get(e);t&&(t.show.toolbar?this.hideToolbar(e):this.showToolbar(e))},hideTabs:function(e){var t=this.get(e);t&&(t.show.tabs=!1,$("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-tabs").hide(),this.resize())},showTabs:function(e){var t=this.get(e);t&&(t.show.tabs=!0,$("#layout_"+this.name+"_panel_"+e+"> .w2ui-panel-tabs").show(),this.resize())},toggleTabs:function(e){var t=this.get(e);t&&(t.show.tabs?this.hideTabs(e):this.showTabs(e))},render:function(e){function l(){i.tmp.events={resize:function(){w2ui[i.name].resize()},resizeStart:d,mouseMove:h,mouseUp:u},$(window).on("resize",i.tmp.events.resize)}function d(e,s){if(i.box){s||(s=window.event),window.addEventListener||window.document.attachEvent("onselectstart",function(){return!1}),$(document).off("mousemove",i.tmp.events.mouseMove).on("mousemove",i.tmp.events.mouseMove),$(document).off("mouseup",i.tmp.events.mouseUp).on("mouseup",i.tmp.events.mouseUp),i.tmp.resize={type:e,x:s.screenX,y:s.screenY,diff_x:0,diff_y:0,value:0};for(var r in t)r=t[r],i.lock(r,{opacity:0});("left"==e||"right"==e)&&(i.tmp.resize.value=parseInt($("#layout_"+i.name+"_resizer_"+e)[0].style.left)),("top"==e||"preview"==e||"bottom"==e)&&(i.tmp.resize.value=parseInt($("#layout_"+i.name+"_resizer_"+e)[0].style.top))}}function u(e){if(i.box&&(e||(e=window.event),window.addEventListener||window.document.attachEvent("onselectstart",function(){return!1}),$(document).off("mousemove",i.tmp.events.mouseMove),$(document).off("mouseup",i.tmp.events.mouseUp),"undefined"!=typeof i.tmp.resize)){for(var s in t)i.unlock(t[s]);if(0!==i.tmp.diff_x||0!==i.tmp.resize.diff_y){var u,h,r=i.get("top"),n=i.get("bottom"),a=i.get(i.tmp.resize.type),o=parseInt($(i.box).height()),l=parseInt($(i.box).width()),d=String(a.size);switch(i.tmp.resize.type){case"top":u=parseInt(a.sizeCalculated)+i.tmp.resize.diff_y,h=0;break;case"bottom":u=parseInt(a.sizeCalculated)-i.tmp.resize.diff_y,h=0;break;case"preview":u=parseInt(a.sizeCalculated)-i.tmp.resize.diff_y,h=(r&&!r.hidden?r.sizeCalculated:0)+(n&&!n.hidden?n.sizeCalculated:0);break;case"left":u=parseInt(a.sizeCalculated)+i.tmp.resize.diff_x,h=0;break;case"right":u=parseInt(a.sizeCalculated)-i.tmp.resize.diff_x,h=0}a.size="%"==d.substr(d.length-1)?Math.floor(100*u/("left"==a.type||"right"==a.type?l:o-h)*100)/100+"%":u,i.resize()}$("#layout_"+i.name+"_resizer_"+i.tmp.resize.type).removeClass("active"),delete i.tmp.resize}}function h(e){if(i.box&&(e||(e=window.event),"undefined"!=typeof i.tmp.resize)){var t=i.get(i.tmp.resize.type),s=i.tmp.resize,r=i.trigger({phase:"before",type:"resizing",target:i.name,object:t,originalEvent:e,panel:s?s.type:"all",diff_x:s?s.diff_x:0,diff_y:s?s.diff_y:0});if(r.isCancelled!==!0){var n=$("#layout_"+i.name+"_resizer_"+s.type),a=e.screenX-s.x,o=e.screenY-s.y,l=i.get("main");switch(n.hasClass("active")||n.addClass("active"),s.type){case"left":t.minSize-a>t.width&&(a=t.minSize-t.width),t.maxSize&&t.width+a>t.maxSize&&(a=t.maxSize-t.width),l.minSize+a>l.width&&(a=l.width-l.minSize);break;case"right":t.minSize+a>t.width&&(a=t.width-t.minSize),t.maxSize&&t.width-a>t.maxSize&&(a=t.width-t.maxSize),l.minSize-a>l.width&&(a=l.minSize-l.width);break;case"top":t.minSize-o>t.height&&(o=t.minSize-t.height),t.maxSize&&t.height+o>t.maxSize&&(o=t.maxSize-t.height),l.minSize+o>l.height&&(o=l.height-l.minSize);break;case"preview":case"bottom":t.minSize+o>t.height&&(o=t.height-t.minSize),t.maxSize&&t.height-o>t.maxSize&&(o=t.height-t.maxSize),l.minSize-o>l.height&&(o=l.minSize-l.height)}switch(s.diff_x=a,s.diff_y=o,s.type){case"top":case"preview":case"bottom":s.diff_x=0,n.length>0&&(n[0].style.top=s.value+s.diff_y+"px");break;case"left":case"right":s.diff_y=0,n.length>0&&(n[0].style.left=s.value+s.diff_x+"px")}i.trigger($.extend(r,{phase:"after"}))}}}var i=this,s=(new Date).getTime(),r=i.trigger({phase:"before",type:"render",target:i.name,box:e});if(r.isCancelled!==!0){if("undefined"!=typeof e&&null!==e&&($(i.box).find("#layout_"+i.name+"_panel_main").length>0&&$(i.box).removeAttr("name").removeClass("w2ui-layout").html(""),i.box=e),!i.box)return!1;$(i.box).attr("name",i.name).addClass("w2ui-layout").html("<div></div>"),$(i.box).length>0&&($(i.box)[0].style.cssText+=i.style);for(var n in t){n=t[n];var o=(i.get(n),'<div id="layout_'+i.name+"_panel_"+n+'" class="w2ui-panel">    <div class="w2ui-panel-title"></div>    <div class="w2ui-panel-tabs"></div>    <div class="w2ui-panel-toolbar"></div>    <div class="w2ui-panel-content"></div></div><div id="layout_'+i.name+"_resizer_"+n+'" class="w2ui-resizer"></div>');$(i.box).find(" > div").append(o)}return $(i.box).find(" > div").append('<div id="layout_'+i.name+'_panel_css" style="position: absolute; top: 10000px;"></div'),i.refresh(),i.trigger($.extend(r,{phase:"after"})),setTimeout(function(){l(),i.resize()},0),(new Date).getTime()-s}},refresh:function(e){var t=this;"undefined"==typeof e&&(e=null);var i=(new Date).getTime(),s=t.trigger({phase:"before",type:"refresh",target:"undefined"!=typeof e?e:t.name,object:t.get(e)});
if(s.isCancelled!==!0){if("string"==typeof e){var r=t.get(e);if(null===r)return;var n="#layout_"+t.name+"_panel_"+r.type,a="#layout_"+t.name+"_resizer_"+r.type;$(n).css({display:r.hidden?"none":"block"}),r.resizable?$(a).show():$(a).hide(),"object"==typeof r.content&&"function"==typeof r.content.render?(r.content.box=$(n+"> .w2ui-panel-content")[0],setTimeout(function(){$(n+"> .w2ui-panel-content").length>0&&($(n+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").css("overflow",r.overflow)[0].style.cssText+=";"+r.style),r.content.render()},1)):$(n+"> .w2ui-panel-content").length>0&&($(n+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").html(r.content).css("overflow",r.overflow)[0].style.cssText+=";"+r.style);var o=$(t.box).find(n+"> .w2ui-panel-tabs");r.show.tabs?0===o.find("[name="+r.tabs.name+"]").length&&null!==r.tabs?o.w2render(r.tabs):r.tabs.refresh():o.html("").removeClass("w2ui-tabs").hide(),o=$(t.box).find(n+"> .w2ui-panel-toolbar"),r.show.toolbar?0===o.find("[name="+r.toolbar.name+"]").length&&null!==r.toolbar?o.w2render(r.toolbar):r.toolbar.refresh():o.html("").removeClass("w2ui-toolbar").hide(),o=$(t.box).find(n+"> .w2ui-panel-title"),r.title?o.html(r.title).show():o.html("").hide()}else{if(0==$("#layout_"+t.name+"_panel_main").length)return void t.render();t.resize();for(var l in this.panels)t.refresh(this.panels[l].type)}return t.trigger($.extend(s,{phase:"after"})),(new Date).getTime()-i}},resize:function(){if(!this.box)return!1;var e=(new Date).getTime(),i=this.tmp.resize,s=this.trigger({phase:"before",type:"resize",target:this.name,panel:i?i.type:"all",diff_x:i?i.diff_x:0,diff_y:i?i.diff_y:0});if(s.isCancelled!==!0){this.padding<0&&(this.padding=0);var r=parseInt($(this.box).width()),n=parseInt($(this.box).height());$(this.box).find(" > div").css({width:r+"px",height:n+"px"});var y,b,x,_,k,a=this,o=this.get("main"),l=this.get("preview"),d=this.get("left"),u=this.get("right"),h=this.get("top"),f=this.get("bottom"),p=null!==l&&l.hidden!==!0?!0:!1,g=null!==d&&d.hidden!==!0?!0:!1,m=null!==u&&u.hidden!==!0?!0:!1,v=null!==h&&h.hidden!==!0?!0:!1,w=null!==f&&f.hidden!==!0?!0:!1;for(var C in t)if(C=t[C],"main"!==C){var i=this.get(C);if(i){var T=String(i.size||0);if("%"==T.substr(T.length-1)){var z=n;"preview"==i.type&&(z=z-(h&&!h.hidden?h.sizeCalculated:0)-(f&&!f.hidden?f.sizeCalculated:0)),i.sizeCalculated=parseInt(("left"==i.type||"right"==i.type?r:z)*parseFloat(i.size)/100)}else i.sizeCalculated=parseInt(i.size);i.sizeCalculated=Math.max(i.sizeCalculated,parseInt(i.minSize))}}null!==h&&h.hidden!==!0?(y=0,b=0,x=r,_=h.sizeCalculated,$("#layout_"+this.name+"_panel_top").css({display:"block",left:y+"px",top:b+"px",width:x+"px",height:_+"px"}).show(),h.width=x,h.height=_,h.resizable&&(b=h.sizeCalculated-(0===this.padding?this.resizer:0),_=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_top").show().css({display:"block",left:y+"px",top:b+"px",width:x+"px",height:_+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(e){var t=a.trigger({phase:"before",type:"resizerClick",target:"top",originalEvent:e});if(t.isCancelled!==!0)return w2ui[a.name].tmp.events.resizeStart("top",e),a.trigger($.extend(t,{phase:"after"})),!1}))):$("#layout_"+this.name+"_panel_top").hide(),null!==d&&d.hidden!==!0?(y=0,b=0+(v?h.sizeCalculated+this.padding:0),x=d.sizeCalculated,_=n-(v?h.sizeCalculated+this.padding:0)-(w?f.sizeCalculated+this.padding:0),k=$("#layout_"+this.name+"_panel_left"),-1!=window.navigator.userAgent.indexOf("MSIE")&&k.length>0&&k[0].clientHeight<k[0].scrollHeight&&(x+=17),k.css({display:"block",left:y+"px",top:b+"px",width:x+"px",height:_+"px"}).show(),d.width=x,d.height=_,d.resizable&&(y=d.sizeCalculated-(0===this.padding?this.resizer:0),x=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_left").show().css({display:"block",left:y+"px",top:b+"px",width:x+"px",height:_+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(e){var t=a.trigger({phase:"before",type:"resizerClick",target:"left",originalEvent:e});if(t.isCancelled!==!0)return w2ui[a.name].tmp.events.resizeStart("left",e),a.trigger($.extend(t,{phase:"after"})),!1}))):($("#layout_"+this.name+"_panel_left").hide(),$("#layout_"+this.name+"_resizer_left").hide()),null!==u&&u.hidden!==!0?(y=r-u.sizeCalculated,b=0+(v?h.sizeCalculated+this.padding:0),x=u.sizeCalculated,_=n-(v?h.sizeCalculated+this.padding:0)-(w?f.sizeCalculated+this.padding:0),$("#layout_"+this.name+"_panel_right").css({display:"block",left:y+"px",top:b+"px",width:x+"px",height:_+"px"}).show(),u.width=x,u.height=_,u.resizable&&(y-=this.padding,x=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_right").show().css({display:"block",left:y+"px",top:b+"px",width:x+"px",height:_+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(e){var t=a.trigger({phase:"before",type:"resizerClick",target:"right",originalEvent:e});if(t.isCancelled!==!0)return w2ui[a.name].tmp.events.resizeStart("right",e),a.trigger($.extend(t,{phase:"after"})),!1}))):$("#layout_"+this.name+"_panel_right").hide(),null!==f&&f.hidden!==!0?(y=0,b=n-f.sizeCalculated,x=r,_=f.sizeCalculated,$("#layout_"+this.name+"_panel_bottom").css({display:"block",left:y+"px",top:b+"px",width:x+"px",height:_+"px"}).show(),f.width=x,f.height=_,f.resizable&&(b-=0===this.padding?0:this.padding,_=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_bottom").show().css({display:"block",left:y+"px",top:b+"px",width:x+"px",height:_+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(e){var t=a.trigger({phase:"before",type:"resizerClick",target:"bottom",originalEvent:e});if(t.isCancelled!==!0)return w2ui[a.name].tmp.events.resizeStart("bottom",e),a.trigger($.extend(t,{phase:"after"})),!1}))):$("#layout_"+this.name+"_panel_bottom").hide(),y=0+(g?d.sizeCalculated+this.padding:0),b=0+(v?h.sizeCalculated+this.padding:0),x=r-(g?d.sizeCalculated+this.padding:0)-(m?u.sizeCalculated+this.padding:0),_=n-(v?h.sizeCalculated+this.padding:0)-(w?f.sizeCalculated+this.padding:0)-(p?l.sizeCalculated+this.padding:0),k=$("#layout_"+this.name+"_panel_main"),-1!=window.navigator.userAgent.indexOf("MSIE")&&k.length>0&&k[0].clientHeight<k[0].scrollHeight&&(x+=17),k.css({display:"block",left:y+"px",top:b+"px",width:x+"px",height:_+"px"}),o.width=x,o.height=_,null!==l&&l.hidden!==!0?(y=0+(g?d.sizeCalculated+this.padding:0),b=n-(w?f.sizeCalculated+this.padding:0)-l.sizeCalculated,x=r-(g?d.sizeCalculated+this.padding:0)-(m?u.sizeCalculated+this.padding:0),_=l.sizeCalculated,k=$("#layout_"+this.name+"_panel_preview"),-1!=window.navigator.userAgent.indexOf("MSIE")&&k.length>0&&k[0].clientHeight<k[0].scrollHeight&&(x+=17),k.css({display:"block",left:y+"px",top:b+"px",width:x+"px",height:_+"px"}).show(),l.width=x,l.height=_,l.resizable&&(b-=0===this.padding?0:this.padding,_=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_preview").show().css({display:"block",left:y+"px",top:b+"px",width:x+"px",height:_+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(e){var t=a.trigger({phase:"before",type:"resizerClick",target:"preview",originalEvent:e});if(t.isCancelled!==!0)return w2ui[a.name].tmp.events.resizeStart("preview",e),a.trigger($.extend(t,{phase:"after"})),!1}))):$("#layout_"+this.name+"_panel_preview").hide();for(var S in t){S=t[S];var D=this.get(S),I="#layout_"+this.name+"_panel_"+S+" > .w2ui-panel-",R=0;D&&(D.title&&(R+=w2utils.getSize($(I+"title").css({top:R+"px",display:"block"}),"height")),D.show.tabs&&(null!==D.tabs&&w2ui[this.name+"_"+S+"_tabs"]&&w2ui[this.name+"_"+S+"_tabs"].resize(),R+=w2utils.getSize($(I+"tabs").css({top:R+"px",display:"block"}),"height")),D.show.toolbar&&(null!==D.toolbar&&w2ui[this.name+"_"+S+"_toolbar"]&&w2ui[this.name+"_"+S+"_toolbar"].resize(),R+=w2utils.getSize($(I+"toolbar").css({top:R+"px",display:"block"}),"height"))),$(I+"content").css({display:"block"}).css({top:R+"px"})}return clearTimeout(this._resize_timer),this._resize_timer=setTimeout(function(){for(var e in w2ui)if("function"==typeof w2ui[e].resize){"undefined"==w2ui[e].panels&&w2ui[e].resize();var t=$(w2ui[e].box).parents(".w2ui-layout");t.length>0&&t.attr("name")==a.name&&w2ui[e].resize()}},100),this.trigger($.extend(s,{phase:"after"})),(new Date).getTime()-e}},destroy:function(){var e=this.trigger({phase:"before",type:"destroy",target:this.name});if(e.isCancelled!==!0)return"undefined"==typeof w2ui[this.name]?!1:($(this.box).find("#layout_"+this.name+"_panel_main").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-layout").html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})),this.tmp.events&&this.tmp.events.resize&&$(window).off("resize",this.tmp.events.resize),!0)},lock:function(e){if(-1==t.indexOf(e))return void console.log("ERROR: First parameter needs to be the a valid panel name.");var r=Array.prototype.slice.call(arguments,0);r[0]="#layout_"+this.name+"_panel_"+e,w2utils.lock.apply(window,r)},unlock:function(e){if(-1==t.indexOf(e))return void console.log("ERROR: First parameter needs to be the a valid panel name.");var i="#layout_"+this.name+"_panel_"+e;w2utils.unlock(i)}},$.extend(e.prototype,w2utils.event),w2obj.layout=e}();var w2popup={};!function(){$.fn.w2popup=function(e,t){"undefined"==typeof e&&(t={},e="open"),$.isPlainObject(e)&&(t=e,e="open"),e=e.toLowerCase(),"load"===e&&"string"==typeof t&&(t=$.extend({url:t},arguments.length>2?arguments[2]:{})),"open"===e&&null!=t.url&&(e="load"),t=t||{};var i={};return $(this).length>0&&($(this).find("div[rel=title], div[rel=body], div[rel=buttons]").length>0?($(this).find("div[rel=title]").length>0&&(i.title=$(this).find("div[rel=title]").html()),$(this).find("div[rel=body]").length>0&&(i.body=$(this).find("div[rel=body]").html(),i.style=$(this).find("div[rel=body]")[0].style.cssText),$(this).find("div[rel=buttons]").length>0&&(i.buttons=$(this).find("div[rel=buttons]").html())):(i.title="&nbsp;",i.body=$(this).html()),0!=parseInt($(this).css("width"))&&(i.width=parseInt($(this).css("width"))),0!=parseInt($(this).css("height"))&&(i.height=parseInt($(this).css("height")))),w2popup[e]($.extend({},i,t))},w2popup={defaults:{title:"",body:"",buttons:"",style:"",color:"#000",opacity:.4,speed:.3,modal:!1,maximized:!1,keyboard:!0,width:500,height:300,showClose:!0,showMax:!1,transition:null},status:"closed",handlers:[],onOpen:null,onClose:null,onMax:null,onMin:null,onToggle:null,onKeydown:null,open:function(e){function p(e){return e||(e=window.event),window.addEventListener||window.document.attachEvent("onselectstart",function(){return!1}),w2popup.status="moving",c.resizing=!0,c.x=e.screenX,c.y=e.screenY,c.pos_x=$("#w2ui-popup").position().left,c.pos_y=$("#w2ui-popup").position().top,w2popup.lock({opacity:0}),$(document).on("mousemove",c.mvMove),$(document).on("mouseup",c.mvStop),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault?void e.preventDefault():!1}function g(e){1==c.resizing&&(e||(e=window.event),c.div_x=e.screenX-c.x,c.div_y=e.screenY-c.y,$("#w2ui-popup").css({"-webkit-transition":"none","-webkit-transform":"translate3d("+c.div_x+"px, "+c.div_y+"px, 0px)","-moz-transition":"none","-moz-transform":"translate("+c.div_x+"px, "+c.div_y+"px)","-ms-transition":"none","-ms-transform":"translate("+c.div_x+"px, "+c.div_y+"px)","-o-transition":"none","-o-transform":"translate("+c.div_x+"px, "+c.div_y+"px)"}))}function m(e){1==c.resizing&&(e||(e=window.event),w2popup.status="open",c.div_x=e.screenX-c.x,c.div_y=e.screenY-c.y,$("#w2ui-popup").css({left:c.pos_x+c.div_x+"px",top:c.pos_y+c.div_y+"px","-webkit-transition":"none","-webkit-transform":"translate3d(0px, 0px, 0px)","-moz-transition":"none","-moz-transform":"translate(0px, 0px)","-ms-transition":"none","-ms-transform":"translate(0px, 0px)","-o-transition":"none","-o-transform":"translate(0px, 0px)"}),c.resizing=!1,$(document).off("mousemove",c.mvMove),$(document).off("mouseup",c.mvStop),w2popup.unlock())}var t=this;if("closing"==w2popup.status)return void setTimeout(function(){t.open.call(t,e)},100);var i=$("#w2ui-popup").data("options"),e=$.extend({},this.defaults,i,{title:"",body:"",buttons:""},e,{maximized:!1});if(setTimeout(function(){$("#w2ui-popup").data("options",e)},100),0==$("#w2ui-popup").length&&(w2popup.handlers=[],w2popup.onMax=null,w2popup.onMin=null,w2popup.onToggle=null,w2popup.onOpen=null,w2popup.onClose=null,w2popup.onKeydown=null),e.onOpen&&(w2popup.onOpen=e.onOpen),e.onClose&&(w2popup.onClose=e.onClose),e.onMax&&(w2popup.onMax=e.onMax),e.onMin&&(w2popup.onMin=e.onMin),e.onToggle&&(w2popup.onToggle=e.onToggle),e.onKeydown&&(w2popup.onKeydown=e.onKeydown),void 0==window.innerHeight){var s=document.documentElement.offsetWidth,r=document.documentElement.offsetHeight;"IE7"===w2utils.engine&&(s+=21,r+=4)}else var s=window.innerWidth,r=window.innerHeight;parseInt(s)-10<parseInt(e.width)&&(e.width=parseInt(s)-10),parseInt(r)-10<parseInt(e.height)&&(e.height=parseInt(r)-10);var n=parseInt((parseInt(r)-parseInt(e.height))/2*.6),a=parseInt((parseInt(s)-parseInt(e.width))/2);if(0==$("#w2ui-popup").length){var o=this.trigger({phase:"before",type:"open",target:"popup",options:e,present:!1});if(o.isCancelled===!0)return;w2popup.status="opening",w2popup.lockScreen(e);var l="";e.showClose&&(l+='<div class="w2ui-msg-button w2ui-msg-close" onmousedown="event.stopPropagation()" onclick="w2popup.close()">Close</div>'),e.showMax&&(l+='<div class="w2ui-msg-button w2ui-msg-max" onmousedown="event.stopPropagation()" onclick="w2popup.toggle()">Max</div>');var d='<div id="w2ui-popup" class="w2ui-popup" style="opacity: 0; left: '+a+"px; top: "+n+"px;     width: "+parseInt(e.width)+"px; height: "+parseInt(e.height)+'px;     -webkit-transform: scale(0.8); -moz-transform: scale(0.8); -ms-transform: scale(0.8); -o-transform: scale(0.8); ">   <div class="w2ui-msg-title" style="'+(""==e.title?"display: none":"")+'">'+l+e.title+'</div>   <div class="w2ui-box1" style="'+(""==e.title?"top: 0px !important;":"")+(""==e.buttons?"bottom: 0px !important;":"")+'">       <div class="w2ui-msg-body'+(""!=!e.title?" w2ui-msg-no-title":"")+(""!=!e.buttons?" w2ui-msg-no-buttons":"")+'" style="'+e.style+'">'+e.body+'</div>   </div>   <div class="w2ui-box2" style="'+(""==e.title?"top: 0px !important;":"")+(""==e.buttons?"bottom: 0px !important;":"")+'">       <div class="w2ui-msg-body'+(""!=!e.title?" w2ui-msg-no-title":"")+(""!=!e.buttons?" w2ui-msg-no-buttons":"")+'" style="'+e.style+'"></div>       </div>   <div class="w2ui-msg-buttons" style="'+(""==e.buttons?"display: none":"")+'">'+e.buttons+"</div></div>";$("body").append(d),setTimeout(function(){$("#w2ui-popup .w2ui-box2").hide(),$("#w2ui-popup").css({"-webkit-transition":e.speed+"s opacity, "+e.speed+"s -webkit-transform","-webkit-transform":"scale(1)","-moz-transition":e.speed+"s opacity, "+e.speed+"s -moz-transform","-moz-transform":"scale(1)","-ms-transition":e.speed+"s opacity, "+e.speed+"s -ms-transform","-ms-transform":"scale(1)","-o-transition":e.speed+"s opacity, "+e.speed+"s -o-transform","-o-transform":"scale(1)",opacity:"1"})},1),setTimeout(function(){$("#w2ui-popup").css({"-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":""}),w2popup.status="open",setTimeout(function(){t.trigger($.extend(o,{phase:"after"}))},100)},1e3*e.speed)}else{var o=this.trigger({phase:"before",type:"open",target:"popup",options:e,present:!0});if(o.isCancelled===!0)return;w2popup.status="opening",("undefined"==typeof i||i.width!=e.width||i.height!=e.height)&&w2popup.resize(e.width,e.height),"undefined"!=typeof i&&(e.prevSize=e.width+":"+e.height,e.maximized=i.maximized);var u=$("#w2ui-popup .w2ui-box2 > .w2ui-msg-body").html(e.body);u.length>0&&(u[0].style.cssText=e.style),""!=e.buttons?($("#w2ui-popup .w2ui-msg-buttons").show().html(e.buttons),$("#w2ui-popup .w2ui-msg-body").removeClass("w2ui-msg-no-buttons"),$("#w2ui-popup .w2ui-box1, #w2ui-popup .w2ui-box2").css("bottom","")):($("#w2ui-popup .w2ui-msg-buttons").hide().html(""),$("#w2ui-popup .w2ui-msg-body").addClass("w2ui-msg-no-buttons"),$("#w2ui-popup .w2ui-box1, #w2ui-popup .w2ui-box2").css("bottom","0px")),""!=e.title?($("#w2ui-popup .w2ui-msg-title").show().html((e.showClose?'<div class="w2ui-msg-button w2ui-msg-close" onmousedown="event.stopPropagation()" onclick="w2popup.close()">Close</div>':"")+(e.showMax?'<div class="w2ui-msg-button w2ui-msg-max" onmousedown="event.stopPropagation()" onclick="w2popup.toggle()">Max</div>':"")+e.title),$("#w2ui-popup .w2ui-msg-body").removeClass("w2ui-msg-no-title"),$("#w2ui-popup .w2ui-box1, #w2ui-popup .w2ui-box2").css("top","")):($("#w2ui-popup .w2ui-msg-title").hide().html(""),$("#w2ui-popup .w2ui-msg-body").addClass("w2ui-msg-no-title"),$("#w2ui-popup .w2ui-box1, #w2ui-popup .w2ui-box2").css("top","0px"));var h=$("#w2ui-popup .w2ui-box1")[0],f=$("#w2ui-popup .w2ui-box2")[0];w2utils.transition(h,f,e.transition),f.className="w2ui-box1",h.className="w2ui-box2",$(f).addClass("w2ui-current-box"),$("#w2ui-popup").data("prev-size",null),setTimeout(function(){w2popup.status="open",t.trigger($.extend(o,{phase:"after"}))},100)}e._last_w2ui_name=w2utils.keyboard.active(),w2utils.keyboard.active(null),e.keyboard&&$(document).on("keydown",this.keydown);var c={resizing:!1,mvMove:g,mvStop:m};return $("#w2ui-popup .w2ui-msg-title").on("mousedown",function(e){p(e)}),this},keydown:function(e){var t=$("#w2ui-popup").data("options");if(t.keyboard){var i=w2popup.trigger({phase:"before",type:"keydown",target:"popup",options:t,originalEvent:e});if(i.isCancelled!==!0){switch(e.keyCode){case 27:e.preventDefault(),$("#w2ui-popup .w2ui-popup-message").length>0?w2popup.message():w2popup.close()}w2popup.trigger($.extend(i,{phase:"after"}))}}},close:function(e){var t=this,e=$.extend({},$("#w2ui-popup").data("options"),e);if(0!=$("#w2ui-popup").length){var i=this.trigger({phase:"before",type:"close",target:"popup",options:e});i.isCancelled!==!0&&(w2popup.status="closing",$("#w2ui-popup").css({"-webkit-transition":e.speed+"s opacity, "+e.speed+"s -webkit-transform","-webkit-transform":"scale(0.9)","-moz-transition":e.speed+"s opacity, "+e.speed+"s -moz-transform","-moz-transform":"scale(0.9)","-ms-transition":e.speed+"s opacity, "+e.speed+"s -ms-transform","-ms-transform":"scale(0.9)","-o-transition":e.speed+"s opacity, "+e.speed+"s -o-transform","-o-transform":"scale(0.9)",opacity:"0"}),w2popup.unlockScreen(e),setTimeout(function(){$("#w2ui-popup").remove(),w2popup.status="closed",t.trigger($.extend(i,{phase:"after"}))},1e3*e.speed),w2utils.keyboard.active(e._last_w2ui_name),e.keyboard&&$(document).off("keydown",this.keydown))}},toggle:function(){var e=this,t=$("#w2ui-popup").data("options"),i=this.trigger({phase:"before",type:"toggle",target:"popup",options:t});i.isCancelled!==!0&&(t.maximized===!0?w2popup.min():w2popup.max(),setTimeout(function(){e.trigger($.extend(i,{phase:"after"}))},1e3*t.speed+50))},max:function(){var e=this,t=$("#w2ui-popup").data("options");if(t.maximized!==!0){var i=this.trigger({phase:"before",type:"max",target:"popup",options:t});i.isCancelled!==!0&&(w2popup.status="resizing",t.prevSize=$("#w2ui-popup").css("width")+":"+$("#w2ui-popup").css("height"),w2popup.resize(1e4,1e4,function(){w2popup.status="open",t.maximized=!0,e.trigger($.extend(i,{phase:"after"}))}))}},min:function(){var e=this,t=$("#w2ui-popup").data("options");if(t.maximized===!0){var i=t.prevSize.split(":"),s=this.trigger({phase:"before",type:"min",target:"popup",options:t});s.isCancelled!==!0&&(w2popup.status="resizing",w2popup.resize(i[0],i[1],function(){w2popup.status="open",t.maximized=!1,t.prevSize=null,e.trigger($.extend(s,{phase:"after"}))}))}},get:function(){return $("#w2ui-popup").data("options")},set:function(e){w2popup.open(e)},clear:function(){$("#w2ui-popup .w2ui-msg-title").html(""),$("#w2ui-popup .w2ui-msg-body").html(""),$("#w2ui-popup .w2ui-msg-buttons").html("")},reset:function(){w2popup.open(w2popup.defaults)},load:function(e){function n(t,i){if(delete e.url,$("body").append('<div id="w2ui-tmp" style="display: none">'+t+"</div>"),"undefined"!=typeof i&&$("#w2ui-tmp #"+i).length>0?$("#w2ui-tmp #"+i).w2popup(e):$("#w2ui-tmp > div").w2popup(e),$("#w2ui-tmp > style").length>0){var s=$("<div>").append($("#w2ui-tmp > style").clone()).html();0==$("#w2ui-popup #div-style").length&&$("#w2ui-popup").append('<div id="div-style" style="position: absolute; left: -100; width: 1px"></div>'),$("#w2ui-popup #div-style").html(s)}$("#w2ui-tmp").remove()}if(w2popup.status="loading","undefined"==String(e.url))return void console.log("ERROR: The url parameter is empty.");var t=String(e.url).split("#"),i=t[0],s=t[1];"undefined"==String(e)&&(e={});var r=$("#w2ui-popup").data(i);"undefined"!=typeof r&&null!=r?n(r,s):$.get(i,function(e,t,r){n(r.responseText,s),$("#w2ui-popup").data(i,r.responseText)})},message:function(e){$().w2tag(),e||(e={width:200,height:100}),parseInt(e.width)<10&&(e.width=10),parseInt(e.height)<10&&(e.height=10),"undefined"==typeof e.hideOnClick&&(e.hideOnClick=!1);var t=$("#w2ui-popup").data("options")||{};("undefined"==typeof e.width||e.width>t.width-10)&&(e.width=t.width-10),("undefined"==typeof e.height||e.height>t.height-40)&&(e.height=t.height-40);var i=$("#w2ui-popup .w2ui-msg-title"),s=parseInt($("#w2ui-popup").width()),r=$("#w2ui-popup .w2ui-popup-message").length;if(""==$.trim(e.html)){$("#w2ui-popup #w2ui-message"+(r-1)).css("z-Index",250);var e=$("#w2ui-popup #w2ui-message"+(r-1)).data("options")||{};$("#w2ui-popup #w2ui-message"+(r-1)).remove(),"function"==typeof e.onClose&&e.onClose(),1==r?w2popup.unlock():$("#w2ui-popup #w2ui-message"+(r-2)).show()}else{$("#w2ui-popup .w2ui-popup-message").hide(),$("#w2ui-popup .w2ui-box1").before('<div id="w2ui-message'+r+'" class="w2ui-popup-message" style="display: none; '+(0==i.length?"top: 0px;":"top: "+w2utils.getSize(i,"height")+"px;")+("undefined"!=typeof e.width?"width: "+e.width+"px; left: "+(s-e.width)/2+"px;":"left: 10px; right: 10px;")+("undefined"!=typeof e.height?"height: "+e.height+"px;":"bottom: 6px;")+'-webkit-transition: .3s; -moz-transition: .3s; -ms-transition: .3s; -o-transition: .3s;"'+(e.hideOnClick===!0?'onclick="w2popup.message();"':"")+"></div>"),$("#w2ui-popup #w2ui-message"+r).data("options",e);var n=$("#w2ui-popup #w2ui-message"+r).css("display");$("#w2ui-popup #w2ui-message"+r).css({"-webkit-transform":"none"==n?"translateY(-"+e.height+"px)":"translateY(0px)","-moz-transform":"none"==n?"translateY(-"+e.height+"px)":"translateY(0px)","-ms-transform":"none"==n?"translateY(-"+e.height+"px)":"translateY(0px)","-o-transform":"none"==n?"translateY(-"+e.height+"px)":"translateY(0px)"}),"none"==n&&($("#w2ui-popup #w2ui-message"+r).show().html(e.html),setTimeout(function(){$("#w2ui-popup #w2ui-message"+r).css({"-webkit-transform":"none"==n?"translateY(0px)":"translateY(-"+e.height+"px)","-moz-transform":"none"==n?"translateY(0px)":"translateY(-"+e.height+"px)","-ms-transform":"none"==n?"translateY(0px)":"translateY(-"+e.height+"px)","-o-transform":"none"==n?"translateY(0px)":"translateY(-"+e.height+"px)"})},1),setTimeout(function(){$("#w2ui-popup #w2ui-message"+r).css({"-webkit-transition":"0s","-moz-transition":"0s","-ms-transition":"0s","-o-transition":"0s","z-Index":1500}),0==r&&w2popup.lock(),"function"==typeof e.onOpen&&e.onOpen()},300))}},lock:function(){var i=Array.prototype.slice.call(arguments,0);i.unshift($("#w2ui-popup")),w2utils.lock.apply(window,i)},unlock:function(){w2utils.unlock($("#w2ui-popup"))},lockScreen:function(e){return $("#w2ui-lock").length>0?!1:("undefined"==typeof e&&(e=$("#w2ui-popup").data("options")),"undefined"==typeof e&&(e={}),e=$.extend({},w2popup.defaults,e),$("body").append('<div id="w2ui-lock"     onmousewheel="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true; if (event.preventDefault) event.preventDefault(); else return false;"    style="position: '+("IE5"==w2utils.engine?"absolute":"fixed")+"; z-Index: 1199; left: 0px; top: 0px;            padding: 0px; margin: 0px; background-color: "+e.color+'; width: 100%; height: 100%; opacity: 0;"></div>'),setTimeout(function(){$("#w2ui-lock").css({"-webkit-transition":e.speed+"s opacity","-moz-transition":e.speed+"s opacity","-ms-transition":e.speed+"s opacity","-o-transition":e.speed+"s opacity",opacity:e.opacity})},1),1==e.modal?($("#w2ui-lock").on("mousedown",function(){$("#w2ui-lock").css({"-webkit-transition":".1s","-moz-transition":".1s","-ms-transition":".1s","-o-transition":".1s",opacity:"0.6"})}),$("#w2ui-lock").on("mouseup",function(){setTimeout(function(){$("#w2ui-lock").css({"-webkit-transition":".1s","-moz-transition":".1s","-ms-transition":".1s","-o-transition":".1s",opacity:e.opacity})},100)})):$("#w2ui-lock").on("mouseup",function(){w2popup.close()}),!0)},unlockScreen:function(e){return 0==$("#w2ui-lock").length?!1:("undefined"==typeof e&&(e=$("#w2ui-popup").data("options")),"undefined"==typeof e&&(e={}),e=$.extend({},w2popup.defaults,e),$("#w2ui-lock").css({"-webkit-transition":e.speed+"s opacity","-moz-transition":e.speed+"s opacity","-ms-transition":e.speed+"s opacity","-o-transition":e.speed+"s opacity",opacity:0}),setTimeout(function(){$("#w2ui-lock").remove()},1e3*e.speed),!0)},resize:function(e,t,i){var s=$("#w2ui-popup").data("options");parseInt($(window).width())-10<parseInt(e)&&(e=parseInt($(window).width())-10),parseInt($(window).height())-10<parseInt(t)&&(t=parseInt($(window).height())-10);var r=(parseInt($(window).height())-parseInt(t))/2*.8,n=(parseInt($(window).width())-parseInt(e))/2;$("#w2ui-popup").css({"-webkit-transition":s.speed+"s width, "+s.speed+"s height, "+s.speed+"s left, "+s.speed+"s top","-moz-transition":s.speed+"s width, "+s.speed+"s height, "+s.speed+"s left, "+s.speed+"s top","-ms-transition":s.speed+"s width, "+s.speed+"s height, "+s.speed+"s left, "+s.speed+"s top","-o-transition":s.speed+"s width, "+s.speed+"s height, "+s.speed+"s left, "+s.speed+"s top",top:r,left:n,width:e,height:t}),setTimeout(function(){s.width=e,s.height=t,"function"==typeof i&&i()},1e3*s.speed+50)}},$.extend(w2popup,w2utils.event)}();var w2alert=function(e,t,i){null==t&&(t=w2utils.lang("Notification")),$("#w2ui-popup").length>0&&"closing"!=w2popup.status?w2popup.message({width:400,height:170,html:'<div style="position: absolute; top: 0px; left: 0px; right: 0px; bottom: 45px; overflow: auto">        <div class="w2ui-centered" style="font-size: 13px;">'+e+'</div></div><div style="position: absolute; bottom: 7px; left: 0px; right: 0px; text-align: center; padding: 5px">        <button onclick="w2popup.message();" class="w2ui-popup-btn btn">'+w2utils.lang("Ok")+"</button></div>",onClose:function(){"function"==typeof i&&i()}}):w2popup.open({width:450,height:220,showMax:!1,showClose:!1,title:t,body:'<div class="w2ui-centered" style="font-size: 13px;">'+e+"</div>",buttons:'<button onclick="w2popup.close();" class="w2ui-popup-btn btn">'+w2utils.lang("Ok")+"</button>",onClose:function(){"function"==typeof i&&i()}})},w2confirm=function(e,t,i){var s={},r={msg:"",title:w2utils.lang("Confirmation"),width:$("#w2ui-popup").length>0?400:450,height:$("#w2ui-popup").length>0?170:220,yes_text:"Yes",yes_class:"",yes_style:"",yes_callBack:null,no_text:"No",no_class:"",no_style:"",no_callBack:null,callBack:null};return 1==arguments.length&&"object"==typeof e?$.extend(s,r,e):"function"==typeof t?$.extend(s,r,{msg:e,callBack:t}):$.extend(s,r,{msg:e,title:t,callBack:i}),$("#w2ui-popup").length>0&&"closing"!=w2popup.status?(s.width>w2popup.get().width&&(s.width=w2popup.get().width),s.height>w2popup.get().height-50&&(s.height=w2popup.get().height-50),w2popup.message({width:s.width,height:s.height,html:'<div style="position: absolute; top: 0px; left: 0px; right: 0px; bottom: 40px; overflow: auto">        <div class="w2ui-centered" style="font-size: 13px;">'+s.msg+'</div></div><div style="position: absolute; bottom: 7px; left: 0px; right: 0px; text-align: center; padding: 5px">        <button id="Yes" class="w2ui-popup-btn btn '+s.yes_class+'" style="'+s.yes_style+'">'+w2utils.lang(s.yes_text)+'</button>        <button id="No" class="w2ui-popup-btn btn '+s.no_class+'" style="'+s.no_style+'">'+w2utils.lang(s.no_text)+"</button></div>",onOpen:function(){$("#w2ui-popup .w2ui-popup-message .btn").on("click",function(e){w2popup.message(),"function"==typeof s.callBack&&s.callBack(e.target.id),"Yes"==e.target.id&&"function"==typeof s.yes_callBack&&s.yes_callBack(),"No"==e.target.id&&"function"==typeof s.no_callBack&&s.no_callBack()})},onKeydown:function(e){switch(e.originalEvent.keyCode){case 13:"function"==typeof s.callBack&&s.callBack("Yes"),"function"==typeof s.yes_callBack&&s.yes_callBack(),w2popup.message();break;case 27:"function"==typeof s.callBack&&s.callBack("No"),"function"==typeof s.no_callBack&&s.no_callBack(),w2popup.message()}}})):(w2utils.isInt(s.height)||(s.height=s.height+50),w2popup.open({width:s.width,height:s.height,title:s.title,modal:!0,showClose:!1,body:'<div class="w2ui-centered" style="font-size: 13px;">'+s.msg+"</div>",buttons:'<button id="Yes" class="w2ui-popup-btn btn '+s.yes_class+'" style="'+s.yes_style+'">'+w2utils.lang(s.yes_text)+'</button><button id="No" class="w2ui-popup-btn btn '+s.no_class+'" style="'+s.no_style+'">'+w2utils.lang(s.no_text)+"</button>",onOpen:function(e){e.onComplete=function(){$("#w2ui-popup .w2ui-popup-btn").on("click",function(e){w2popup.close(),"function"==typeof s.callBack&&s.callBack(e.target.id),"Yes"==e.target.id&&"function"==typeof s.yes_callBack&&s.yes_callBack(),"No"==e.target.id&&"function"==typeof s.no_callBack&&s.no_callBack()})}},onKeydown:function(e){switch(e.originalEvent.keyCode){case 13:"function"==typeof s.callBack&&s.callBack("Yes"),"function"==typeof s.yes_callBack&&s.yes_callBack(),w2popup.close();break;case 27:"function"==typeof s.callBack&&s.callBack("No"),"function"==typeof s.no_callBack&&s.no_callBack(),w2popup.close()}}})),{yes:function(e){return s.yes_callBack=e,this},no:function(e){return s.no_callBack=e,this}}};!function(){var e=function(e){this.box=null,this.name=null,this.active=null,this.tabs=[],this.routeData={},this.right="",this.style="",this.onClick=null,this.onClose=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,$.extend(this,{handlers:[]}),$.extend(!0,this,w2obj.tabs,e)};$.fn.w2tabs=function(t){if("object"!=typeof t&&t){if(w2ui[$(this).attr("name")]){var n=w2ui[$(this).attr("name")];return n[t].apply(n,Array.prototype.slice.call(arguments,1)),this}return void console.log("ERROR: Method "+t+" does not exist on jQuery.w2tabs")}if(w2utils.checkName(t,"w2tabs")){for(var i=t.tabs||[],s=new e(t),r=0;r<i.length;r++)s.tabs[r]=$.extend({},e.prototype.tab,i[r]);return 0!==$(this).length&&s.render($(this)[0]),w2ui[s.name]=s,s}},e.prototype={tab:{id:null,text:"",route:null,hidden:!1,disabled:!1,closable:!1,hint:"",onClick:null,onRefresh:null,onClose:null},add:function(e){return this.insert(null,e)},insert:function(t,i){$.isArray(i)||(i=[i]);for(var s=0;s<i.length;s++){if("undefined"==typeof i[s].id)return void console.log('ERROR: The parameter "id" is required but not supplied. (obj: '+this.name+")");if(!w2utils.checkUniqueId(i[s].id,this.tabs,"tabs",this.name))return;var r=$.extend({},e.prototype.tab,i[s]);if(null===t||"undefined"==typeof t)this.tabs.push(r);else{var n=this.get(t,!0);this.tabs=this.tabs.slice(0,n).concat([r],this.tabs.slice(n))}this.refresh(i[s].id)}},remove:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);if(!i)return!1;e++,this.tabs.splice(this.get(i.id,!0),1),$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(i.id)).remove()}return e},select:function(e){return this.active==e||null===this.get(e)?!1:(this.active=e,this.refresh(),!0)},set:function(e,t){var i=this.get(e,!0);return null===i?!1:($.extend(this.tabs[i],t),this.refresh(e),!0)},get:function(e,t){if(0===arguments.length){for(var i=[],s=0;s<this.tabs.length;s++)null!=this.tabs[s].id&&i.push(this.tabs[s].id);
return i}for(var r=0;r<this.tabs.length;r++)if(this.tabs[r].id==e)return t===!0?r:this.tabs[r];return null},show:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var r=this.get(arguments[s]);r&&r.hidden!==!1&&(t++,r.hidden=!1,i.push(r.id))}return setTimeout(function(){for(var t in i)e.refresh(i[t])},15),t},hide:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var r=this.get(arguments[s]);r&&r.hidden!==!0&&(t++,r.hidden=!0,i.push(r.id))}return setTimeout(function(){for(var t in i)e.refresh(i[t])},15),t},enable:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var r=this.get(arguments[s]);r&&r.disabled!==!1&&(t++,r.disabled=!1,i.push(r.id))}return setTimeout(function(){for(var t in i)e.refresh(i[t])},15),t},disable:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var r=this.get(arguments[s]);r&&r.disabled!==!0&&(t++,r.disabled=!0,i.push(r.id))}return setTimeout(function(){for(var t in i)e.refresh(i[t])},15),t},refresh:function(e){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"refresh",target:"undefined"!=typeof e?e:this.name,object:this.get(e)});if(i.isCancelled!==!0){if("undefined"==typeof e)for(var s=0;s<this.tabs.length;s++)this.refresh(this.tabs[s].id);else{var r=this.get(e);if(null===r)return!1;"undefined"!=typeof r.caption&&(r.text=r.caption);var n=$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(r.id)),a=(r.closable?'<div class="w2ui-tab-close" onclick="w2ui[\''+this.name+"'].animateClose('"+r.id+"', event);\"></div>":"")+'    <div class="w2ui-tab'+(this.active===r.id?" active":"")+(r.closable?" closable":"")+'"         title="'+("undefined"!=typeof r.hint?r.hint:"")+'"        onclick="w2ui[\''+this.name+"'].click('"+r.id+"', event);\">"+r.text+"</div>";if(0===n.length){var o="";r.hidden&&(o+="display: none;"),r.disabled&&(o+="opacity: 0.2; -moz-opacity: 0.2; -webkit-opacity: 0.2; -o-opacity: 0.2; filter:alpha(opacity=20);");var l='<td id="tabs_'+this.name+"_tab_"+r.id+'" style="'+o+'" valign="middle">'+a+"</td>";this.get(e,!0)!==this.tabs.length-1&&$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(e,!0))+1].id)).length>0?$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(e,!0))+1].id)).before(l):$(this.box).find("#tabs_"+this.name+"_right").before(l)}else n.html(a),r.hidden?n.css("display","none"):n.css("display",""),n.css(r.disabled?{opacity:"0.2","-moz-opacity":"0.2","-webkit-opacity":"0.2","-o-opacity":"0.2",filter:"alpha(opacity=20)"}:{opacity:"1","-moz-opacity":"1","-webkit-opacity":"1","-o-opacity":"1",filter:"alpha(opacity=100)"})}return $("#tabs_"+this.name+"_right").html(this.right),this.trigger($.extend(i,{phase:"after"})),(new Date).getTime()-t}},render:function(e){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"render",target:this.name,box:e});if(i.isCancelled!==!0){if("undefined"!=typeof e&&null!==e&&($(this.box).find("> table #tabs_"+this.name+"_right").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),this.box=e),!this.box)return!1;var s='<table cellspacing="0" cellpadding="1" width="100%">    <tr><td width="100%" id="tabs_'+this.name+'_right" align="right">'+this.right+"</td></tr></table>";return $(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-tabs").html(s),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),this.trigger($.extend(i,{phase:"after"})),this.refresh(),(new Date).getTime()-t}},resize:function(){var e=(new Date).getTime(),t=this.trigger({phase:"before",type:"resize",target:this.name});return t.isCancelled!==!0?(this.trigger($.extend(t,{phase:"after"})),(new Date).getTime()-e):void 0},destroy:function(){var e=this.trigger({phase:"before",type:"destroy",target:this.name});e.isCancelled!==!0&&($(this.box).find("> table #tabs_"+this.name+"_right").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})))},click:function(e,t){var i=this.get(e);if(null===i||i.disabled)return!1;var s=this.trigger({phase:"before",type:"click",target:e,tab:i,object:i,originalEvent:t});if(s.isCancelled!==!0){if($(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.active)+" .w2ui-tab").removeClass("active"),this.active=i.id,i.route){var r=String("/"+i.route).replace(/\/{2,}/g,"/"),n=w2utils.parseRoute(r);if(n.keys.length>0)for(var a=0;a<n.keys.length;a++)null!=this.routeData[n.keys[a].name]&&(r=r.replace(new RegExp(":"+n.keys[a].name,"g"),this.routeData[n.keys[a].name]));setTimeout(function(){window.location.hash=r},1)}this.trigger($.extend(s,{phase:"after"})),this.refresh(e)}},animateClose:function(e,t){var i=this.get(e);if(null===i||i.disabled)return!1;var s=this.trigger({phase:"before",type:"close",target:e,object:this.get(e),originalEvent:t});if(s.isCancelled!==!0){var r=this;$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(i.id)).css({"-webkit-transition":".2s","-moz-transition":"2s","-ms-transition":".2s","-o-transition":".2s",opacity:"0"}),setTimeout(function(){var e=$(r.box).find("#tabs_"+r.name+"_tab_"+w2utils.escapeId(i.id)).width();$(r.box).find("#tabs_"+r.name+"_tab_"+w2utils.escapeId(i.id)).html('<div style="width: '+e+'px; -webkit-transition: .2s; -moz-transition: .2s; -ms-transition: .2s; -o-transition: .2s"></div>'),setTimeout(function(){$(r.box).find("#tabs_"+r.name+"_tab_"+w2utils.escapeId(i.id)).find(":first-child").css({width:"0px"})},50)},200),setTimeout(function(){r.remove(e)},450),this.trigger($.extend(s,{phase:"after"})),this.refresh()}},animateInsert:function(e,t){if(null!==this.get(e)&&$.isPlainObject(t)&&w2utils.checkUniqueId(t.id,this.tabs,"tabs",this.name)){var i=$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(t.id));if(0===i.length){"undefined"!=typeof t.caption&&(t.text=t.caption);var s='<div id="_tmp_tabs" class="w2ui-reset w2ui-tabs" style="position: absolute; top: -1000px;"><table cellspacing="0" cellpadding="1" width="100%"><tr><td id="_tmp_simple_tab" style="" valign="middle">'+(t.closable?'<div class="w2ui-tab-close"></div>':"")+'    <div class="w2ui-tab '+(this.active===t.id?"active":"")+'">'+t.text+"</div></td></tr></table></div>";$("body").append(s);var r='<div style="width: 1px; -webkit-transition: 0.2s; -moz-transition: 0.2s; -ms-transition: 0.2s; -o-transition: 0.2s;">&nbsp;</div>',n="";t.hidden&&(n+="display: none;"),t.disabled&&(n+="opacity: 0.2; -moz-opacity: 0.2; -webkit-opacity: 0.2; -o-opacity: 0.2; filter:alpha(opacity=20);");var a='<td id="tabs_'+this.name+"_tab_"+t.id+'" style="'+n+'" valign="middle">'+r+"</td>";this.get(e,!0)!==this.tabs.length&&$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(e,!0))].id)).length>0?$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(e,!0))].id)).before(a):$(this.box).find("#tabs_"+this.name+"_right").before(a);var o=this;setTimeout(function(){var e=$("#_tmp_simple_tab").width();$("#_tmp_tabs").remove(),$("#tabs_"+o.name+"_tab_"+w2utils.escapeId(t.id)+" > div").css("width",e+"px")},1),setTimeout(function(){o.insert(e,t)},200)}}}},$.extend(e.prototype,w2utils.event),w2obj.tabs=e}(),function(){var e=function(e){this.box=null,this.name=null,this.routeData={},this.items=[],this.right="",this.onClick=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,$.extend(!0,this,w2obj.toolbar,e)};$.fn.w2toolbar=function(t){if("object"==typeof t||!t){if(!w2utils.checkName(t,"w2toolbar"))return;var i=t.items||[],s=new e(t);$.extend(s,{items:[],handlers:[]});for(var r=0;r<i.length;r++)s.items[r]=$.extend({},e.prototype.item,i[r]);return 0!==$(this).length&&s.render($(this)[0]),w2ui[s.name]=s,s}if(w2ui[$(this).attr("name")]){var n=w2ui[$(this).attr("name")];return n[t].apply(n,Array.prototype.slice.call(arguments,1)),this}console.log("ERROR: Method "+t+" does not exist on jQuery.w2toolbar")},e.prototype={item:{id:null,type:"button",text:"",route:null,html:"",img:null,icon:null,count:null,hidden:!1,disabled:!1,checked:!1,arrow:!0,hint:"",group:null,items:null,overlay:{},onClick:null},add:function(e){this.insert(null,e)},insert:function(t,i){$.isArray(i)||(i=[i]);for(var s=0;s<i.length;s++){if("undefined"==typeof i[s].type)return void console.log('ERROR: The parameter "type" is required but not supplied in w2toolbar.add() method.');if(-1===$.inArray(String(i[s].type),["button","check","radio","drop","menu","break","html","spacer"]))return void console.log('ERROR: The parameter "type" should be one of the following [button, check, radio, drop, menu, break, html, spacer] in w2toolbar.add() method.');if("undefined"==typeof i[s].id)return void console.log('ERROR: The parameter "id" is required but not supplied in w2toolbar.add() method.');if(!w2utils.checkUniqueId(i[s].id,this.items,"toolbar items",this.name))return;var r=$.extend({},e.prototype.item,i[s]);if(null==t)this.items.push(r);else{var n=this.get(t,!0);this.items=this.items.slice(0,n).concat([r],this.items.slice(n))}this.refresh(r.id)}},remove:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);if(i){e++,$(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(i.id)).remove();var s=this.get(i.id,!0);s&&this.items.splice(s,1)}}return e},set:function(e,t){var i=this.get(e,!0);return null===i?!1:($.extend(this.items[i],t),this.refresh(e),!0)},get:function(e,t){if(0===arguments.length){for(var i=[],s=0;s<this.items.length;s++)null!==this.items[s].id&&i.push(this.items[s].id);return i}for(var r=0;r<this.items.length;r++)if(this.items[r].id===e)return t===!0?r:this.items[r];return null},show:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var r=this.get(arguments[s]);r&&(t++,r.hidden=!1,i.push(r.id))}return setTimeout(function(){for(var t in i)e.refresh(i[t])},15),t},hide:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var r=this.get(arguments[s]);r&&(t++,r.hidden=!0,i.push(r.id))}return setTimeout(function(){for(var t in i)e.refresh(i[t])},15),t},enable:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var r=this.get(arguments[s]);r&&(t++,r.disabled=!1,i.push(r.id))}return setTimeout(function(){for(var t in i)e.refresh(i[t])},15),t},disable:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var r=this.get(arguments[s]);r&&(t++,r.disabled=!0,i.push(r.id))}return setTimeout(function(){for(var t in i)e.refresh(i[t])},15),t},check:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var r=this.get(arguments[s]);r&&(t++,r.checked=!0,i.push(r.id))}return setTimeout(function(){for(var t in i)e.refresh(i[t])},15),t},uncheck:function(){for(var e=this,t=0,i=[],s=0;s<arguments.length;s++){var r=this.get(arguments[s]);r&&(t++,r.checked=!1,i.push(r.id))}return setTimeout(function(){for(var t in i)e.refresh(i[t])},15),t},render:function(e){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"render",target:this.name,box:e});if(i.isCancelled!==!0&&(null!=e&&($(this.box).find("> table #tb_"+this.name+"_right").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),this.box=e),this.box)){for(var s='<table cellspacing="0" cellpadding="0" width="100%"><tr>',r=0;r<this.items.length;r++){var n=this.items[r];null==n.id&&(n.id="item_"+r),null!==n&&(s+="spacer"===n.type?'<td width="100%" id="tb_'+this.name+"_item_"+n.id+'" align="right"></td>':'<td id="tb_'+this.name+"_item_"+n.id+'" style="'+(n.hidden?"display: none":"")+'"     class="'+(n.disabled?"disabled":"")+'" valign="middle">'+this.getItemHTML(n)+"</td>")}return s+='<td width="100%" id="tb_'+this.name+'_right" align="right">'+this.right+"</td>",s+="</tr></table>",$(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-toolbar").html(s),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),this.trigger($.extend(i,{phase:"after"})),(new Date).getTime()-t}},refresh:function(e){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"refresh",target:"undefined"!=typeof e?e:this.name,item:this.get(e)});if(i.isCancelled!==!0){if(null==e)for(var s=0;s<this.items.length;s++){var r=this.items[s];null==r.id&&(r.id="item_"+s),this.refresh(r.id)}var n=this.get(e);if(null===n)return!1;var a=$(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(n.id)),o=this.getItemHTML(n);return 0===a.length?(o="spacer"===n.type?'<td width="100%" id="tb_'+this.name+"_item_"+n.id+'" align="right"></td>':'<td id="tb_'+this.name+"_item_"+n.id+'" style="'+(n.hidden?"display: none":"")+'"     class="'+(n.disabled?"disabled":"")+'" valign="middle">'+o+"</td>",this.get(e,!0)===this.items.length-1?$(this.box).find("#tb_"+this.name+"_right").before(o):$(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(this.items[parseInt(this.get(e,!0))+1].id)).before(o)):(a.html(o),n.hidden?a.css("display","none"):a.css("display",""),n.disabled?a.addClass("disabled"):a.removeClass("disabled")),this.trigger($.extend(i,{phase:"after"})),(new Date).getTime()-t}},resize:function(){var e=(new Date).getTime(),t=this.trigger({phase:"before",type:"resize",target:this.name});return t.isCancelled!==!0?(this.trigger($.extend(t,{phase:"after"})),(new Date).getTime()-e):void 0},destroy:function(){var e=this.trigger({phase:"before",type:"destroy",target:this.name});e.isCancelled!==!0&&($(this.box).find("> table #tb_"+this.name+"_right").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),$(this.box).html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})))},getItemHTML:function(e){var t="";switch("undefined"!=typeof e.caption&&(e.text=e.caption),"undefined"==typeof e.hint&&(e.hint=""),"undefined"==typeof e.text&&(e.text=""),e.type){case"menu":case"button":case"check":case"radio":case"drop":var i="<td>&nbsp;</td>";e.img&&(i='<td><div class="w2ui-tb-image w2ui-icon '+e.img+'"></div></td>'),e.icon&&(i='<td><div class="w2ui-tb-image"><span class="'+e.icon+'"></span></div></td>'),t+='<table cellpadding="0" cellspacing="0" title="'+e.hint+'" class="w2ui-button '+(e.checked?"checked":"")+'"        onclick     = "var el=w2ui[\''+this.name+"']; if (el) el.click('"+e.id+'\', event);"        onmouseover = "'+(e.disabled?"":"$(this).addClass('over');")+'"       onmouseout  = "'+(e.disabled?"":"$(this).removeClass('over').removeClass('down');")+'"       onmousedown = "'+(e.disabled?"":"$(this).addClass('down');")+'"       onmouseup   = "'+(e.disabled?"":"$(this).removeClass('down');")+'"><tr><td>  <table cellpadding="1" cellspacing="0">  <tr>'+i+(""!==e.text?'<td class="w2ui-tb-caption" nowrap>'+e.text+"</td>":"")+(null!=e.count?'<td class="w2ui-tb-count" nowrap><span>'+e.count+"</span></td>":"")+("drop"!==e.type&&"menu"!==e.type||e.arrow===!1?"":'<td class="w2ui-tb-down" nowrap><div></div></td>')+"  </tr></table></td></tr></table>";break;case"break":t+='<table cellpadding="0" cellspacing="0"><tr>    <td><div class="w2ui-break">&nbsp;</div></td></tr></table>';break;case"html":t+='<table cellpadding="0" cellspacing="0"><tr>    <td nowrap>'+e.html+"</td></tr></table>"}var s="";return"function"==typeof e.onRender&&(s=e.onRender.call(this,e.id,t)),"function"==typeof this.onRender&&(s=this.onRender(e.id,t)),""!==s&&null!=s&&(t=s),t},menuClick:function(e){var t=this;if(e.item&&!e.item.disabled){var i=this.trigger({phase:"before",type:"click",target:e.item.id+":"+e.subItem.id,item:e.item,subItem:e.subItem,originalEvent:e.originalEvent});if(i.isCancelled===!0)return;var s=e.subItem;if(s.route){var r=String("/"+s.route).replace(/\/{2,}/g,"/"),n=w2utils.parseRoute(r);if(n.keys.length>0)for(var a=0;a<n.keys.length;a++)null!=t.routeData[n.keys[a].name]&&(r=r.replace(new RegExp(":"+n.keys[a].name,"g"),this.routeData[n.keys[a].name]));setTimeout(function(){window.location.hash=r},1)}this.trigger($.extend(i,{phase:"after"}))}},click:function(e,t){var i=this,s=this.get(e);if(s&&!s.disabled){var r=this.trigger({phase:"before",type:"click",target:"undefined"!=typeof e?e:this.name,item:s,object:s,originalEvent:t});if(r.isCancelled===!0)return;var n=$("#tb_"+this.name+"_item_"+w2utils.escapeId(s.id)+" table.w2ui-button");if(n.removeClass("down"),"radio"===s.type){for(var a=0;a<this.items.length;a++){var o=this.items[a];null!=o&&o.id!==s.id&&"radio"===o.type&&o.group===s.group&&o.checked&&(o.checked=!1,this.refresh(o.id))}s.checked=!0,n.addClass("checked")}if(("drop"===s.type||"menu"===s.type)&&(s.checked?s.checked=!1:setTimeout(function(){function r(){$(document).off("click",r),s.checked=!1,n.removeClass("checked")}var e=$("#tb_"+i.name+"_item_"+w2utils.escapeId(s.id));$.isPlainObject(s.overlay)||(s.overlay={});var t=(e.width()-50)/2;t>19&&(t=19),"drop"===s.type&&e.w2overlay(s.html,$.extend({left:t,top:3},s.overlay)),"menu"===s.type&&e.w2menu(s.items,$.extend({left:t,top:3},s.overlay,{select:function(e){i.menuClick({item:s,subItem:e.item,originalEvent:e.originalEvent}),r()}})),$(document).on("click",r)},1)),("check"===s.type||"drop"===s.type||"menu"===s.type)&&(s.checked=!s.checked,s.checked?n.addClass("checked"):n.removeClass("checked")),s.route){var l=String("/"+s.route).replace(/\/{2,}/g,"/"),d=w2utils.parseRoute(l);if(d.keys.length>0)for(var u=0;u<d.keys.length;u++)l=l.replace(new RegExp(":"+d.keys[u].name,"g"),this.routeData[d.keys[u].name]);setTimeout(function(){window.location.hash=l},1)}this.trigger($.extend(r,{phase:"after"}))}}},$.extend(e.prototype,w2utils.event),w2obj.toolbar=e}(),function(){var e=function(e){this.gCheck=!1,this.checkeditem=[],this.checkeditemTemp=null,this.name=null,this.box=null,this.sidebar=null,this.parent=null,this.nodes=[],this.menu=[],this.routeData={},this.selected=null,this.img=null,this.icon=null,this.style="",this.topHTML="",this.bottomHTML="",this.keyboard=!0,this.onClick=null,this.onDblClick=null,this.onContextMenu=null,this.onMenuClick=null,this.onExpand=null,this.onCollapse=null,this.onKeydown=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,this.returnElement=null,this.returnCondition=null,this.hideChecked=null,this.hidenCheckedInfo={layerVisible:{}},$.extend(!0,this,w2obj.sidebar,e)};$.fn.w2sidebar=function(t){if("object"==typeof t||!t){if(!w2utils.checkName(t,"w2sidebar"))return;var i=t.nodes,s=new e(t);return $.extend(s,{handlers:[],nodes:[]}),"undefined"!=typeof i&&s.add(s,i),0!==$(this).length&&s.render($(this)[0]),s.sidebar=s,w2ui[s.name]=s,s}if(w2ui[$(this).attr("name")]){var r=w2ui[$(this).attr("name")];return r[t].apply(r,Array.prototype.slice.call(arguments,1)),this}console.log("ERROR: Method "+t+" does not exist on jQuery.w2sidebar")},e.prototype={node:{panischecked:!1,layerVisible:!1,gClickable:!1,id:null,text:"",count:null,img:null,icon:null,nodes:[],style:"",route:null,selected:!1,expanded:!1,hidden:!1,disabled:!1,group:!1,groupShowHide:!0,plus:!1,hint:"",onClick:null,onDblClick:null,onContextMenu:null,onExpand:null,onCollapse:null,parent:null,sidebar:null},recurs:function(e,t){var r,n,i=e.nodes.length,s=!1;for(r=0;i>r;r++)n=e.nodes[r],t&&(s=!0,n.panischecked=!0),1==n.panischecked&&(this.putElementInArray(n),this.recurs(n,s))},putElementInArray:function(e){null!==this.returnCondition&&"function"==typeof this.returnCondition?this.returnCondition(e)&&this.checkeditem.push(e):this.checkeditem.push(e)},returnElementArray:function(e){this.checkeditem.length>0&&null!==this.returnElement&&"function"==typeof this.returnElement&&this.returnElement(e,this.checkeditem,this.checkeditemTemp)},onElementAndAllParent:function(e,t,i){var s=this,r=e.parent,n=e.id,a=!1;for(r==s&&(n=e.id,e.panischecked=!0,s.hidenCheckedInfo[e.id]=!0),null===this.hideChecked&&this.putElementInArray(e);r!==s;)r.group||(t&&(a=r),n=r.id),e.panischecked=!0,r.panischecked=!0,s.hidenCheckedInfo[r.id]=!0,null===this.hideChecked&&this.putElementInArray(r),i&&this.putElementInArray(r),r=r.parent;return{id:n,sendData:!0,node:a}},offElementAndAllParent:function(e){var s,t=this,i=e.parent;for(void 0!==i.name&&t.name==i.name&&(s=e.id,e.panischecked=!1,t.hidenCheckedInfo[e.id]=!1),this.putElementInArray(e);i!==t;)s=i.id,e.panischecked=!1,i.panischecked=!1,t.hidenCheckedInfo[i.id]=!1,this.putElementInArray(i),i=i.parent;return{id:s,sendData:!1}},onAllChildren:function(e){var t=this,i=e.parent,s=!0;if(0===e.nodes.length)return!1;for(;i!==t;){if(i!==t&&void 0!==i.panischecked&&i.panischecked===!1&&i.gClickable!==!1){s=!1;break}i=i.parent}if(e.nodes.length>0){this.putElementInArray(e);var n,a,r=e.nodes.length,o=e.id;for(e.gClickable&&(e.panischecked=!0,t.hidenCheckedInfo[e.id]=!0),a=0;r>a;a++)n=e.nodes[a],n.panischecked=!0,t.hidenCheckedInfo[n.id]=!0,1==n.panischecked&&(this.putElementInArray(n),this.recurs(n,!0));return this.checkeditemTemp=o,{id:o,sendData:s}}},offAllChildren:function(e){var t=this,s=(e.parent,!1);if(0===e.nodes.length)return!1;if(e.nodes.length>0){this.putElementInArray(e);var n,a,r=e.nodes.length,o=e.id;for(e.gClickable&&(e.panischecked=!1,t.hidenCheckedInfo[e.id]=!1),a=0;r>a;a++)n=e.nodes[a],n.panischecked=!1,t.hidenCheckedInfo[n.id]=!1,0==n.panischecked&&(this.putElementInArray(n),this.recurs(n,!1));return this.checkeditemTemp=o,{id:o,sendData:s}}},setCheckedMode:function(e,t,i){this.checkeditem=[];var s,r;return(s="object"==typeof e?e:this.get(e))?("n"===t&&(r=i?this.onElementAndAllParent(s,!1,i):this.onElementAndAllParent(s)),"s"===t&&(r=this.onAllChildren(s)),"ns"===t&&(r=this.onElementAndAllParent(s),this.onAllChildren(s)),"offn"===t&&(r=this.offElementAndAllParent(s)),"offs"===t&&(r=this.offAllChildren(s)),"offns"===t&&(r=this.offElementAndAllParent(s),this.offAllChildren(s)),this.returnElementArray(r.sendData===!0?!0:!1),void(null!==r.id&&this.refresh(r.id))):!1},integrationRight:function(e,t){if(void 0===t||0==t.lenth||!t)return console.log("Data is "+t),!1;var s=t.length,r=this.get(t[0].id);if(null===r)return console.log("Node is "+r),!1;var a,l,n=r.parent,d=this;if(1==s){for(r.expanded=e,r.hidden=!e,r.checkedIsReady=e,n.counCheckChildren=1;n!==d&&(0==n.group&&(a=n.id),1!=n.expanded||0!=n.hidden);)n.checkedIsReady=e,n.expanded=e,n.hidden=!e,n.gClickable=!e,n=n.parent;if(!e)for(var c,u=r.parent.nodes.length,h=r.parent,f=0;h!==d;){for(0==h.group&&(c=h.id),u=h.nodes.length,l=0;u>l;l++)if(!h.nodes[l].hidden){f++;break}0==f&&(h.expanded=e,h.hidden=!e,h.panischecked=e,h.gClickable=!e),h=h.parent}this.refresh(e?a:c)}if(s>1){if(e){var p,g,m;for(p=0;s>p;p++)for(g=this.get(t[p].id),g.expanded=e,g.hidden=!e,m=g.parent;m!==d;)0==m.group&&(a=m.id),m.expanded=e,m.hidden=!e,m.massCheckReady=!0,m.gClickable=!e,m=m.parent}if(!e){var v,w;for(v=0;s>v;v++){w=this.get(t[v].id),w.expanded=e,w.hidden=!e,w.parent.expanded=e,w.parent.hidden=!e;for(var _,T,k=w.parent,C=0;k!==d;){for(0==v&&0==k.group&&(T=k.id),_=k.nodes.length,l=0;_>l;l++)if(!k.nodes[l].hidden){C++;break}0==C&&(k.expanded=e,k.hidden=!e,k.panischecked=e,k.gClickable=!e),k=k.parent}}}this.refresh(e?a:T)}},saveLocalSt:function(){},checkRefreshChildren:function(e,t){function n(e,t){for(var i=0;i<e.nodes.length;i++)e.nodes[i].gClickable&&t.hidenCheckedInfo[e.nodes[i].id]&&void 0!==t.hidenCheckedInfo[e.nodes[i].id]&&(e.nodes[i].panischecked=t.hidenCheckedInfo[e.nodes[i].id],t.putElementInArray(e.nodes[i]),t.hidenCheckedInfo.layerVisible[e.nodes[i].id]=!0),e.nodes[i].nodes.length>0&&e.nodes[i].panischecked&&n(e.nodes[i],t)}function o(e,t){for(var i=0;i<e.nodes.length;i++)void 0!=e.nodes[i].panischecked&&e.nodes[i].gClickable&&e.nodes[i].panischecked&&(t.hidenCheckedInfo[e.nodes[i].id]=e.nodes[i].panischecked,e.nodes[i].panischecked=!1,t.putElementInArray(e.nodes[i]),t.hidenCheckedInfo.layerVisible[e.nodes[i].id]=!1),e.nodes[i].nodes.length>0&&o(e.nodes[i],t)}var i=null;i=e.node?e.node:this.get(e.id),e.id=i.id;var s=this;if(t){this.hidenCheckedInfo.layerVisible[i.id]=t,this.putElementInArray(i);for(var r=0;r<i.nodes.length;r++)i.nodes[r].gClickable&&this.hidenCheckedInfo[i.nodes[r].id]&&void 0!==this.hidenCheckedInfo[i.nodes[r].id]&&(i.nodes[r].panischecked=this.hidenCheckedInfo[i.nodes[r].id],this.putElementInArray(i.nodes[r]),this.hidenCheckedInfo.layerVisible[i.nodes[r].id]=!0),i.nodes[r].nodes.length>0&&i.nodes[r].panischecked&&n(i.nodes[r],s)}if(!t){this.putElementInArray(i);for(var a=0;a<i.nodes.length;a++)void 0!=i.nodes[a].panischecked&&i.nodes[a].gClickable&&i.nodes[a].panischecked&&(this.hidenCheckedInfo[i.nodes[a].id]=i.nodes[a].panischecked,i.nodes[a].panischecked=!1,this.putElementInArray(i.nodes[a]),this.hidenCheckedInfo.layerVisible[i.nodes[a].id]=!1),i.nodes[a].nodes.length>0&&o(i.nodes[a],s)}localStorage.setItem("MapContentJSON",JSON.stringify(this.hidenCheckedInfo)),this.returnElementArray(t),this.refresh(e.id)},mapContent:function(e,t){var i=null;try{i=localStorage.setItem("MapContentJSON",JSON.stringify(this.hidenCheckedInfo))}catch(s){console.log("Can not find localStorage")}var r={id:e.id};this.select(e),t&&(r=this.onElementAndAllParent(e,!0)),this.checkRefreshChildren(r,t)},ItemChecked:function(e){this.checkeditem=[];var i=e.target.id,s=i.replace("gcheck_node_",""),r=this,n=this.get(s);if(null===n)return!1;n.panischecked=e.target.checked,r.hidenCheckedInfo[n.id]=e.target.checked;var a=n.parent,o=!1,l=!1,d=null;if(this.hideChecked)return this.mapContent(n,e.target.checked),!1;if(e.target.checked){if(void 0==a.name&&(1==a.panischecked&&void 0!==a.panischecked||void 0!==a.panischecked&&0==a.gClickable&&a.nodes.length>0)){for(l=!0;a!==r&&(0!=a.panischecked||0!=a.group||1!=a.gClickable);)a=a.parent;a==r&&(null!==this.returnCondition&&"function"==typeof this.returnCondition?this.returnCondition(n)&&this.checkeditem.push(n):this.checkeditem.push(n),o=!0)}if(l||a==r&&(null!==this.returnCondition&&"function"==typeof this.returnCondition?this.returnCondition(n)&&this.checkeditem.push(n):this.checkeditem.push(n),o=!0),o&&n.nodes.length>0)for(var u=n.nodes.length,h=0;u>h;h++){var f=n.nodes[h];1==f.panischecked&&(null!==this.returnCondition&&"function"==typeof this.returnCondition?this.returnCondition(f)&&this.checkeditem.push(f):this.checkeditem.push(f),this.recurs(f,!1))}}if(!e.target.checked){var c=!1,p=!1,g=!1;if(a!==r&&(1==a.panischecked&&void 0!==a.panischecked||void 0!==a.panischecked&&0==a.gClickable&&a.nodes.length>0)){for(g=!0;a!==r&&(0!=a.panischecked||0!=a.group||1!=a.gClickable);)a=a.parent;a==r&&n.nodes.length>0&&(this.putElementInArray(n),p=!0),a==r&&0==n.nodes.length&&(c=!0,null!==this.returnCondition&&"function"==typeof this.returnCondition?this.returnCondition(n)&&this.checkeditem.push(n):this.checkeditem.push(n))}if(a==r&&n.nodes.length>0&&g!==!0&&(p=!0),g||n.parent==r&&this.putElementInArray(n),p&&n.nodes.length>0)for(var m=n.nodes.length,v=0;m>v;v++){var w=n.nodes[v];1==w.panischecked&&(null!==this.returnCondition&&"function"==typeof this.returnCondition?this.returnCondition(w)&&this.checkeditem.push(w):this.checkeditem.push(w),w&&w.gClickable&&this.recurs(w,!1))}}d&&this.refresh(d),this.checkeditem.length>0&&null!==this.returnElement&&"function"==typeof this.returnElement&&this.returnElement(e.target.checked,this.checkeditem)},add:function(e,t){return 1==arguments.length&&(t=arguments[0],e=this),"string"==typeof e&&(e=this.get(e)),this.insert(e,null,t)},insert:function(t,i,s){var r,n,a,o,l;if(2==arguments.length){if(s=arguments[1],i=arguments[0],n=this.get(i),null===n)return $.isArray(s)||(s=[s]),r=null!=s[0].caption?s[0].caption:s[0].text,console.log('ERROR: Cannot insert node "'+r+'" because cannot find node "'+i+'" to insert before.'),null;t=this.get(i).parent}"string"==typeof t&&(t=this.get(t)),$.isArray(s)||(s=[s]);for(var d in s)if(o=s[d],null!=typeof o.id)if(null===this.get(this,o.id)){if(a=$.extend({},e.prototype.node,o),a.sidebar=this,a.parent=t,l=a.nodes||[],a.nodes=[],null===i)t.nodes.push(a);else{if(n=this.get(t,i,!0),null===n)return r=null!=o.caption?o.caption:o.text,console.log('ERROR: Cannot insert node "'+r+'" because cannot find node "'+i+'" to insert before.'),null;t.nodes.splice(n,0,a)}l.length>0&&this.insert(a,null,l)}else r=null!=o.caption?o.caption:o.text,console.log("ERROR: Cannot insert node with id="+o.id+" (text: "+r+") because another node with the same id already exists.");else r=null!=o.caption?o.caption:o.text,console.log('ERROR: Cannot insert node "'+r+'" because it has no id.');return this.refresh(t.id),a},remove:function(){for(var t,e=0,i=0;i<arguments.length;i++)if(t=this.get(arguments[i]),null!==t){null!==this.selected&&this.selected===t.id&&(this.selected=null);var s=this.get(t.parent,arguments[i],!0);null!==s&&(t.parent.nodes[s].selected&&t.sidebar.unselect(t.id),t.parent.nodes.splice(s,1),e++)}return e>0&&1==arguments.length?this.refresh(t.parent.id):this.refresh(),e},set:function(e,t,i){if(2==arguments.length&&(i=t,t=e,e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return null;for(var s=0;s<e.nodes.length;s++){if(e.nodes[s].id===t){var r=i.nodes;return $.extend(e.nodes[s],i,{nodes:[]}),null!=r&&this.add(e.nodes[s],r),this.refresh(t),!0}var n=this.set(e.nodes[s],t,i);if(n)return!0}return!1},get:function(e,t,i){if(0===arguments.length){for(var s=[],r=this.find({}),n=0;n<r.length;n++)null!=r[n].id&&s.push(r[n].id);return s}if((1==arguments.length||2==arguments.length&&t===!0)&&(i=t,t=e,e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return null;for(var a=0;a<e.nodes.length;a++){if(e.nodes[a].id==t)return i===!0?a:e.nodes[a];var o=this.get(e.nodes[a],t,i);if(o||0===o)return o}return null},find:function(e,t,i){if(1==arguments.length&&(t=e,e=this),i||(i=[]),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return i;for(var s=0;s<e.nodes.length;s++){var r=!0;for(var n in t)e.nodes[s][n]!=t[n]&&(r=!1);r&&i.push(e.nodes[s]),e.nodes[s].nodes.length>0&&(i=this.find(e.nodes[s],t,i))}return i},hide:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!==i&&(i.hidden=!0,e++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),e},show:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!==i&&(i.hidden=!1,e++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),e},disable:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!==i&&(i.disabled=!0,i.selected&&this.unselect(i.id),e++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),e},enable:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!==i&&(i.disabled=!1,e++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),e},select:function(e){var t;return(t="object"==typeof e?e:this.get(e))?this.selected==e&&t.selected?!1:(this.unselect(this.selected),$(this.box).find("#node_"+w2utils.escapeId(e)).addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),t.selected=!0,this.selected=e,!0):!1},unselect:function(e){var t=this.get(e);return t?(t.selected=!1,$(this.box).find("#node_"+w2utils.escapeId(e)).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),this.selected==e&&(this.selected=null),!0):!1},toggle:function(e){var t=this.get(e);return null===t?!1:t.plus?(this.set(e,{plus:!1}),this.expand(e),void this.refresh(e)):0===t.nodes.length?!1:this.get(e).expanded?this.collapse(e):this.expand(e)},collapse:function(e){var t=this,i=this.get(e),s=this.trigger({phase:"before",type:"collapse",target:e,object:i});return s.isCancelled!==!0?($(this.box).find("#node_"+w2utils.escapeId(e)+"_sub").slideUp(200),$(this.box).find("#node_"+w2utils.escapeId(e)+" .w2ui-node-dots:first-child").html('<div class="w2ui-expand">+</div>'),i.expanded=!1,this.trigger($.extend(s,{phase:"after"})),setTimeout(function(){t.refresh(e)},200),!0):void 0},collapseAll:function(e){if("undefined"==typeof e&&(e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return!1;for(var t=0;t<e.nodes.length;t++)e.nodes[t].expanded===!0&&(e.nodes[t].expanded=!1),e.nodes[t].nodes&&e.nodes[t].nodes.length>0&&this.collapseAll(e.nodes[t]);return this.refresh(e.id),!0},expand:function(e){var i,t=this;"object"==typeof e?(i=e,e=i.id):i=this.get(e);
var s=this.trigger({phase:"before",type:"expand",target:e,object:i});if(s.isCancelled!==!0)return $(this.box).find("#node_"+w2utils.escapeId(e)+"_sub").slideDown(200),$(this.box).find("#node_"+w2utils.escapeId(e)+" .w2ui-node-dots:first-child").html('<div class="w2ui-expand">-</div>'),i.expanded=!0,this.trigger($.extend(s,{phase:"after"})),setTimeout(function(){t.refresh(e)},200),!0},expandAll:function(e){if("undefined"==typeof e&&(e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return!1;for(var t=0;t<e.nodes.length;t++)e.nodes[t].expanded===!1&&(e.nodes[t].expanded=!0),e.nodes[t].nodes&&e.nodes[t].nodes.length>0&&this.collapseAll(e.nodes[t]);this.refresh(e.id)},expandParents:function(e){var t=this.get(e);return null===t?!1:(t.parent&&(t.parent.expanded=!0,this.expandParents(t.parent.id)),this.refresh(e),!0)},click:function(e,t){var i=this,s=this.get(e);if(null!==s&&!s.disabled&&!s.group){$(i.box).find(".w2ui-node.w2ui-selected").each(function(e,t){var s=$(t).attr("id").replace("node_",""),r=i.get(s);null!=r&&(r.selected=!1),$(t).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected")});var r=$(i.box).find("#node_"+w2utils.escapeId(e)),n=$(i.box).find("#node_"+w2utils.escapeId(i.selected));r.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),setTimeout(function(){var a=i.trigger({phase:"before",type:"click",target:e,originalEvent:t,node:s,object:s});if(a.isCancelled===!0)return r.removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),void n.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected");if(null!==n&&(n.selected=!1),i.get(e).selected=!0,i.selected=e,s.route){var o=String("/"+s.route).replace(/\/{2,}/g,"/"),l=w2utils.parseRoute(o);if(l.keys.length>0)for(var d=0;d<l.keys.length;d++)null!=i.routeData[l.keys[d].name]&&(o=o.replace(new RegExp(":"+l.keys[d].name,"g"),i.routeData[l.keys[d].name]));setTimeout(function(){window.location.hash=o},1)}i.trigger($.extend(a,{phase:"after"}))},1)}},keydown:function(e){function r(e,i){null===e||e.hidden||e.disabled||e.group||(t.click(e.id,i),setTimeout(function(){t.scrollIntoView()},50))}function n(e,t){for(e=t(e);null!==e&&(e.hidden||e.disabled)&&!e.group;)e=t(e);return e}function a(e,i){if(null===e)return null;var s=e.parent,r=t.get(e.id,!0),n=null;if(e.expanded&&e.nodes.length>0&&i!==!0){var o=e.nodes[0];n=o.hidden||o.disabled||o.group?a(o):o}else n=s&&r+1<s.nodes.length?s.nodes[r+1]:a(s,!0);return null!==n&&(n.hidden||n.disabled||n.group)&&(n=a(n)),n}function o(e){if(null===e)return null;var i=e.parent,s=t.get(e.id,!0),r=s>0?l(i.nodes[s-1]):i;return null!==r&&(r.hidden||r.disabled||r.group)&&(r=o(r)),r}function l(e){if(e.expanded&&e.nodes.length>0){var t=e.nodes[e.nodes.length-1];return t.hidden||t.disabled||t.group?o(t):l(t)}return e}var t=this,i=t.get(t.selected);if(i&&t.keyboard===!0){var s=t.trigger({phase:"before",type:"keydown",target:t.name,originalEvent:e});s.isCancelled!==!0&&((13==e.keyCode||32==e.keyCode)&&i.nodes.length>0&&t.toggle(t.selected),37==e.keyCode&&(i.nodes.length>0&&i.expanded?t.collapse(t.selected):(r(i.parent),i.parent.group||t.collapse(i.parent.id))),39==e.keyCode&&(i.nodes.length>0||i.plus)&&!i.expanded&&t.expand(t.selected),38==e.keyCode&&r(n(i,o)),40==e.keyCode&&r(n(i,a)),-1!=$.inArray(e.keyCode,[13,32,37,38,39,40])&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()),t.trigger($.extend(s,{phase:"after"})))}},scrollIntoView:function(e){"undefined"==typeof e&&(e=this.selected);var t=this.get(e);if(null!==t){var i=$(this.box).find(".w2ui-sidebar-div"),s=$(this.box).find("#node_"+w2utils.escapeId(e)),r=s.offset().top-i.offset().top;r+s.height()>i.height()&&i.animate({scrollTop:i.scrollTop()+i.height()/1.3},250,"linear"),0>=r&&i.animate({scrollTop:i.scrollTop()-i.height()/1.3},250,"linear")}},dblClick:function(e,t){var i=this.get(e),s=this.trigger({phase:"before",type:"dblClick",target:e,originalEvent:t,object:i});s.isCancelled!==!0&&(this.toggle(e),this.trigger($.extend(s,{phase:"after"})))},contextMenu:function(e,t){var i=this,s=i.get(e);e!=i.selected&&i.click(e),setTimeout(function(){var r=i.trigger({phase:"before",type:"contextMenu",target:e,originalEvent:t,object:s});r.isCancelled!==!0&&(s.group||s.disabled||(i.menu.length>0&&$(i.box).find("#node_"+w2utils.escapeId(e)).w2menu(i.menu,{left:(t?t.offsetX||t.pageX:50)-25,onSelect:function(t){i.menuClick(e,parseInt(t.index),t.originalEvent)}}),i.trigger($.extend(r,{phase:"after"}))))},150)},menuClick:function(e,t,i){var s=this,r=s.trigger({phase:"before",type:"menuClick",target:e,originalEvent:i,menuIndex:t,menuItem:s.menu[t]});r.isCancelled!==!0&&s.trigger($.extend(r,{phase:"after"}))},render:function(e){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"render",target:this.name,box:e});return i.isCancelled!==!0&&("undefined"!=typeof e&&null!==e&&($(this.box).find("> div > div.w2ui-sidebar-div").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),this.box=e),this.box)?($(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-sidebar").html('<div><div class="w2ui-sidebar-top"></div><div class="w2ui-sidebar-div"></div><div class="w2ui-sidebar-bottom"></div></div>'),$(this.box).find("> div").css({width:$(this.box).width()+"px",height:$(this.box).height()+"px"}),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),""!==this.topHTML&&($(this.box).find(".w2ui-sidebar-top").html(this.topHTML),$(this.box).find(".w2ui-sidebar-div").css("top",$(this.box).find(".w2ui-sidebar-top").height()+"px")),""!==this.bottomHTML&&($(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),$(this.box).find(".w2ui-sidebar-div").css("bottom",$(this.box).find(".w2ui-sidebar-bottom").height()+"px")),this.trigger($.extend(i,{phase:"after"})),this.refresh(),(new Date).getTime()-t):void 0},refresh:function(e){function u(e){var t="",i=e.img;null===i&&(i=this.img);var r=e.icon;null===r&&(r=this.icon);for(var n=e.parent,a=0;n&&null!==n.parent;)n.group&&a--,n=n.parent,a++;if("undefined"!=typeof e.caption&&(e.text=e.caption),e.group)t='<div class="w2ui-node-group"  id="node_'+e.id+'"        onclick="w2ui[\''+s.name+"'].toggle('"+e.id+"')\"        onmouseout=\"$(this).find('span:nth-child(1)').css('color', 'transparent')\"         onmouseover=\"$(this).find('span:nth-child(1)').css('color', 'inherit')\">"+(e.groupShowHide?"<span>"+w2utils.lang(!e.hidden&&e.expanded?"Hide":"Show")+"</span>":"<span></span>")+"    <span>"+e.text+'</span></div><div class="w2ui-node-sub" id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>';else{if(e.selected&&!e.disabled&&(s.selected=e.id),n="",i&&(n='<div class="w2ui-node-image w2ui-icon '+i+(e.selected&&!e.disabled?" w2ui-icon-selected":"")+'"></div>'),r&&(n='<div class="w2ui-node-image"><span class="'+r+'"></span></div>'),e.gClickable)var o='<td  class="w2ui-expand-check-td w2ui-node-dots" nowrap ><input id=gcheck_node_'+e.id+" onchange=\"w2ui['"+s.name+"'].ItemChecked(event);\" "+(e.panischecked?"checked":"")+' class="w2ui-expand-check w2ui-node-dots" type="checkbox"></td>';else e.panischecked=!0,o="";t="<div "+(e.hint?'title="'+e.hint+'"':"")+' class="w2ui-node '+(e.selected?"w2ui-selected":"")+" "+(e.disabled?"w2ui-disabled":"")+'" id="node_'+e.id+'" style="'+(e.hidden?"display: none;":"")+'"    ondblclick="w2ui[\''+s.name+"'].dblClick('"+e.id+"', event);\"    oncontextmenu=\"w2ui['"+s.name+"'].contextMenu('"+e.id+"', event);         if (event.preventDefault) event.preventDefault();\"    onClick=\"w2ui['"+s.name+"'].click('"+e.id+'\', event); "><table cellpadding="0" cellspacing="0" style="margin-left:'+18*a+"px; padding-right:"+18*a+'px"><tr><td class="w2ui-node-dots" nowrap onclick="w2ui[\''+s.name+"'].toggle('"+e.id+'\');         if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">    <div class="w2ui-expand">'+(e.nodes.length>0?e.expanded?"-":"+":e.plus?"+":"")+"</div></td>"+o+'<td class="w2ui-node-data" nowrap>'+n+(e.count||0===e.count?'<div class="w2ui-node-count">'+e.count+"</div>":"")+'<div class="w2ui-node-caption">'+e.text+'</div></td></tr></table></div><div class="w2ui-node-sub" id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>'}return t}var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"refresh",target:"undefined"!=typeof e?e:this.name});if(i.isCancelled!==!0){""!==this.topHTML&&($(this.box).find(".w2ui-sidebar-top").html(this.topHTML),$(this.box).find(".w2ui-sidebar-div").css("top",$(this.box).find(".w2ui-sidebar-top").height()+"px")),""!==this.bottomHTML&&($(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),$(this.box).find(".w2ui-sidebar-div").css("bottom",$(this.box).find(".w2ui-sidebar-bottom").height()+"px")),$(this.box).find("> div").css({width:$(this.box).width()+"px",height:$(this.box).height()+"px"});var r,n,a,s=this;if("undefined"==typeof e)r=this,a=".w2ui-sidebar-div";else{if(r=this.get(e),null===r)return;a="#node_"+w2utils.escapeId(r.id)+"_sub"}var o;if(r!==this){var l="#node_"+w2utils.escapeId(r.id);o=u(r),$(this.box).find(l).before('<div id="sidebar_'+this.name+'_tmp"></div>'),$(this.box).find(l).remove(),$(this.box).find(a).remove(),$("#sidebar_"+this.name+"_tmp").before(o),$("#sidebar_"+this.name+"_tmp").remove()}$(this.box).find(a).html("");for(var d=0;d<r.nodes.length;d++)n=r.nodes[d],o=u(n),$(this.box).find(a).append(o),0!==n.nodes.length&&this.refresh(n.id);return this.trigger($.extend(i,{phase:"after"})),(new Date).getTime()-t}},resize:function(){var e=(new Date).getTime(),t=this.trigger({phase:"before",type:"resize",target:this.name});return t.isCancelled!==!0?($(this.box).css("overflow","hidden"),$(this.box).find("> div").css({width:$(this.box).width()+"px",height:$(this.box).height()+"px"}),this.trigger($.extend(t,{phase:"after"})),(new Date).getTime()-e):void 0},destroy:function(){var e=this.trigger({phase:"before",type:"destroy",target:this.name});e.isCancelled!==!0&&($(this.box).find("> div > div.w2ui-sidebar-div").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})))},lock:function(){var i=$(this.box).find("> div:first-child"),s=Array.prototype.slice.call(arguments,0);s.unshift(i),w2utils.lock.apply(window,s)},unlock:function(){w2utils.unlock(this.box)}},$.extend(e.prototype,w2utils.event),w2obj.sidebar=e}(),function(e){var t=function(t){this.el=null,this.helpers={},this.type=t.type||"text",this.options=e.extend(!0,{},t),this.onSearch=t.onSearch||null,this.onRequest=t.onRequest||null,this.onLoad=t.onLoad||null,this.onError=t.onError||null,this.onClick=t.onClick||null,this.onAdd=t.onAdd||null,this.onNew=t.onNew||null,this.onRemove=t.onRemove||null,this.onMouseOver=t.onMouseOver||null,this.onMouseOut=t.onMouseOut||null,this.onIconClick=t.onIconClick||null,this.tmp={},delete this.options.type,delete this.options.onSearch,delete this.options.onRequest,delete this.options.onLoad,delete this.options.onError,delete this.options.onClick,delete this.options.onMouseOver,delete this.options.onMouseOut,delete this.options.onIconClick,e.extend(!0,this,w2obj.field)};e.fn.w2field=function(i,s){if(0!=this.length){if(0==arguments.length){var n=e(this).data("w2field");return n}return"string"==typeof i&&"object"==typeof s&&(i=e.extend(!0,{},s,{type:i})),"string"==typeof i&&"undefined"==typeof s&&(i={type:i}),i.type=String(i.type).toLowerCase(),this.each(function(s,r){var n=e(r).data("w2field");if("undefined"==typeof n){var n=new t(i);return e.extend(n,{handlers:[]}),r&&(n.el=e(r)[0]),n.init(),e(r).data("w2field",n),n}if(n.clear(),"clear"!=i.type){var n=new t(i);return e.extend(n,{handlers:[]}),r&&(n.el=e(r)[0]),n.init(),e(r).data("w2field",n),n}})}var r=t.prototype;return r[i]?r[i].apply(r,Array.prototype.slice.call(arguments,1)):void 0},t.prototype={custom:{},pallete:[["000000","444444","666666","999999","CCCCCC","EEEEEE","F3F3F3","FFFFFF"],["FF011B","FF9838","FFFD59","01FD55","00FFFE","0424F3","9B24F4","FF21F5"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D1E9","EAD1DC"],["EA9899","F9CB9C","FEE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD"],["E06666","F6B26B","FED966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BA0"],["CC0814","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A54D79"],["99050C","B45F17","BF901F","37761D","124F5C","0A5394","351C75","741B47"],["660205","783F0B","7F6011","274E12","0C343D","063762","20124D","4C1030"]],addType:function(e,t){return e=String(e).toLowerCase(),this.custom[e]=t,!0},removeType:function(e){return e=String(e).toLowerCase(),this.custom[e]?(delete this.custom[e],!0):!1},init:function(){var s,t=this,i=this.options;if("function"==typeof this.custom[this.type])return void this.custom[this.type].call(this,i);if(-1==["INPUT","TEXTAREA"].indexOf(this.el.tagName))return void console.log("ERROR: w2field could only be applied to INPUT or TEXTAREA.",this.el);switch(this.type){case"text":case"int":case"float":case"money":case"currency":case"percent":case"alphanumeric":case"hex":s={min:null,max:null,step:1,placeholder:"",autoFormat:!0,currencyPrefix:w2utils.settings.currencyPrefix,currencySuffix:w2utils.settings.currencySuffix,currencyPrecision:w2utils.settings.currencyPrecision,decimalSymbol:w2utils.settings.decimalSymbol,groupSymbol:w2utils.settings.groupSymbol,arrows:!1,keyboard:!0,precision:null,silent:!0,prefix:"",suffix:""},this.options=e.extend(!0,{},s,i),i=this.options,i.numberRE=new RegExp("["+i.groupSymbol+"]","g"),i.moneyRE=new RegExp("["+i.currencyPrefix+i.currencySuffix+i.groupSymbol+"]","g"),i.percentRE=new RegExp("["+i.groupSymbol+"%]","g"),-1!=["text","alphanumeric","hex"].indexOf(this.type)&&(i.arrows=!1,i.keyboard=!1),this.addPrefix(),this.addSuffix(),e(this.el).attr("placeholder")&&""==i.placeholder&&(i.placeholder=e(this.el).attr("placeholder")),e(this.el).attr("placeholder",i.placeholder);break;case"color":s={prefix:"#",suffix:'<div style="width: '+(parseInt(e(this.el).css("font-size"))||12)+'px">&nbsp;</div>',placeholder:"",arrows:!1,keyboard:!1},e.extend(i,s),this.addPrefix(),this.addSuffix(),e(this.el).attr("maxlength",6),""!=e(this.el).val()&&setTimeout(function(){e(t.el).change()},1),e(this.el).attr("placeholder")&&""==i.placeholder&&(i.placeholder=e(this.el).attr("placeholder")),e(this.el).attr("placeholder",i.placeholder);break;case"date":s={format:w2utils.settings.date_format,placeholder:"",keyboard:!0,silent:!0,start:"",end:"",blocked:{},colored:{}},this.options=e.extend(!0,{},s,i),i=this.options,e(this.el).attr("placeholder")&&""==i.placeholder&&(i.placeholder=e(this.el).attr("placeholder")),e(this.el).attr("placeholder",i.placeholder?i.placeholder:i.format);break;case"time":s={format:w2utils.settings.time_format,placeholder:"",keyboard:!0,silent:!0,start:"",end:""},this.options=e.extend(!0,{},s,i),i=this.options,e(this.el).attr("placeholder")&&""==i.placeholder&&(i.placeholder=e(this.el).attr("placeholder")),e(this.el).attr("placeholder",i.placeholder?i.placeholder:"h12"==i.format?"hh:mi pm":"hh:mi");break;case"datetime":break;case"list":case"combo":if(s={items:[],selected:{},placeholder:"",url:null,postData:{},minLength:1,cacheMax:250,maxDropHeight:350,match:"begins",silent:!0,icon:null,iconStyle:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onIconClick:null,renderDrop:null,prefix:"",suffix:"",openOnFocus:!1,markSearch:!1},i.items=this.normMenu(i.items),"list"==this.type&&(s.openOnFocus=!0,s.suffix='<div class="arrow-down" style="margin-top: '+(parseInt(e(this.el).height())-6)/2+'px;"></div>',e(this.el).addClass("w2ui-select"),!e.isPlainObject(i.selected)))for(var r in i.items){var n=i.items[r];if(n&&n.id==i.selected){i.selected=e.extend(!0,{},n);break}}i=e.extend({},s,i,{align:"both",altRows:!0}),this.options=i,e.isPlainObject(i.selected)||(i.selected={}),e(this.el).data("selected",i.selected),i.url&&this.request(0),"list"==this.type&&this.addFocus(),this.addPrefix(),this.addSuffix(),setTimeout(function(){t.refresh()},10),e(this.el).attr("placeholder")&&""==i.placeholder&&(i.placeholder=e(this.el).attr("placeholder")),e(this.el).attr("placeholder",i.placeholder).attr("autocomplete","off"),"undefined"!=typeof i.selected.text&&e(this.el).val(i.selected.text);break;case"enum":s={items:[],selected:[],placeholder:"",max:0,url:null,postData:{},minLength:1,cacheMax:250,maxWidth:250,maxHeight:350,maxDropHeight:350,match:"contains",silent:!0,openOnFocus:!1,markSearch:!0,renderDrop:null,renderItem:null,style:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onClick:null,onAdd:null,onNew:null,onRemove:null,onMouseOver:null,onMouseOut:null},i=e.extend({},s,i,{align:"both",suffix:"",altRows:!0}),i.items=this.normMenu(i.items),i.selected=this.normMenu(i.selected),this.options=i,e.isArray(i.selected)||(i.selected=[]),e(this.el).data("selected",i.selected),i.url&&this.request(0),this.addSuffix(),this.addMulti();break;case"file":s={selected:[],placeholder:w2utils.lang("Attach files by dragging and dropping or Click to Select"),max:0,maxSize:0,maxFileSize:0,maxWidth:250,maxHeight:350,maxDropHeight:350,silent:!0,renderItem:null,style:"",onClick:null,onAdd:null,onRemove:null,onMouseOver:null,onMouseOut:null},i=e.extend({},s,i,{align:"both",altRows:!0}),this.options=i,e.isArray(i.selected)||(i.selected=[]),e(this.el).data("selected",i.selected),e(this.el).attr("placeholder")&&(i.placeholder=e(this.el).attr("placeholder")),this.addMulti()}this.tmp={onChange:function(e){t.change.call(t,e)},onClick:function(e){t.click.call(t,e)},onFocus:function(e){t.focus.call(t,e)},onBlur:function(e){t.blur.call(t,e)},onKeydown:function(e){t.keyDown.call(t,e)},onKeyup:function(e){t.keyUp.call(t,e)},onKeypress:function(e){t.keyPress.call(t,e)}},e(this.el).addClass("w2field").data("w2field",this).on("change",this.tmp.onChange).on("click",this.tmp.onClick).on("focus",this.tmp.onFocus).on("blur",this.tmp.onBlur).on("keydown",this.tmp.onKeydown).on("keyup",this.tmp.onKeyup).on("keypress",this.tmp.onKeypress).css({"box-sizing":"border-box","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","-ms-box-sizing":"border-box","-o-box-sizing":"border-box"}),this.change(e.Event("change"))},clear:function(){var i=this.options;-1!=["money","currency"].indexOf(this.type)&&e(this.el).val(e(this.el).val().replace(i.moneyRE,"")),"percent"==this.type&&e(this.el).val(e(this.el).val().replace(/%/g,"")),"color"==this.type&&e(this.el).removeAttr("maxlength"),"list"==this.type&&e(this.el).removeClass("w2ui-select"),-1!=["date","time"].indexOf(this.type)&&e(this.el).attr("placeholder")==i.format&&e(this.el).attr("placeholder",""),this.type="clear";var s=e(this.el).data("tmp");if(this.tmp){"undefined"!=typeof s&&(s&&s["old-padding-left"]&&e(this.el).css("padding-left",s["old-padding-left"]),s&&s["old-padding-right"]&&e(this.el).css("padding-right",s["old-padding-right"])),e(this.el).val(this.clean(e(this.el).val())).removeClass("w2field").removeData().off("change",this.tmp.onChange).off("click",this.tmp.onClick).off("focus",this.tmp.onFocus).off("blur",this.tmp.onBlur).off("keydown",this.tmp.onKeydown).off("keyup",this.tmp.onKeyup).off("keypress",this.tmp.onKeypress);for(var r in this.helpers)e(this.helpers[r]).remove();this.helpers={}}},refresh:function(){var t=this,i=this.options,s=e(this.el).data("selected"),r=(new Date).getTime();if(-1!=["list"].indexOf(this.type)&&(e(t.el).parent().css("white-space","nowrap"),t.helpers.prefix&&t.helpers.prefix.hide(),setTimeout(function(){if(t.helpers.focus){!e.isEmptyObject(s)&&i.icon?(i.prefix='<span class="w2ui-icon '+i.icon+'"style="cursor: pointer; font-size: 14px; display: inline-block; margin-top: -1px; color: #7F98AD;'+i.iconStyle+'"></span>',t.addPrefix()):(i.prefix="",t.addPrefix());var r=t.helpers.focus.find("input");""==e(r).val()?(e(r).css("opacity",0).prev().css("opacity",0),e(t.el).val(s&&null!=s.text?s.text:""),e(t.el).attr("placeholder",i.placeholder||"")):(e(r).css("opacity",1).prev().css("opacity",1),e(t.el).val(""),e(t.el).removeAttr("placeholder"),setTimeout(function(){t.helpers.prefix&&t.helpers.prefix.hide();var s="position: absolute; opacity: 0; margin: 4px 0px 0px 2px; background-position: left !important;";i.icon?(e(r).css("margin-left","17px"),e(t.helpers.focus).find(".icon-search").attr("style",s+"width: 11px !important; opacity: 1")):(e(r).css("margin-left","0px"),e(t.helpers.focus).find(".icon-search").attr("style",s+"width: 0px !important; opacity: 0"))},1)),e(t.el).prop("readonly")||e(t.el).prop("disabled")?setTimeout(function(){e(t.helpers.prefix).css("opacity","0.6"),e(t.helpers.suffix).css("opacity","0.6")},1):setTimeout(function(){e(t.helpers.prefix).css("opacity","1"),e(t.helpers.suffix).css("opacity","1")},1)}},1)),-1!=["enum","file"].indexOf(this.type)){var n="";for(var a in s){var o=s[a],l="";l="function"==typeof i.renderItem?i.renderItem(o,a,'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+a+'">&nbsp;&nbsp;</div>'):'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+a+'">&nbsp;&nbsp;</div>'+("enum"==t.type?o.text:o.name+'<span class="file-size"> - '+w2utils.size(o.size)+"</span>"),n+='<li index="'+a+'" style="max-width: '+parseInt(i.maxWidth)+"px; "+(o.style?o.style:"")+'">'+l+"</li>"}var d=t.helpers.multi,u=d.find("ul");if(d.attr("style",d.attr("style")+";"+i.style),e(t.el).prop("readonly")||e(t.el).prop("disabled")?(d.addClass("w2ui-readonly"),d.css("pointer-events","none").find("li").css("opacity","0.6"),e(t.helpers.multi).find("input").prop("readonly",!0)):(d.removeClass("w2ui-readonly"),d.css("pointer-events","auto").find("li").css("opacity","1"),e(t.helpers.multi).find("input").prop("readonly",!1)),d.find(".w2ui-enum-placeholder").remove(),u.find("li").not("li.nomouse").remove(),""!=n)u.prepend(n);else if("undefined"!=typeof i.placeholder){var h="padding-top: "+e(this.el).css("padding-top")+";padding-left: "+e(this.el).css("padding-left")+"; box-sizing: "+e(this.el).css("box-sizing")+"; line-height: "+e(this.el).css("line-height")+"; font-size: "+e(this.el).css("font-size")+"; font-family: "+e(this.el).css("font-family")+"; ";d.prepend('<div class="w2ui-enum-placeholder" style="'+h+'">'+i.placeholder+"</div>")}d.find("li").data("mouse","out").on("click",function(i){var r=s[e(i.target).attr("index")];if(!e(i.target).hasClass("nomouse")){i.stopPropagation();var n=t.trigger({phase:"before",type:"click",target:t.el,originalEvent:i.originalEvent,item:r});if(n.isCancelled!==!0){if(e(i.target).hasClass("w2ui-list-remove")){if(e(t.el).attr("readonly")||e(t.el).attr("disabled"))return;var n=t.trigger({phase:"before",type:"remove",target:t.el,originalEvent:i.originalEvent,item:r});if(n.isCancelled===!0)return;e().w2overlay(),s.splice(e(i.target).attr("index"),1),e(t.el).trigger("change"),e(i.target).parent().fadeOut("fast"),setTimeout(function(){t.refresh(),t.trigger(e.extend(n,{phase:"after"}))},300)}if("file"==t.type&&!e(i.target).hasClass("w2ui-list-remove")){var a="";/image/i.test(r.type)&&(a='<div style="padding: 3px;">    <img src="'+(r.content?"data:"+r.type+";base64,"+r.content:"")+'" style="max-width: 300px;"         onload="var w = $(this).width(); var h = $(this).height();             if (w < 300 & h < 300) return;             if (w >= h && w > 300) $(this).width(300);            if (w < h && h > 300) $(this).height(300);"        onerror="this.style.display = \'none\'"    ></div>');var o='style="padding: 3px; text-align: right; color: #777;"',l='style="padding: 3px"';a+='<div style="padding: 8px;">    <table cellpadding="2">    <tr><td '+o+">"+w2utils.lang("Name")+":</td><td "+l+">"+r.name+"</td></tr>    <tr><td "+o+">"+w2utils.lang("Size")+":</td><td "+l+">"+w2utils.size(r.size)+"</td></tr>    <tr><td "+o+">"+w2utils.lang("Type")+":</td><td "+l+'>        <span style="width: 200px; display: block-inline; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">'+r.type+"</span>    </td></tr>    <tr><td "+o+">"+w2utils.lang("Modified")+":</td><td "+l+">"+w2utils.date(r.modified)+"</td></tr>    </table></div>",e(i.target).w2overlay(a)}t.trigger(e.extend(n,{phase:"after"}))}}}).on("mouseover",function(i){var r=i.target;if("LI"!=r.tagName&&(r=r.parentNode),!e(r).hasClass("nomouse")){if("out"==e(r).data("mouse")){var n=s[e(r).attr("index")],a=t.trigger({phase:"before",type:"mouseOver",target:t.el,originalEvent:i.originalEvent,item:n});if(a.isCancelled===!0)return;t.trigger(e.extend(a,{phase:"after"}))}e(r).data("mouse","over")}}).on("mouseout",function(i){var r=i.target;"LI"!=r.tagName&&(r=r.parentNode),e(r).hasClass("nomouse")||(e(r).data("mouse","leaving"),setTimeout(function(){if("leaving"==e(r).data("mouse")){e(r).data("mouse","out");var n=s[e(r).attr("index")],a=t.trigger({phase:"before",type:"f",target:t.el,originalEvent:i.originalEvent,item:n});if(a.isCancelled===!0)return;t.trigger(e.extend(a,{phase:"after"}))}},0))}),e(this.el).height("auto");var f=e(d).find("> div").height()+2*w2utils.getSize(d,"+height");26>f&&(f=26),f>i.maxHeight&&(f=i.maxHeight),d.length>0&&(d[0].scrollTop=1e3);var c=w2utils.getSize(e(this.el),"height")-2;c>f&&(f=c),e(d).css({height:f+"px",overflow:f==i.maxHeight?"auto":"hidden"}),f<i.maxHeight&&e(d).prop("scrollTop",0),e(this.el).css({height:f+2+"px"})}return(new Date).getTime()-r},reset:function(){var t=this.type;this.clear(),this.type=t,this.init()},clean:function(t){var i=this.options;return t=String(t).trim(),-1!=["int","float","money","currency","percent"].indexOf(this.type)&&("string"==typeof t&&(t=t.replace(i.decimalSymbol,".")),i.autoFormat&&-1!=["money","currency"].indexOf(this.type)&&(t=String(t).replace(i.moneyRE,"")),i.autoFormat&&"percent"==this.type&&(t=String(t).replace(i.percentRE,"")),i.autoFormat&&-1!=["int","float"].indexOf(this.type)&&(t=String(t).replace(i.numberRE,"")),parseFloat(t)==t&&(null!==i.min&&t<i.min&&(t=i.min,e(this.el).val(i.min)),null!==i.max&&t>i.max&&(t=i.max,e(this.el).val(i.max))),t=""!==t&&w2utils.isFloat(t)?Number(t):""),t},format:function(e){var t=this.options;if(t.autoFormat&&""!=e)switch(this.type){case"money":case"currency":e=w2utils.formatNumber(Number(e).toFixed(t.currencyPrecision),t.groupSymbol),""!=e&&(e=t.currencyPrefix+e+t.currencySuffix);break;case"percent":e=w2utils.formatNumber(t.precision?Number(e).toFixed(t.precision):e,t.groupSymbol),""!=e&&(e+="%");break;case"float":e=w2utils.formatNumber(t.precision?Number(e).toFixed(t.precision):e,t.groupSymbol);break;case"int":e=w2utils.formatNumber(e,t.groupSymbol)}return e},change:function(t){var i=this,s=i.options;if(-1!=["int","float","money","currency","percent"].indexOf(this.type)){var r=e(this.el).val(),n=this.format(this.clean(e(this.el).val()));if(""!=r&&r!=n)return e(this.el).val(n).change(),t.stopPropagation(),t.preventDefault(),!1}if("color"==this.type){var a="#"+e(this.el).val();6!=e(this.el).val().length&&3!=e(this.el).val().length&&(a=""),e(this.el).next().find("div").css("background-color",a),e(i.el).is(":focus")&&this.updateOverlay()}if(-1!=["list","enum","file"].indexOf(this.type)&&(i.refresh(),setTimeout(function(){i.refresh()},5)),-1!=["date","time"].indexOf(this.type)){var o=parseInt(i.el.value);w2utils.isInt(o)&&o>1e3&&("time"==this.type&&e(i.el).val(w2utils.formatTime(new Date(o),s.format)).change(),"date"==this.type&&e(i.el).val(w2utils.formatDate(new Date(o),s.format)).change())}},click:function(t){t.stopPropagation(),-1!=["list","combo","enum"].indexOf(this.type)&&(e(this.el).is(":focus")||this.focus(t)),-1!=["date","time","color"].indexOf(this.type)&&this.updateOverlay()},focus:function(){{var i=this;this.options}if(-1!==["color","date","time"].indexOf(i.type)){if(e(i.el).attr("readonly")||e(i.el).attr("disabled"))return;e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),setTimeout(function(){i.updateOverlay()},150)}if(-1!=["list","combo","enum"].indexOf(i.type)){if(e(i.el).attr("readonly")||e(i.el).attr("disabled"))return;e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),setTimeout(function(){return"list"==i.type&&e(i.el).is(":focus")?void e(i.helpers.focus).find("input").focus():(i.search(),void setTimeout(function(){i.updateOverlay()},1))},1)}"file"==i.type&&e(i.helpers.multi).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"})},blur:function(){var i=this,s=i.options,r=e(i.el).val().trim();-1!=["color","date","time","list","combo","enum"].indexOf(i.type)&&e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),-1!=["int","float","money","currency","percent"].indexOf(i.type)&&(""===r||i.checkType(r)||(e(i.el).val("").change(),s.silent===!1&&(e(i.el).w2tag("Not a valid number"),setTimeout(function(){e(i.el).w2tag("")},3e3)))),-1!=["date","time"].indexOf(i.type)&&(""===r||i.inRange(i.el.value)?("date"!=i.type||""===r||w2utils.isDate(i.el.value,s.format)||(e(i.el).val("").removeData("selected").change(),s.silent===!1&&(e(i.el).w2tag("Not a valid date"),setTimeout(function(){e(i.el).w2tag("")},3e3))),"time"!=i.type||""===r||w2utils.isTime(i.el.value)||(e(i.el).val("").removeData("selected").change(),s.silent===!1&&(e(i.el).w2tag("Not a valid time"),setTimeout(function(){e(i.el).w2tag("")},3e3)))):(e(i.el).val("").removeData("selected").change(),s.silent===!1&&(e(i.el).w2tag("Not in range"),setTimeout(function(){e(i.el).w2tag("")},3e3)))),"enum"==i.type&&e(i.helpers.multi).find("input").val("").width(20),"file"==i.type&&e(i.helpers.multi).css({outline:"none"})},keyPress:function(e){{var t=this;t.options}if(-1!=["int","float","money","currency","percent","hex","color","alphanumeric"].indexOf(t.type)){if(e.metaKey||e.ctrlKey||e.altKey||e.charCode!=e.keyCode&&e.keyCode>0)return;var s=String.fromCharCode(e.charCode);if(!t.checkType(s,!0)&&13!=e.keyCode)return e.preventDefault(),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1}-1!=["date","time"].indexOf(t.type)&&setTimeout(function(){t.updateOverlay()},1)},keyDown:function(t,i){var s=this,r=s.options,n=t.keyCode||i&&i.keyCode;if(-1!=["int","float","money","currency","percent"].indexOf(s.type)){if(!r.keyboard||e(s.el).attr("readonly"))return;var a=!1,o=parseFloat(e(s.el).val().replace(r.moneyRE,""))||0,l=r.step;switch((t.ctrlKey||t.metaKey)&&(l=10),n){case 38:if(t.shiftKey)break;e(s.el).val(o+l<=r.max||null===r.max?Number((o+l).toFixed(12)):r.max).change(),a=!0;break;case 40:if(t.shiftKey)break;e(s.el).val(o-l>=r.min||null===r.min?Number((o-l).toFixed(12)):r.min).change(),a=!0}a&&(t.preventDefault(),setTimeout(function(){s.el.setSelectionRange(s.el.value.length,s.el.value.length)},0))}if("date"==s.type){if(!r.keyboard||e(s.el).attr("readonly"))return;var a=!1,d=864e5,l=1;(t.ctrlKey||t.metaKey)&&(l=10);var u=w2utils.isDate(e(s.el).val(),r.format,!0);switch(u||(u=new Date,d=0),n){case 38:if(t.shiftKey)break;var h=w2utils.formatDate(u.getTime()+d,r.format);10==l&&(h=w2utils.formatDate(new Date(u.getFullYear(),u.getMonth()+1,u.getDate()),r.format)),e(s.el).val(h).change(),a=!0;break;case 40:if(t.shiftKey)break;var h=w2utils.formatDate(u.getTime()-d,r.format);10==l&&(h=w2utils.formatDate(new Date(u.getFullYear(),u.getMonth()-1,u.getDate()),r.format)),e(s.el).val(h).change(),a=!0}a&&(t.preventDefault(),setTimeout(function(){s.el.setSelectionRange(s.el.value.length,s.el.value.length),s.updateOverlay()},0))}if("time"==s.type){if(!r.keyboard||e(s.el).attr("readonly"))return;var a=!1,l=t.ctrlKey||t.metaKey?60:1,o=e(s.el).val(),f=s.toMin(o)||s.toMin((new Date).getHours()+":"+((new Date).getMinutes()-1));switch(n){case 38:if(t.shiftKey)break;f+=l,a=!0;break;case 40:if(t.shiftKey)break;f-=l,a=!0}a&&(e(s.el).val(s.fromMin(f)).change(),t.preventDefault(),setTimeout(function(){s.el.setSelectionRange(s.el.value.length,s.el.value.length)},0))}if("color"==s.type){if(e(s.el).attr("readonly"))return;if(86==t.keyCode&&(t.ctrlKey||t.metaKey)&&(e(s.el).prop("maxlength",7),setTimeout(function(){var t=e(s).val();"#"==t.substr(0,1)&&(t=t.substr(1)),w2utils.isHex(t)||(t=""),e(s).val(t).prop("maxlength",6).change()},20)),(t.ctrlKey||t.metaKey)&&!t.shiftKey){if("undefined"==typeof s.tmp.cind1)s.tmp.cind1=-1,s.tmp.cind2=-1;
else{switch(n){case 38:s.tmp.cind1--;break;case 40:s.tmp.cind1++;break;case 39:s.tmp.cind2++;break;case 37:s.tmp.cind2--}s.tmp.cind1<0&&(s.tmp.cind1=0),s.tmp.cind1>this.pallete.length-1&&(s.tmp.cind1=this.pallete.length-1),s.tmp.cind2<0&&(s.tmp.cind2=0),s.tmp.cind2>this.pallete[0].length-1&&(s.tmp.cind2=this.pallete[0].length-1)}-1!=[37,38,39,40].indexOf(n)&&(e(s.el).val(this.pallete[s.tmp.cind1][s.tmp.cind2]).change(),t.preventDefault())}}if(-1!=["list","combo","enum"].indexOf(s.type)){if(e(s.el).attr("readonly"))return;var a=!1,c=e(s.el).data("selected"),p=e(s.helpers.focus).find("input");switch("list"==s.type&&-1==[37,38,39,40].indexOf(n)&&s.refresh(),n){case 27:"list"==s.type&&(""!=e(p).val()&&e(p).val(""),t.stopPropagation());break;case 37:case 39:break;case 13:if(0==e("#w2ui-overlay").length)break;var g=r.items[r.index],m=e(s.helpers.multi).find("input");if("enum"==s.type)if(null!=g){var v=s.trigger({phase:"before",type:"add",target:s.el,originalEvent:t.originalEvent,item:g});if(v.isCancelled===!0)return;g=v.item,c.length>=r.max&&r.max>0&&c.pop(),delete g.hidden,delete s.tmp.force_open,c.push(g),e(s.el).change(),m.val("").width(20),s.refresh(),s.trigger(e.extend(v,{phase:"after"}))}else{g={id:m.val(),text:m.val()};var v=s.trigger({phase:"before",type:"new",target:s.el,originalEvent:t.originalEvent,item:g});if(v.isCancelled===!0)return;g=v.item,"function"==typeof s.onNew&&(c.length>=r.max&&r.max>0&&c.pop(),delete s.tmp.force_open,c.push(g),e(s.el).change(),m.val("").width(20),s.refresh()),s.trigger(e.extend(v,{phase:"after"}))}else g&&e(s.el).data("selected",g).val(g.text).change(),""==e(s.el).val()&&e(s.el).data("selected")&&e(s.el).removeData("selected").val("").change(),"list"==s.type&&(p.val(""),s.refresh()),s.tmp.force_hide=!0;break;case 8:case 46:if("enum"==s.type&&8==n&&""==e(s.helpers.multi).find("input").val()&&c.length>0){var g=c[c.length-1],v=s.trigger({phase:"before",type:"remove",target:s.el,originalEvent:t.originalEvent,item:g});if(v.isCancelled===!0)return;c.pop(),e(s.el).trigger("change"),s.refresh(),s.trigger(e.extend(v,{phase:"after"}))}"list"==s.type&&""==e(p).val()&&(e(s.el).data("selected",{}).change(),s.refresh());break;case 38:for(r.index=w2utils.isInt(r.index)?parseInt(r.index):0,r.index--;r.index>0&&r.items[r.index].hidden;)r.index--;if(0==r.index&&r.items[r.index].hidden)for(;r.items[r.index]&&r.items[r.index].hidden;)r.index++;a=!0;break;case 40:for(r.index=w2utils.isInt(r.index)?parseInt(r.index):-1,r.index++;r.index<r.items.length-1&&r.items[r.index].hidden;)r.index++;if(r.index==r.items.length-1&&r.items[r.index].hidden)for(;r.items[r.index]&&r.items[r.index].hidden;)r.index--;var w=s.el;-1!=["enum"].indexOf(s.type)&&(w=s.helpers.multi.find("input")),""==e(w).val()&&0==e("#w2ui-overlay").length?s.tmp.force_open=!0:a=!0}if(a)return r.index<0&&(r.index=0),r.index>=r.items.length&&(r.index=r.items.length-1),s.updateOverlay(),t.preventDefault(),void setTimeout(function(){if("enum"==s.type){var e=s.helpers.multi.find("input").get(0);e.setSelectionRange(e.value.length,e.value.length)}else if("list"==s.type){var e=s.helpers.focus.find("input").get(0);e.setSelectionRange(e.value.length,e.value.length)}else s.el.setSelectionRange(s.el.value.length,s.el.value.length)},0);if("enum"==s.type){var w=s.helpers.multi.find("input"),y=w.val();w.width(8*(y.length+2)+"px")}-1==[16,17,18,20,37,39,91].indexOf(n)&&setTimeout(function(){s.tmp.force_hide||s.request(),s.search()},1)}},keyUp:function(t){"color"==this.type&&86==t.keyCode&&(t.ctrlKey||t.metaKey)&&e(this).prop("maxlength",6)},clearCache:function(){var e=this.options;e.items=[],this.tmp.xhr_loading=!1,this.tmp.xhr_search="",this.tmp.xhr_total=-1,this.search()},request:function(t){var i=this,s=this.options,r=e(i.el).val()||"";if(s.url){if("enum"==i.type){var n=e(i.helpers.multi).find("input");r=0==n.length?"":n.val()}if("list"==i.type){var n=e(i.helpers.focus).find("input");r=0==n.length?"":n.val()}if(0!=s.minLength&&r.length<s.minLength)return s.items=[],void this.updateOverlay();"undefined"==typeof t&&(t=350),"undefined"==typeof i.tmp.xhr_search&&(i.tmp.xhr_search=""),"undefined"==typeof i.tmp.xhr_total&&(i.tmp.xhr_total=-1),s.url&&1!=e(i.el).prop("readonly")&&(0===s.items.length&&0!==i.tmp.xhr_total||i.tmp.xhr_total==s.cacheMax&&r.length>i.tmp.xhr_search.length||r.length>=i.tmp.xhr_search.length&&r.substr(0,i.tmp.xhr_search.length)!=i.tmp.xhr_search||r.length<i.tmp.xhr_search.length)&&(i.tmp.xhr_loading=!0,i.search(),clearTimeout(i.tmp.timeout),i.tmp.timeout=setTimeout(function(){var t=s.url,n={search:r,max:s.cacheMax};e.extend(n,s.postData);var a=i.trigger({phase:"before",type:"request",target:i.el,url:t,postData:n});if(a.isCancelled!==!0){t=a.url,n=a.postData,i.tmp.xhr&&i.tmp.xhr.abort();var o={type:"GET",url:t,data:n,dataType:"JSON"};"JSON"==w2utils.settings.dataType&&(o.type="POST",o.data=JSON.stringify(o.data),o.contentType="application/json"),i.tmp.xhr=e.ajax(o).done(function(t,a,o){var l=i.trigger({phase:"before",type:"load",target:i.el,search:n.search,data:t,xhr:o});if(l.isCancelled!==!0){if(t=l.data,"string"==typeof t&&(t=JSON.parse(t)),"success"!=t.status)return void console.log("ERROR: server did not return proper structure. It should return",{status:"success",items:[{id:1,text:"item"}]});t.items.length>s.cacheMax&&t.items.splice(s.cacheMax,1e5),i.tmp.xhr_loading=!1,i.tmp.xhr_search=r,i.tmp.xhr_total=t.items.length,s.items=i.normMenu(t.items),i.tmp.emptySet=""==r&&0==t.items.length?!0:!1,i.search(),i.trigger(e.extend(l,{phase:"after"}))}}).fail(function(t,s,n){var a={status:s,error:n,rawResponseText:t.responseText},o=i.trigger({phase:"before",type:"error",target:i.el,search:r,error:a,xhr:t});if(o.isCancelled!==!0){if("abort"!=s){var l;try{l=e.parseJSON(t.responseText)}catch(d){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",items:[{id:1,text:"item"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof l?l:t.responseText)}i.clearCache(),i.trigger(e.extend(o,{phase:"after"}))}}),i.trigger(e.extend(a,{phase:"after"}))}},t))}},search:function(){var t=this,i=this.options,s=e(t.el).val(),r=t.el,n=[],a=e(t.el).data("selected");if("enum"==t.type){r=e(t.helpers.multi).find("input"),s=r.val();for(var o in a)a[o]&&n.push(a[o].id)}if("list"==t.type){r=e(t.helpers.focus).find("input"),s=r.val();for(var o in a)a[o]&&n.push(a[o].id)}var l=t.trigger({phase:"before",type:"search",target:r,search:s});if(l.isCancelled!==!0){if(t.tmp.xhr_loading!==!0){var d=0;for(var u in i.items){var h=i.items[u],f="",c="";-1!=["is","begins"].indexOf(i.match)&&(f="^"),-1!=["is","ends"].indexOf(i.match)&&(c="$");try{var p=new RegExp(f+s+c,"i");h.hidden=p.test(h.text)||"..."==h.text?!1:!0}catch(g){}"enum"==t.type&&-1!=e.inArray(h.id,n)&&(h.hidden=!0),h.hidden!==!0&&d++}if("combo"!=t.type)for(i.index=0;i.items[i.index]&&i.items[i.index].hidden;)i.index++;else i.index=-1;0>=d&&(i.index=-1),i.spinner=!1,t.updateOverlay(),setTimeout(function(){var t=e("#w2ui-overlay").html()||"";i.markSearch&&-1!=t.indexOf("$.fn.w2menuHandler")&&e("#w2ui-overlay").w2marker(s)},1)}else i.items.splice(0,i.cacheMax),i.spinner=!0,t.updateOverlay();t.trigger(e.extend(l,{phase:"after"}))}},updateOverlay:function(){var t=this,i=this.options;if("color"==this.type){if(e(t.el).attr("readonly"))return;0==e("#w2ui-overlay").length?e(t.el).w2overlay(t.getColorHTML()):e("#w2ui-overlay").html(t.getColorHTML()),e("#w2ui-overlay .color").on("mousedown",function(i){var s=e(i.originalEvent.target).attr("name"),r=e(i.originalEvent.target).attr("index").split(":");t.tmp.cind1=r[0],t.tmp.cind2=r[1],e(t.el).val(s).change(),e(this).html("&#149;")}).on("mouseup",function(){setTimeout(function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}if("date"==this.type){if(e(t.el).attr("readonly"))return;0==e("#w2ui-overlay").length&&e(t.el).w2overlay('<div class="w2ui-reset w2ui-calendar" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#f5f5f5"}});var s,r,n=w2utils.isDate(e(t.el).val(),t.options.format,!0);n&&(s=n.getMonth()+1,r=n.getFullYear()),function u(i,s){e("#w2ui-overlay > div > div").html(t.getMonthHTML(i,s)),e("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){if(e(this).next().hasClass("w2ui-calendar-jump"))e(this).next().remove();else{var i,s;e(this).after('<div class="w2ui-calendar-jump" style=""></div>'),e(this).next().hide().html(t.getYearHTML()).fadeIn(200),setTimeout(function(){e("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",function(){e(this).hasClass("w2ui-jump-month")&&(e(this).parent().find(".w2ui-jump-month").removeClass("selected"),e(this).addClass("selected"),s=e(this).attr("name")),e(this).hasClass("w2ui-jump-year")&&(e(this).parent().find(".w2ui-jump-year").removeClass("selected"),e(this).addClass("selected"),i=e(this).attr("name")),null!=i&&null!=s&&(e("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(function(){u(parseInt(s)+1,i)},100))}),e("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",2e3)},1)}}),e("#w2ui-overlay .w2ui-date").on("mousedown",function(){var i=e(this).attr("date");e(t.el).val(i).change(),e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"})}).on("mouseup",function(){setTimeout(function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)}),e("#w2ui-overlay .previous").on("mousedown",function(){var e=t.options.current.split("/");e[0]=parseInt(e[0])-1,u(e[0],e[1])}),e("#w2ui-overlay .next").on("mousedown",function(){var e=t.options.current.split("/");e[0]=parseInt(e[0])+1,u(e[0],e[1])})}(s,r)}if("time"==this.type){if(e(t.el).attr("readonly"))return;0==e("#w2ui-overlay").length&&e(t.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#fff"}});var a="h24"==this.options.format?!0:!1;e("#w2ui-overlay > div").html(t.getHourHTML()),e("#w2ui-overlay .w2ui-time").on("mousedown",function(){e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});var s=e(this).attr("hour");e(t.el).val((s>12&&!a?s-12:s)+":00"+(a?"":12>s?" am":" pm")).change()}).on("mouseup",function(){var i=e(this).attr("hour");e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),e(t.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),e("#w2ui-overlay > div").html(t.getMinHTML(i)),e("#w2ui-overlay .w2ui-time").on("mousedown",function(){e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});var s=e(this).attr("min");e(t.el).val((i>12&&!a?i-12:i)+":"+(10>s?0:"")+s+(a?"":12>i?" am":" pm")).change()}).on("mouseup",function(){setTimeout(function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})})}if(-1!=["list","combo","enum"].indexOf(this.type)){var o=this.el,l=this.el;if("enum"==this.type&&(o=e(this.helpers.multi),l=e(o).find("input")),"list"==this.type&&(l=e(this.helpers.focus).find("input")),e(l).is(":focus")){if(i.openOnFocus===!1&&""==e(l).val()&&t.tmp.force_open!==!0)return void e().w2overlay();if(t.tmp.force_hide)return e().w2overlay(),void setTimeout(function(){delete t.tmp.force_hide},1);""!=e(l).val()&&delete t.tmp.force_open,0==e("#w2ui-overlay").length&&(i.index=0);var d=w2utils.lang("No matches");null!=i.url&&e(l).val().length<i.minLength&&t.tmp.emptySet!==!0&&(d=i.minLength+" "+w2utils.lang("letters or more...")),null!=i.url&&""==e(l).val()&&t.tmp.emptySet!==!0&&(d=w2utils.lang("Type to search....")),e(o).w2menu("refresh",e.extend(!0,{},i,{search:!1,render:i.renderDrop,maxHeight:i.maxDropHeight,msgNoItems:d,onSelect:function(s){if("enum"==t.type){var r=e(t.el).data("selected");if(s.item){var n=t.trigger({phase:"before",type:"add",target:t.el,originalEvent:s.originalEvent,item:s.item});if(n.isCancelled===!0)return;r.length>=i.max&&i.max>0&&r.pop(),delete s.item.hidden,r.push(s.item),e(t.el).data("selected",r).change(),e(t.helpers.multi).find("input").val("").width(20),t.refresh(),e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),t.trigger(e.extend(n,{phase:"after"}))}}else e(t.el).data("selected",s.item).val(s.item.text).change(),t.helpers.focus&&t.helpers.focus.find("input").val("")}}))}}},inRange:function(t){var i=!1;if("date"==this.type){var s=w2utils.isDate(t,this.options.format,!0);if(s){if(this.options.start||this.options.end){var r="string"==typeof this.options.start?this.options.start:e(this.options.start).val(),n="string"==typeof this.options.end?this.options.end:e(this.options.end).val(),a=w2utils.isDate(r,this.options.format,!0),o=w2utils.isDate(n,this.options.format,!0),l=new Date(s);a||(a=l),o||(o=l),l>=a&&o>=l&&(i=!0)}else i=!0;this.options.blocked&&-1!=e.inArray(t,this.options.blocked)&&(i=!1)}}if("time"==this.type)if(this.options.start||this.options.end){var d=this.toMin(t),u=this.toMin(this.options.start),h=this.toMin(this.options.end);u||(u=d),h||(h=d),d>=u&&h>=d&&(i=!0)}else i=!0;return i},checkType:function(e,t){var i=this;switch(i.type){case"int":return t&&-1!=["-",i.options.groupSymbol].indexOf(e)?!0:w2utils.isInt(e.replace(i.options.numberRE,""));case"percent":e=e.replace(/%/g,"");case"float":return t&&-1!=["-",w2utils.settings.decimalSymbol,i.options.groupSymbol].indexOf(e)?!0:w2utils.isFloat(e.replace(i.options.numberRE,""));case"money":case"currency":return t&&-1!=["-",i.options.decimalSymbol,i.options.groupSymbol,i.options.currencyPrefix,i.options.currencySuffix].indexOf(e)?!0:w2utils.isFloat(e.replace(i.options.moneyRE,""));case"hex":case"color":return w2utils.isHex(e);case"alphanumeric":return w2utils.isAlphaNumeric(e)}return!0},addPrefix:function(){var t=this;setTimeout(function(){if("clear"!==t.type){var i,s=e(t.el).data("tmp")||{};s["old-padding-left"]&&e(t.el).css("padding-left",s["old-padding-left"]),s["old-padding-left"]=e(t.el).css("padding-left"),e(t.el).data("tmp",s),t.helpers.prefix&&e(t.helpers.prefix).remove(),""!==t.options.prefix&&(e(t.el).before('<div class="w2ui-field-helper">'+t.options.prefix+"</div>"),i=e(t.el).prev(),i.css({color:e(t.el).css("color"),"font-family":e(t.el).css("font-family"),"font-size":e(t.el).css("font-size"),"padding-top":e(t.el).css("padding-top"),"padding-bottom":e(t.el).css("padding-bottom"),"padding-left":e(t.el).css("padding-left"),"padding-right":0,"margin-top":parseInt(e(t.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(e(t.el).css("margin-bottom"),10)+1+"px","margin-left":e(t.el).css("margin-left"),"margin-right":0}).on("click",function(){if(t.options.icon&&"function"==typeof t.onIconClick){var s=t.trigger({phase:"before",type:"iconClick",target:t.el,el:e(this).find("span.w2ui-icon")[0]});if(s.isCancelled===!0)return;t.trigger(e.extend(s,{phase:"after"}))}else"list"==t.type?e(t.helpers.focus).find("input").focus():e(t.el).focus()}),e(t.el).css("padding-left",i.width()+parseInt(e(t.el).css("padding-left"),10)+"px"),t.helpers.prefix=i)}},1)},addSuffix:function(){var i,s,t=this;setTimeout(function(){if("clear"!==t.type){var r=e(t.el).data("tmp")||{};if(r["old-padding-right"]&&e(t.el).css("padding-right",r["old-padding-right"]),r["old-padding-right"]=e(t.el).css("padding-right"),e(t.el).data("tmp",r),s=parseInt(e(t.el).css("padding-right"),10),t.options.arrows){t.helpers.arrows&&e(t.helpers.arrows).remove(),e(t.el).after('<div class="w2ui-field-helper" style="border: 1px solid transparent">&nbsp;    <div class="w2ui-field-up" type="up">        <div class="arrow-up" type="up"></div>    </div>    <div class="w2ui-field-down" type="down">        <div class="arrow-down" type="down"></div>    </div></div>');{w2utils.getSize(t.el,"height")}i=e(t.el).next(),i.css({color:e(t.el).css("color"),"font-family":e(t.el).css("font-family"),"font-size":e(t.el).css("font-size"),height:e(t.el).height()+parseInt(e(t.el).css("padding-top"),10)+parseInt(e(t.el).css("padding-bottom"),10)+"px",padding:0,"margin-top":parseInt(e(t.el).css("margin-top"),10)+1+"px","margin-bottom":0,"border-left":"1px solid silver"}).css("margin-left","-"+(i.width()+parseInt(e(t.el).css("margin-right"),10)+12)+"px").on("mousedown",function(i){function s(){clearTimeout(e("body").data("_field_update_timer")),e("body").off("mouseup",s)}function r(s){e(t.el).focus(),t.keyDown(e.Event("keydown"),{keyCode:"up"==e(i.target).attr("type")?38:40}),s!==!1&&e("body").data("_field_update_timer",setTimeout(r,60))}e("body").on("mouseup",s),e("body").data("_field_update_timer",setTimeout(r,700)),r(!1)}),s+=i.width()+12,e(t.el).css("padding-right",s+"px"),t.helpers.arrows=i}""!==t.options.suffix&&(t.helpers.suffix&&e(t.helpers.suffix).remove(),e(t.el).after('<div class="w2ui-field-helper">'+t.options.suffix+"</div>"),i=e(t.el).next(),i.css({color:e(t.el).css("color"),"font-family":e(t.el).css("font-family"),"font-size":e(t.el).css("font-size"),"padding-top":e(t.el).css("padding-top"),"padding-bottom":e(t.el).css("padding-bottom"),"padding-left":"3px","padding-right":e(t.el).css("padding-right"),"margin-top":parseInt(e(t.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(e(t.el).css("margin-bottom"),10)+1+"px"}).on("click",function(){"list"==t.type?e(t.helpers.focus).find("input").focus():e(t.el).focus()}),i.css("margin-left","-"+(w2utils.getSize(i,"width")+parseInt(e(t.el).css("margin-right"),10)+2)+"px"),s+=i.width()+3,e(t.el).css("padding-right",s+"px"),t.helpers.suffix=i)}},1)},addFocus:function(){var t=this,s=(this.options,0);e(t.helpers.focus).remove();var r='<div class="w2ui-field-helper">    <div class="w2ui-icon icon-search"></div>    <input type="text" autocomplete="off"><div>';e(t.el).attr("tabindex",-1).before(r);var n=e(t.el).prev();t.helpers.focus=n,n.css({width:e(t.el).width(),"margin-top":e(t.el).css("margin-top"),"margin-left":parseInt(e(t.el).css("margin-left"))+parseInt(e(t.el).css("padding-left"))+"px","margin-bottom":e(t.el).css("margin-bottom"),"margin-right":e(t.el).css("margin-right")}).find("input").css({cursor:"default",width:"100%",outline:"none",opacity:1,margin:0,border:"1px solid transparent",padding:e(t.el).css("padding-top"),"padding-left":0,"margin-left":s>0?s+6:0,"background-color":"transparent"}),n.find("input").on("click",function(i){0==e("#w2ui-overlay").length&&t.focus(i),i.stopPropagation()}).on("focus",function(i){e(t.el).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"}),e(this).val(""),e(t.el).triggerHandler("focus"),i.stopPropagation?i.stopPropagation():i.cancelBubble=!0}).on("blur",function(i){e(t.el).css("outline","none"),e(this).val(""),t.refresh(),e(t.el).triggerHandler("blur"),i.stopPropagation?i.stopPropagation():i.cancelBubble=!0}).on("keyup",function(e){t.keyUp(e)}).on("keydown",function(e){t.keyDown(e)}).on("keypress",function(e){t.keyPress(e)}),n.on("click",function(){e(this).find("input").focus()}),t.refresh()},addMulti:function(){{var t=this;this.options}e(t.helpers.multi).remove();var s="",r="margin-top     : 0px; margin-bottom  : 0px; margin-left    : "+e(t.el).css("margin-left")+"; margin-right   : "+e(t.el).css("margin-right")+"; width          : "+(w2utils.getSize(t.el,"width")-parseInt(e(t.el).css("margin-left"),10)-parseInt(e(t.el).css("margin-right"),10))+"px;";"enum"==t.type&&(s='<div class="w2ui-field-helper w2ui-list" style="'+r+'; box-sizing: border-box">    <div style="padding: 0px; margin: 0px; margin-right: 20px; display: inline-block">    <ul>        <li style="padding-left: 0px; padding-right: 0px" class="nomouse">            <input type="text" style="width: 20px" autocomplete="off" '+(e(t.el).attr("readonly")?"readonly":"")+">        </li>"),"file"==t.type&&(s='<div class="w2ui-field-helper w2ui-list" style="'+r+'; box-sizing: border-box">    <div style="padding: 0px; margin: 0px; margin-right: 20px; display: inline-block">    <ul><li style="padding-left: 0px; padding-right: 0px" class="nomouse"></li></ul>    <input class="file-input" type="file" name="attachment" multiple style="display: none" tabindex="-1">'),e(t.el).before(s).css({"background-color":"transparent","border-color":"transparent"});var n=e(t.el).prev();t.helpers.multi=n,"enum"==t.type&&(e(t.el).attr("tabindex",-1),n.find("input").on("click",function(i){0==e("#w2ui-overlay").length&&t.focus(i),e(t.el).triggerHandler("click")}).on("focus",function(i){e(n).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"}),e(t.el).triggerHandler("focus"),i.stopPropagation?i.stopPropagation():i.cancelBubble=!0}).on("blur",function(i){e(n).css("outline","none"),e(t.el).triggerHandler("blur"),i.stopPropagation?i.stopPropagation():i.cancelBubble=!0}).on("keyup",function(e){t.keyUp(e)}).on("keydown",function(e){t.keyDown(e)}).on("keypress",function(e){n.find(".w2ui-enum-placeholder").remove(),t.keyPress(e)}),n.on("click",function(){e(this).find("input").focus()})),"file"==t.type&&(e(t.el).css("outline","none"),n.on("click",function(i){e(t.el).focus(),e(t.el).attr("readonly")||(t.blur(i),n.find("input").click())}).on("dragenter",function(){e(t.el).attr("readonly")||e(n).addClass("w2ui-file-dragover")}).on("dragleave",function(i){if(!e(t.el).attr("readonly")){var s=e(i.target).parents(".w2ui-field-helper");0==s.length&&e(n).removeClass("w2ui-file-dragover")}}).on("drop",function(i){if(!e(t.el).attr("readonly")){e(n).removeClass("w2ui-file-dragover");for(var s=i.originalEvent.dataTransfer.files,r=0,a=s.length;a>r;r++)t.addFile.call(t,s[r]);i.preventDefault(),i.stopPropagation()}}).on("dragover",function(e){e.preventDefault(),e.stopPropagation()}),n.find("input").on("click",function(e){e.stopPropagation()}).on("change",function(){if("undefined"!=typeof this.files)for(var e=0,i=this.files.length;i>e;e++)t.addFile.call(t,this.files[e])})),t.refresh()},addFile:function(t){var l,i=this,s=this.options,r=e(i.el).data("selected"),n={name:t.name,type:t.type,modified:t.lastModifiedDate,size:t.size,content:null},a=0,o=0;for(var d in r){if(r[d].name==t.name&&r[d].size==t.size)return;a+=r[d].size,o++}var u=i.trigger({phase:"before",type:"add",target:i.el,file:n,total:o,totalSize:a});if(u.isCancelled!==!0){if(0!==s.maxFileSize&&n.size>s.maxFileSize)return l="Maximum file size is "+w2utils.size(s.maxFileSize),s.silent===!1&&e(i.el).w2tag(l),void console.log("ERROR: "+l);if(0!==s.maxSize&&a+n.size>s.maxSize)return l="Maximum total size is "+w2utils.size(s.maxSize),s.silent===!1&&e(i.el).w2tag(l),void console.log("ERROR: "+l);if(0!==s.max&&o>=s.max)return l="Maximum number of files is "+s.max,s.silent===!1&&e(i.el).w2tag(l),void console.log("ERROR: "+l);if(r.push(n),"undefined"!=typeof FileReader){var h=new FileReader;h.onload=function(){return function(t){var s=t.target.result,r=s.indexOf(",");n.content=s.substr(r+1),i.refresh(),e(i.el).trigger("change"),i.trigger(e.extend(u,{phase:"after"}))}}(),h.readAsDataURL(t)}else i.refresh(),e(i.el).trigger("change")}},normMenu:function(t){if(e.isArray(t)){for(var i=0;i<t.length;i++)"string"==typeof t[i]?t[i]={id:t[i],text:t[i]}:("undefined"!=typeof t[i].text&&"undefined"==typeof t[i].id&&(t[i].id=t[i].text),"undefined"==typeof t[i].text&&"undefined"!=typeof t[i].id&&(t[i].text=t[i].id),"undefined"!=typeof t[i].caption&&(t[i].text=t[i].caption));return t}if("object"==typeof t){var s=[];for(var i in t)s.push({id:i,text:t[i]});return s}},getColorHTML:function(){for(var t='<div class="w2ui-color"><table cellspacing="5">',i=0;8>i;i++){t+="<tr>";for(var s=0;8>s;s++)t+='<td>    <div class="color" style="background-color: #'+this.pallete[i][s]+';" name="'+this.pallete[i][s]+'" index="'+i+":"+s+'">        '+(e(this.el).val()==this.pallete[i][s]?"&#149;":"&nbsp;")+"    </div></td>";t+="</tr>",2>i&&(t+='<tr><td style="height: 8px" colspan="8"></td></tr>')}return t+="</table></div>"},getMonthHTML:function(e,t){var i=new Date,s=w2utils.settings.fullmonths,n=(w2utils.settings.fulldays,["31","28","31","30","31","30","31","31","30","31","30","31"]),a=i.getFullYear()+"/"+(Number(i.getMonth())+1)+"/"+i.getDate();t=w2utils.isInt(t)?parseInt(t):i.getFullYear(),e=w2utils.isInt(e)?parseInt(e):i.getMonth()+1,e>12&&(e-=12,t++),(1>e||0===e)&&(e+=12,t--),n[1]=t/4==Math.floor(t/4)?"29":"28",this.options.current=e+"/"+t,i=new Date(t,e-1,1);for(var o=i.getDay(),l=w2utils.settings.shortdays,d="",u=0,h=l.length;h>u;u++)d+="<td>"+l[u]+"</td>";for(var f='<div class="w2ui-calendar-title title">    <div class="w2ui-calendar-previous previous"> <div></div> </div>    <div class="w2ui-calendar-next next"> <div></div> </div> '+s[e-1]+", "+t+'</div><table class="w2ui-calendar-days" cellspacing="0">    <tr class="w2ui-day-title">'+d+"</tr>    <tr>",c=1,p=1;43>p;p++){if(0===o&&1==p){for(var g=0;6>g;g++)f+='<td class="w2ui-day-empty">&nbsp;</td>';p+=6}else if(o>p||c>n[e-1]){f+='<td class="w2ui-day-empty">&nbsp;</td>',p%7===0&&(f+="</tr><tr>");continue}var m=t+"/"+e+"/"+c,v="";p%7==6&&(v=" w2ui-saturday"),p%7===0&&(v=" w2ui-sunday"),m==a&&(v+=" w2ui-today");var w=c,y="",b="",x=w2utils.formatDate(m,this.options.format);this.options.colored&&void 0!==this.options.colored[x]&&(tmp=this.options.colored[x].split(":"),b="background-color: "+tmp[0]+";",y="color: "+tmp[1]+";"),f+='<td class="'+(this.inRange(x)?"w2ui-date ":"w2ui-blocked")+v+'" style="'+y+b+'" date="'+x+'">'+w+"</td>",(p%7===0||0===o&&1==p)&&(f+="</tr><tr>"),c++}return f+="</tr></table>"},getYearHTML:function(){var e=w2utils.settings.shortmonths,t="",i="";for(var s in e)t+='<div class="w2ui-jump-month" name="'+s+'">'+e[s]+"</div>";for(var r=1950;2020>=r;r++)i+='<div class="w2ui-jump-year" name="'+r+'">'+r+"</div>";return"<div>"+t+"</div><div>"+i+"</div>"},getHourHTML:function(){for(var e=[],t="h24"==this.options.format?!0:!1,i=0;24>i;i++){var s=(i>=12&&!t?i-12:i)+":00"+(t?"":12>i?" am":" pm");12!=i||t||(s="12:00 pm"),e[Math.floor(i/8)]||(e[Math.floor(i/8)]="");var r=this.fromMin(this.toMin(s)),n=this.fromMin(this.toMin(s)+59);e[Math.floor(i/8)]+='<div class="'+(this.inRange(r)||this.inRange(n)?"w2ui-time ":"w2ui-blocked")+'" hour="'+i+'">'+s+"</div>"}var a='<div class="w2ui-calendar-time"><table><tr>    <td>'+e[0]+"</td>    <td>"+e[1]+"</td>    <td>"+e[2]+"</td></tr></table></div>";return a},getMinHTML:function(e){"undefined"==typeof e&&(e=0);for(var t="h24"==this.options.format?!0:!1,i=[],s=0;60>s;s+=5){var r=(e>12&&!t?e-12:e)+":"+(10>s?0:"")+s+" "+(t?"":12>e?"am":"pm"),n=20>s?0:40>s?1:2;i[n]||(i[n]=""),i[n]+='<div class="'+(this.inRange(r)?"w2ui-time ":"w2ui-blocked")+'" min="'+s+'">'+r+"</div>"}var a='<div class="w2ui-calendar-time"><table><tr>    <td>'+i[0]+"</td>    <td>"+i[1]+"</td>    <td>"+i[2]+"</td></tr></table></div>";return a},toMin:function(e){if("string"!=typeof e)return null;var t=e.split(":");return 2!=t.length?null:(t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),-1!=e.indexOf("pm")&&12!=t[0]&&(t[0]+=12),60*t[0]+t[1])},fromMin:function(e){var t="";e>=1440&&(e%=1440),0>e&&(e=1440+e);var i=Math.floor(e/60),s=(10>e%60?"0":"")+e%60;return t=-1!=this.options.format.indexOf("h24")?i+":"+s:(12>=i?i:i-12)+":"+s+" "+(i>=12?"pm":"am")}},e.extend(t.prototype,w2utils.event),w2obj.field=t}(jQuery),function(){var w2form=function(e){this.name=null,this.header="",this.box=null,this.url="",this.routeData={},this.formURL="",this.formHTML="",this.page=0,this.recid=0,this.fields=[],this.actions={},this.record={},this.original={},this.postData={},this.toolbar={},this.tabs={},this.style="",this.focus=0,this.msgNotJSON=w2utils.lang("Return data is not in JSON format."),this.msgAJAXerror=w2utils.lang("AJAX error. See console for more details."),this.msgRefresh=w2utils.lang("Refreshing..."),this.msgSaving=w2utils.lang("Saving..."),this.onRequest=null,this.onLoad=null,this.onValidate=null,this.onSubmit=null,this.onSave=null,this.onChange=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,this.onAction=null,this.onToolbar=null,this.onError=null,this.isGenerated=!1,this.last={xhr:null},$.extend(!0,this,w2obj.form,e)};$.fn.w2form=function(e){if("object"==typeof e||!e){var t=this;if(!w2utils.checkName(e,"w2form"))return;var i=e.record,s=e.original,r=e.fields,n=e.toolbar,a=e.tabs,o=new w2form(e);if($.extend(o,{record:{},original:{},fields:[],tabs:{},toolbar:{},handlers:[]}),$.isArray(a)){$.extend(!0,o.tabs,{tabs:[]});for(var l in a){var d=a[l];o.tabs.tabs.push("object"==typeof d?d:{id:d,caption:d})}}else $.extend(!0,o.tabs,a);$.extend(!0,o.toolbar,n);for(var u in r){var h=$.extend(!0,{},r[u]);"undefined"==typeof h.name&&"undefined"!=typeof h.field&&(h.name=h.field),"undefined"==typeof h.field&&"undefined"!=typeof h.name&&(h.field=h.name),o.fields[u]=h}for(var u in i)o.record[u]=$.isPlainObject(i[u])?$.extend(!0,{},i[u]):i[u];for(var u in s)o.original[u]=$.isPlainObject(s[u])?$.extend(!0,{},s[u]):s[u];return t.length>0&&(o.box=t[0]),""!=o.formURL?$.get(o.formURL,function(e){o.formHTML=e,o.isGenerated=!0,(0!=$(o.box).length||0!=e.length)&&($(o.box).html(e),o.render(o.box))}):""!=o.formHTML||(o.formHTML=0!=$(this).length&&""!=$.trim($(this).html())?$(this).html():o.generateHTML()),w2ui[o.name]=o,""==o.formURL&&(-1==String(o.formHTML).indexOf("w2ui-page")&&(o.formHTML='<div class="w2ui-page page-0">'+o.formHTML+"</div>"),$(o.box).html(o.formHTML),o.isGenerated=!0,o.render(o.box)),o}if(w2ui[$(this).attr("name")]){var t=w2ui[$(this).attr("name")];return t[e].apply(t,Array.prototype.slice.call(arguments,1)),this}console.log("ERROR: Method "+e+" does not exist on jQuery.w2form")},w2form.prototype={get:function(e,t){if(0===arguments.length){var i=[];for(var s in this.fields)null!=this.fields[s].name&&i.push(this.fields[s].name);return i}for(var r in this.fields)if(this.fields[r].name==e)return t===!0?r:this.fields[r];return null},set:function(e,t){for(var i in this.fields)if(this.fields[i].name==e)return $.extend(this.fields[i],t),this.refresh(),!0;return!1},reload:function(e){var t="object"!=typeof this.url?this.url:this.url.get;t&&0!=this.recid?this.request(e):"function"==typeof e&&e()},clear:function(){this.recid=0,this.record={},$().w2tag(),this.refresh()},error:function(e){var i=this.trigger({target:this.name,type:"error",message:e,xhr:this.last.xhr});return i.isCancelled===!0?void("function"==typeof callBack&&callBack()):(setTimeout(function(){w2alert(e,"Error")},1),void this.trigger($.extend(i,{phase:"after"})))},validate:function(e){"undefined"==typeof e&&(e=!0),$().w2tag();var t=[];for(var i in this.fields){var s=this.fields[i];switch(null==this.record[s.name]&&(this.record[s.name]=""),s.type){case"int":this.record[s.name]&&!w2utils.isInt(this.record[s.name])&&t.push({field:s,error:w2utils.lang("Not an integer")});break;case"float":this.record[s.name]&&!w2utils.isFloat(this.record[s.name])&&t.push({field:s,error:w2utils.lang("Not a float")});break;case"money":this.record[s.name]&&!w2utils.isMoney(this.record[s.name])&&t.push({field:s,error:w2utils.lang("Not in money format")});break;case"color":case"hex":this.record[s.name]&&!w2utils.isHex(this.record[s.name])&&t.push({field:s,error:w2utils.lang("Not a hex number")});break;case"email":this.record[s.name]&&!w2utils.isEmail(this.record[s.name])&&t.push({field:s,error:w2utils.lang("Not a valid email")});break;case"checkbox":this.record[s.name]=1==this.record[s.name]?1:0;break;case"date":s.options.format||(s.options.format=w2utils.settings.date_format),this.record[s.name]&&!w2utils.isDate(this.record[s.name],s.options.format)&&t.push({field:s,error:w2utils.lang("Not a valid date")+": "+s.options.format});break;case"list":case"combo":break;case"enum":}var r=this.record[s.name];s.required&&(""===r||$.isArray(r)&&0==r.length||$.isPlainObject(r)&&$.isEmptyObject(r))&&t.push({field:s,error:w2utils.lang("Required field")}),s.equalto&&this.record[s.name]!=this.record[s.equalto]&&t.push({field:s,error:w2utils.lang("Field should be equal to ")+s.equalto})}var n=this.trigger({phase:"before",target:this.name,type:"validate",errors:t});if(n.isCancelled!==!0){if(e)for(var a in n.errors){var o=n.errors[a];"radio"==o.field.type?$($(o.field.el).parents("div")[0]).w2tag(o.error,{"class":"w2ui-error"}):-1!=["enum","file"].indexOf(o.field.type)?!function(e){setTimeout(function(){var t=$(e.field.el).data("w2field").helpers.multi;
$(e.field.el).w2tag(e.error),$(t).addClass("w2ui-error")},1)}(o):$(o.field.el).w2tag(o.error,{"class":"w2ui-error"}),this.goto(t[0].field.page)}return this.trigger($.extend(n,{phase:"after"})),t}},getChanges:function(){var e=function(t,i,s){for(var r in t)"object"==typeof t[r]?(s[r]=e(t[r],i[r]||{},{}),(!s[r]||$.isEmptyObject(s[r]))&&delete s[r]):t[r]!=i[r]&&(s[r]=t[r]);return s};return e(this.record,this.original,{})},request:function(postData,callBack){var obj=this;if("function"==typeof postData&&(callBack=postData,postData=null),("undefined"==typeof postData||null==postData)&&(postData={}),this.url&&("object"!=typeof this.url||this.url.get)){(null==this.recid||"undefined"==typeof this.recid)&&(this.recid=0);var params={};params.cmd="get-record",params.recid=this.recid,$.extend(params,this.postData),$.extend(params,postData);var eventData=this.trigger({phase:"before",type:"request",target:this.name,url:this.url,postData:params});if(eventData.isCancelled===!0)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));this.record={},this.original={},this.lock(this.msgRefresh);var url=eventData.url;if("object"==typeof eventData.url&&eventData.url.get&&(url=eventData.url.get),this.last.xhr)try{this.last.xhr.abort()}catch(e){}if(!$.isEmptyObject(obj.routeData)){var info=w2utils.parseRoute(url);if(info.keys.length>0)for(var k=0;k<info.keys.length;k++)null!=obj.routeData[info.keys[k].name]&&(url=url.replace(new RegExp(":"+info.keys[k].name,"g"),obj.routeData[info.keys[k].name]))}var ajaxOptions={type:"POST",url:url,data:eventData.postData,dataType:"text"};"HTTP"==w2utils.settings.dataType&&(ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]")),"RESTFULL"==w2utils.settings.dataType&&(ajaxOptions.type="GET",ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]")),"JSON"==w2utils.settings.dataType&&(ajaxOptions.type="POST",ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json"),this.last.xhr=$.ajax(ajaxOptions).done(function(data,status,xhr){obj.unlock();var eventData=obj.trigger({phase:"before",target:obj.name,type:"load",xhr:xhr});if(eventData.isCancelled===!0)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));var data,responseText=obj.last.xhr.responseText;if("error"!=status){if("undefined"!=typeof responseText&&""!=responseText){if("object"==typeof responseText)data=responseText;else try{eval("data = "+responseText)}catch(e){}"undefined"==typeof data&&(data={status:"error",message:obj.msgNotJSON,responseText:responseText}),"error"==data.status?obj.error(data.message):(obj.record=$.extend({},data.record),obj.original=$.extend({},data.record))}}else obj.error("AJAX Error "+xhr.status+": "+xhr.statusText),data={status:"error",message:obj.msgAJAXerror,responseText:responseText};obj.trigger($.extend(eventData,{phase:"after"})),obj.refresh(),"function"==typeof callBack&&callBack(data)}).fail(function(e,t,i){var s={status:t,error:i,rawResponseText:e.responseText},r=obj.trigger({phase:"before",type:"error",error:s,xhr:e});if(r.isCancelled!==!0){if("abort"!=t){var n;try{n=$.parseJSON(e.responseText)}catch(a){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",items:[{id:1,text:"item"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof n?n:e.responseText)}obj.trigger($.extend(r,{phase:"after"}))}}),this.trigger($.extend(eventData,{phase:"after"}))}},submit:function(e,t){return this.save(e,t)},save:function(postData,callBack){var obj=this;$(this.box).find(":focus").change(),"function"==typeof postData&&(callBack=postData,postData=null);var errors=obj.validate(!0);if(0===errors.length){if(("undefined"==typeof postData||null==postData)&&(postData={}),!obj.url||"object"==typeof obj.url&&!obj.url.save)return void console.log("ERROR: Form cannot be saved because no url is defined.");obj.lock(obj.msgSaving+' <span id="'+obj.name+'_progress"></span>'),setTimeout(function(){var params={};params.cmd="save-record",params.recid=obj.recid,$.extend(params,obj.postData),$.extend(params,postData),params.record=$.extend(!0,{},obj.record);var eventData=obj.trigger({phase:"before",type:"submit",target:obj.name,url:obj.url,postData:params});if(eventData.isCancelled!==!0){var url=eventData.url;if("object"==typeof eventData.url&&eventData.url.save&&(url=eventData.url.save),obj.last.xhr)try{obj.last.xhr.abort()}catch(e){}if(!$.isEmptyObject(obj.routeData)){var info=w2utils.parseRoute(url);if(info.keys.length>0)for(var k=0;k<info.keys.length;k++)null!=obj.routeData[info.keys[k].name]&&(url=url.replace(new RegExp(":"+info.keys[k].name,"g"),obj.routeData[info.keys[k].name]))}var ajaxOptions={type:"POST",url:url,data:eventData.postData,dataType:"text",xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);$("#"+obj.name+"_progress").text(""+t+"%")}},!1),e}};"HTTP"==w2utils.settings.dataType&&(ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]")),"RESTFULL"==w2utils.settings.dataType&&(0!=obj.recid&&(ajaxOptions.type="PUT"),ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]")),"JSON"==w2utils.settings.dataType&&(ajaxOptions.type="POST",ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json"),obj.last.xhr=$.ajax(ajaxOptions).done(function(data,status,xhr){obj.unlock();var eventData=obj.trigger({phase:"before",target:obj.name,type:"save",xhr:xhr,status:status});if(eventData.isCancelled!==!0){var data,responseText=xhr.responseText;if("error"!=status){if("undefined"!=typeof responseText&&""!=responseText){if("object"==typeof responseText)data=responseText;else try{eval("data = "+responseText)}catch(e){}"undefined"==typeof data&&(data={status:"error",message:obj.msgNotJSON,responseText:responseText}),"error"==data.status?obj.error(data.message):obj.original=$.extend({},obj.record)}}else obj.error("AJAX Error "+xhr.status+": "+xhr.statusText),data={status:"error",message:obj.msgAJAXerror,responseText:responseText};obj.trigger($.extend(eventData,{phase:"after"})),obj.refresh(),"success"==data.status&&"function"==typeof callBack&&callBack(data)}}).fail(function(e,t,i){var s={status:t,error:i,rawResponseText:e.responseText},r=obj.trigger({phase:"before",type:"error",error:s,xhr:e});r.isCancelled!==!0&&(console.log("ERROR: server communication failed. The server should return",{status:"success"},"OR",{status:"error",message:"error message"},", instead the AJAX request produced this: ",s),obj.trigger($.extend(r,{phase:"after"})))}),obj.trigger($.extend(eventData,{phase:"after"}))}},50)}},lock:function(){var i=$(this.box).find("> div:first-child"),s=Array.prototype.slice.call(arguments,0);s.unshift(i),w2utils.lock.apply(window,s)},unlock:function(){var e=this;setTimeout(function(){w2utils.unlock(e.box)},25)},"goto":function(e){"undefined"!=typeof e&&(this.page=e),$(this.box).data("auto-size")===!0&&$(this.box).height(0),this.refresh()},generateHTML:function(){var i,e=[],t="";for(var s in this.fields){var r="",n=this.fields[s];"undefined"==typeof n.html&&(n.html={}),n.html=$.extend(!0,{caption:"",span:6,attr:"",text:"",page:0},n.html),"undefined"==typeof i&&(i=n.html.page),""==n.html.caption&&(n.html.caption=n.name);var a='<input name="'+n.name+'" type="text" '+n.html.attr+"/>";("pass"===n.type||"password"===n.type)&&(a='<input name="'+n.name+'" type = "password" '+n.html.attr+"/>"),"checkbox"==n.type&&(a='<input name="'+n.name+'" type="checkbox" '+n.html.attr+"/>"),"textarea"==n.type&&(a='<textarea name="'+n.name+'" '+n.html.attr+"></textarea>"),"toggle"==n.type&&(a='<input name="'+n.name+'" type="checkbox" '+n.html.attr+' class="w2ui-toggle"/><div><div></div></div>'),n.html.group&&(""!=t&&(r+="\n   </div>"),r+='\n   <div class="w2ui-group-title">'+n.html.group+'</div>\n   <div class="w2ui-group">',t=n.html.group),n.html.page!=i&&""!=t&&(e[e.length-1]+="\n   </div>",t=""),r+='\n      <div class="w2ui-field '+("undefined"!=typeof n.html.span?"w2ui-span"+n.html.span:"")+'">\n         <label>'+w2utils.lang(n.html.caption)+"</label>\n         <div>"+a+w2utils.lang(n.html.text)+"</div>\n      </div>","undefined"==typeof e[n.html.page]&&(e[n.html.page]=""),e[n.html.page]+=r,i=n.html.page}if(""!=t&&(e[e.length-1]+="\n   </div>"),this.tabs.tabs)for(var o=0;o<this.tabs.tabs.length;o++)"undefined"==typeof e[o]&&(e[o]="");for(var l in e)e[l]='<div class="w2ui-page page-'+l+'">'+e[l]+"\n</div>";var d="";if(!$.isEmptyObject(this.actions)){var u="";d+='\n<div class="w2ui-buttons">';for(var h in this.actions)u=-1!=["save","update","create"].indexOf(h.toLowerCase())?"btn-green":"",d+='\n    <button name="'+h+'" class="btn '+u+'">'+w2utils.lang(h)+"</button>";d+="\n</div>"}return e.join("")+d},action:function(e,t){var i=this.trigger({phase:"before",target:e,type:"action",originalEvent:t});i.isCancelled!==!0&&("function"==typeof this.actions[e]&&this.actions[e].call(this,t),this.trigger($.extend(i,{phase:"after"})))},resize:function(){function u(){i.width($(e.box).width()).height($(e.box).height()),r.css("top",""!=e.header?w2utils.getSize(s,"height"):0),n.css("top",(""!=e.header?w2utils.getSize(s,"height"):0)+("object"==typeof e.toolbar&&$.isArray(e.toolbar.items)&&e.toolbar.items.length>0?w2utils.getSize(r,"height"):0)),a.css("top",(""!=e.header?w2utils.getSize(s,"height"):0)+("object"==typeof e.toolbar&&$.isArray(e.toolbar.items)&&e.toolbar.items.length>0?w2utils.getSize(r,"height")+5:0)+("object"==typeof e.tabs&&$.isArray(e.tabs.tabs)&&e.tabs.tabs.length>0?w2utils.getSize(n,"height")+5:0)),a.css("bottom",d.length>0?w2utils.getSize(d,"height"):0)}var e=this,t=this.trigger({phase:"before",target:this.name,type:"resize"});if(t.isCancelled!==!0){var i=$(this.box).find("> div"),s=$(this.box).find("> div .w2ui-form-header"),r=$(this.box).find("> div .w2ui-form-toolbar"),n=$(this.box).find("> div .w2ui-form-tabs"),a=$(this.box).find("> div .w2ui-page"),o=$(this.box).find("> div .w2ui-page.page-"+this.page),l=$(this.box).find("> div .w2ui-page.page-"+this.page+" > div"),d=$(this.box).find("> div .w2ui-buttons");u(),(0==parseInt($(this.box).height())||$(this.box).data("auto-size")===!0)&&($(this.box).height((s.length>0?w2utils.getSize(s,"height"):0)+("object"==typeof this.tabs&&$.isArray(this.tabs.tabs)&&this.tabs.tabs.length>0?w2utils.getSize(n,"height"):0)+("object"==typeof this.toolbar&&$.isArray(this.toolbar.items)&&this.toolbar.items.length>0?w2utils.getSize(r,"height"):0)+(a.length>0?w2utils.getSize(l,"height")+w2utils.getSize(o,"+height")+12:0)+(d.length>0?w2utils.getSize(d,"height"):0)),$(this.box).data("auto-size",!0)),u(),e.trigger($.extend(t,{phase:"after"}))}},refresh:function(){var e=(new Date).getTime(),t=this;if(this.box&&this.isGenerated&&"undefined"!=typeof $(this.box).html()){$(this.box).find("input, textarea, select").each(function(e,i){var s=$(i).attr("undefined"!=typeof $(i).attr("name")?"name":"id"),r=t.get(s);if(r){var n=$(i).parents(".w2ui-page");if(n.length>0)for(var a=0;100>a;a++)if(n.hasClass("page-"+a)){r.page=a;break}}});var i=this.trigger({phase:"before",target:this.name,type:"refresh",page:this.page});if(i.isCancelled!==!0){$(this.box).find(".w2ui-page").hide(),$(this.box).find(".w2ui-page.page-"+this.page).show(),$(this.box).find(".w2ui-form-header").html(this.header),"object"==typeof this.tabs&&$.isArray(this.tabs.tabs)&&this.tabs.tabs.length>0?($("#form_"+this.name+"_tabs").show(),this.tabs.active=this.tabs.tabs[this.page].id,this.tabs.refresh()):$("#form_"+this.name+"_tabs").hide(),"object"==typeof this.toolbar&&$.isArray(this.toolbar.items)&&this.toolbar.items.length>0?($("#form_"+this.name+"_toolbar").show(),this.toolbar.refresh()):$("#form_"+this.name+"_toolbar").hide();for(var s in this.fields){var r=this.fields[s];"undefined"==typeof r.name&&"undefined"!=typeof r.field&&(r.name=r.field),"undefined"==typeof r.field&&"undefined"!=typeof r.name&&(r.field=r.name),r.$el=$(this.box).find('[name="'+String(r.name).replace(/\\/g,"\\\\")+'"]'),r.el=r.$el[0],"undefined"==typeof r.el&&console.log('ERROR: Cannot associate field "'+r.name+'" with html control. Make sure html control exists with the same name.'),r.el&&(r.el.id=r.name);var n=$(r).data("w2field");n&&n.clear(),$(r.$el).off("change").on("change",function(){var e=this.value,i=t.record[this.name]?t.record[this.name]:"",s=t.get(this.name);if(-1!=["list","enum","file"].indexOf(s.type)&&$(this).data("selected")){var r=$(this).data("selected"),n=t.record[this.name];if($.isArray(r)){e=[];for(var a in r)e[a]=$.extend(!0,{},r[a])}if($.isPlainObject(r)&&(e=$.extend(!0,{},r)),$.isArray(n)){i=[];for(var a in n)i[a]=$.extend(!0,{},n[a])}$.isPlainObject(n)&&(i=$.extend(!0,{},n))}if("toggle"==s.type&&(e=$(this).prop("checked")?1:0),-1!=["int","float","percent","money","currency"].indexOf(s.type)&&(e=$(this).data("w2field").clean(e)),e!==i){var o=t.trigger({phase:"before",target:this.name,type:"change",value_new:e,value_previous:i});if(o.isCancelled===!0)return void $(this).val(t.record[this.name]);var l=this.value;if("select"==this.type&&(l=this.value),"checkbox"==this.type&&(l=this.checked?!0:!1),"radio"==this.type&&s.$el.each(function(e,t){t.checked&&(l=t.value)}),-1!=["int","float","percent","money","currency","list","combo","enum","file","toggle"].indexOf(s.type)&&(l=e),-1!=["enum","file"].indexOf(s.type)&&l.length>0){var d=$(s.el).data("w2field").helpers.multi;$(d).removeClass("w2ui-error")}t.record[this.name]=l,t.trigger($.extend(o,{phase:"after"}))}}),r.required?$(r.el).parent().parent().addClass("w2ui-required"):$(r.el).parent().parent().removeClass("w2ui-required")}$(this.box).find("button, input[type=button]").each(function(e,i){$(i).off("click").on("click",function(e){var i=this.value;this.id&&(i=this.id),this.name&&(i=this.name),t.action(i,e)})});for(var s in this.fields){var r=this.fields[s],a="undefined"!=typeof this.record[r.name]?this.record[r.name]:"";if(r.el)switch(r.type=String(r.type).toLowerCase(),r.options||(r.options={}),r.type){case"text":case"textarea":case"email":case"pass":case"password":r.el.value=a;break;case"int":case"float":case"money":case"currency":case"percent":case"hex":case"alphanumeric":case"color":case"date":case"time":r.el.value=a,$(r.el).w2field($.extend({},r.options,{type:r.type}));break;case"toggle":w2utils.isFloat(a)&&(a=parseFloat(a)),$(r.el).prop("checked",a?!0:!1),this.record[r.name]=a?1:0;break;case"list":case"combo":if("list"==r.type){var o=$.isPlainObject(a)?a.id:a,l=r.options.items;$.isArray(l)&&l.length>0&&!$.isPlainObject(l[0])&&(r.options.items=w2obj.field.prototype.normMenu(l));for(var d in r.options.items){var u=r.options.items[d];if(u.id==o){a=$.extend(!0,{},u),t.record[r.name]=a;break}}}else r.el.value="combo"!=r.type||$.isPlainObject(a)?$.isPlainObject(a)&&"undefined"!=typeof a.text?a.text:"":a;$.isPlainObject(a)||(a={}),$(r.el).w2field($.extend({},r.options,{type:r.type,selected:a}));break;case"enum":case"file":$.isArray(a)||(a=[]),$(r.el).w2field($.extend({},r.options,{type:r.type,selected:a}));break;case"select":var l=r.options.items;if("undefined"!=typeof l&&l.length>0){l=w2obj.field.prototype.normMenu(l),$(r.el).html("");for(var h in l)$(r.el).append('<option value="'+l[h].id+'">'+l[h].text+"</option")}$(r.el).val(a);break;case"radio":$(r.$el).prop("checked",!1).each(function(e,t){$(t).val()==a&&$(t).prop("checked",!0)});break;case"checkbox":$(r.el).prop("checked",a?!0:!1);break;default:$(r.el).w2field($.extend({},r.options,{type:r.type}))}}for(var n=$(this.box).find(".w2ui-page"),d=0;d<n.length;d++)$(n[d]).find("> *").length>1&&$(n[d]).wrapInner("<div></div>");return this.trigger($.extend(i,{phase:"after"})),this.resize(),(new Date).getTime()-e}}},render:function(e){function a(){var e=$(i.box).find("input, select, textarea");e.length>i.focus&&e[i.focus].focus()}var t=(new Date).getTime(),i=this;if("object"==typeof e&&($(this.box).find("#form_"+this.name+"_tabs").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),this.box=e),this.isGenerated&&this.box){var s=this.trigger({phase:"before",target:this.name,type:"render",box:"undefined"!=typeof e?e:this.box});if(s.isCancelled!==!0){$.isEmptyObject(this.original)&&!$.isEmptyObject(this.record)&&(this.original=$.extend(!0,{},this.record));var r="<div>"+(""!=this.header?'<div class="w2ui-form-header">'+this.header+"</div>":"")+'    <div id="form_'+this.name+'_toolbar" class="w2ui-form-toolbar"></div>    <div id="form_'+this.name+'_tabs" class="w2ui-form-tabs"></div>'+this.formHTML+"</div>";$(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-form").html(r),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),"function"!=typeof this.toolbar.render&&(this.toolbar=$().w2toolbar($.extend({},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.toolbar.on("click",function(e){var t=i.trigger({phase:"before",type:"toolbar",target:e.target,originalEvent:e});t.isCancelled!==!0&&i.trigger($.extend(t,{phase:"after"}))})),"object"==typeof this.toolbar&&"function"==typeof this.toolbar.render&&this.toolbar.render($("#form_"+this.name+"_toolbar")[0]),"function"!=typeof this.tabs.render&&(this.tabs=$().w2tabs($.extend({},this.tabs,{name:this.name+"_tabs",owner:this})),this.tabs.on("click",function(e){i.goto(this.get(e.target,!0))})),"object"==typeof this.tabs&&"function"==typeof this.tabs.render&&this.tabs.render($("#form_"+this.name+"_tabs")[0]),this.trigger($.extend(s,{phase:"after"})),this.resize();var n="object"!=typeof this.url?this.url:this.url.get;return n&&0!=this.recid?this.request():this.refresh(),0==$(".w2ui-layout").length&&(this.tmp_resize=function(){w2ui[i.name].resize()},$(window).off("resize","body").on("resize","body",this.tmp_resize)),setTimeout(function(){i.resize(),i.refresh()},150),this.focus>=0&&setTimeout(a,500),(new Date).getTime()-t}}},destroy:function(){var e=this.trigger({phase:"before",target:this.name,type:"destroy"});e.isCancelled!==!0&&("object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),"object"==typeof this.tabs&&this.tabs.destroy&&this.tabs.destroy(),$(this.box).find("#form_"+this.name+"_tabs").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})),$(window).off("resize","body"))}},$.extend(w2form.prototype,w2utils.event),w2obj.form=w2form}();